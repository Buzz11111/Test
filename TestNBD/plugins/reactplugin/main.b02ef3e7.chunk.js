(this.webpackJsonpweather=this.webpackJsonpweather||[]).push([[0],{100:function(e,t,n){},1135:function(e,t,n){},1136:function(e,t,n){},1137:function(e,t,n){},1138:function(e,t,n){},1139:function(e,t,n){},1140:function(e,t,n){},1141:function(e,t,n){},1142:function(e,t,n){},1143:function(e,t,n){},1144:function(e,t,n){},1145:function(e,t,n){},1146:function(e,t,n){},1147:function(e,t,n){},1148:function(e,t,n){},1149:function(e,t,n){},1150:function(e,t,n){},1151:function(e,t,n){},1152:function(e,t,n){},1153:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(89),l=n.n(s),o=(n(100),n(9)),i=n(10),c=n(12),u=n(11),d=n(1),p=n.n(d),m=n(6),h=n(13),f=(n(338),n(1161)),b=n(1162),_=n(1163),y=n(1160),g=n(23),k=n(1156),v=n(1157),E=n(1158),O=n(1159),x=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){e.props.setFieldValue(e.props.field.name,t.target.checked)},e}return Object(i.a)(n,[{key:"render",value:function(){var e={};return this.props.readOnly&&(e={readOnly:!0,onChange:null}),r.a.createElement("div",null,r.a.createElement("div",{style:this.props.errors[this.props.field.name]&&this.props.touched[this.props.field.name]&&{border:"1px solid #cc3333",borderRadius:"3px"}},r.a.createElement(k.a,{key:"input_".concat(this.props.field.name),check:!0},r.a.createElement(v.a,{check:!0},r.a.createElement(E.a,Object.assign({type:"checkbox",name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,checked:this.props.values[this.props.field.name],disabled:this.props.readOnly,invalid:this.props.errors[this.props.field.name]&&this.props.touched[this.props.field.name]},e))," ",this.props.field.displayName))),this.props.errors[this.props.field.name]&&this.props.touched[this.props.field.name]?r.a.createElement(O.a,null,this.props.errors[this.props.field.name]):r.a.createElement("div",null),r.a.createElement("br",null))}}]),n}(a.Component),S=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){var n=""===t.target.value?null:t.target.value;console.log("count this.props",e.props,e.props.field.name,n),(""===t.target.value||/^-?[0-9\b]*$/.test(t.target.value))&&e.props.setFieldValue(e.props.field.name,n)},e}return Object(i.a)(n,[{key:"render",value:function(){var e={};return this.props.readOnly&&(e={readOnly:!0,placeholder:"-",className:"rdev-read-only-control"}),r.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(E.a,Object.assign({name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,value:this.props.field.value,defaultValue:1,invalid:this.props.errors&&this.props.touched,disabled:""!=this.props.uinField,type:"number"},e)),this.props.errors&&this.props.touched&&r.a.createElement(O.a,null,this.props.errors[this.props.field.name]))}}]),n}(a.Component),w=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){a.props.setFieldValue(a.props.field.name,e.target.value)},a.focus=function(){a.refInput.focus()},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement("input",{style:{height:"35px"},className:"form-control",name:this.props.field.name,placeholder:"",autoFocus:this.props.field.autoFocus||!1,onChange:this.handleChange,contentEditable:1==this.props.countField,disabled:1!=this.props.countField,ref:function(t){e.refInput=t}}))}}]),n}(a.Component),C=n(56),j=n(42),A=(a.Component,n(21)),N=(n(85),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={modalItems:[],selectedValue:""},a.getData=a.getData.bind(Object(h.a)(a)),a.handleChange=a.handleChange.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount"),e.next=3,this.getData();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(e){console.log("handleChange, value=",e),this.setState({selectedValue:e}),this.props.setFieldValue(this.props.field,e)}},{key:"getData",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/odata/reestr_parts_type?$select=template_name,recid&$orderBy=template_name&$filter=recstate eq 1",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(t.isNullOrEmptyResponse(e))return console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b");t.setState({modalItems:e.value})})).then((function(){return fetch("/odata/reestr_key_elements?$top=10&$select=part_type,recid&$filter=(recstate eq 1) and (part_type ne null)&$orderBy=reccreated desc",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}})})).then((function(e){return e.json()})).then((function(e){if(t.isNotEmptyOrNullArray(e.value))for(var n=0;n<e.value.length;n++)if(null!=e.value[n].part_type){var a=t.state.modalItems.find((function(t){return t.recid==e.value[n].part_type.toString()}));t.handleChange(a);break}})).catch((function(e){return console.log("Request failed: ",e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){return r.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},r.a.createElement(y.a,null,r.a.createElement(v.a,null,r.a.createElement("b",null,"\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u0435\u0439")),r.a.createElement(j.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(e){return e.template_name},getOptionValue:function(e){return e.recid},options:this.state.modalItems,onChange:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}})))}}]),n}(a.Component)),R=n(27);R.a.configure();var T=function(e,t){var n={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),n.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),n.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",n);try{fetch("/odata/rdev___events_log",n)}catch(a){console.log(a),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}};function D(e,t){return q.apply(this,arguments)}function q(){return(q=Object(m.a)(p.a.mark((function e(t,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:n});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){return M.apply(this,arguments)}function M(){return(M=Object(m.a)(p.a.mark((function e(t,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return P.apply(this,arguments)}function P(){return(P=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:{}},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){null!=window.activeRecord?this.setState({activeRecord:window.activeRecord}):this.setState({activeRecord:{reccode:null,reccreated:"2020-10-20T11:38:42.320928+08:00",reccreatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",recdescription:null,recid:"9f46e82c-f027-49d3-b81c-f032f869c25a",recname:null,recstate:1,recupdated:"2020-10-23T00:49:34.77997+08:00",recupdatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",sysboolean_test:!1,sysdate_test:null,sysdecimal_test:null,sysenum_test:1,sysfile_test:null,sysimage_test:"",sysint_test:null,sysmoney_test:0,sysnumber_test:"\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0423\u0418\u041d",sysstring_test:"",systime_test:null,systimedate_test:null}})}},{key:"render",value:function(){return r.a.createElement(L,{method:{name:"test_procedure_update",displayName:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",isEnabled:null,isAnonymous:!1,static:!1,fields:[{name:"uin_field",type:"SysString",typeName:"SysString",displayName:"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0423\u0418\u041d",displaySize:null,autoFocus:!0,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"count_field",type:"SysInt",typeName:"SysInt",displayName:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"parttype_field",type:"SysRelation",typeName:"SysRelation",displayName:"\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u0435\u0439",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null}],showModalYesNo:null,initMethodParams:null,isPacketSigned:null,workflow:null,table:"types_table"},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},activeRecord:this.state.activeRecord,initialValues:{count_field:1}})}}]),n}(a.Component),L=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={},e.renderField=e.renderField.bind(Object(h.a)(e)),e.getInitialValues=e.getInitialValues.bind(Object(h.a)(e)),e.renderKeyElementTemplateSelect=e.renderKeyElementTemplateSelect.bind(Object(h.a)(e)),e.handleClick=e.handleClick.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"getInitialValues",value:function(){var e=this,t={};return this.props.method.fields.forEach((function(n){if(null!=e.props.initialValues){console.log(e.props.initialValues[n.name]);var a=void 0!==B[n.type]?B[n.type]:"";if(n.default){var r="var activeRecord = ".concat(JSON.stringify(e.props.initialValues),"; var result = ").concat(n.default,"(); return result;");a=new Function(r)()}t[n.name]=null!=e.props.initialValues[n.name]?e.props.initialValues[n.name]:a}else t[n.name]=B[n.type]})),t}},{key:"renderField",value:function(e,t,n){var a,s=this,l=Object.assign({},t);e.name=e.name.toLowerCase(),e.table=this.props.method.table,e.autoFocus=null!==(a=e.autoFocus)&&void 0!==a&&a;var o=z[e.type]||w;return r.a.createElement(g.a,{key:e.name.toLowerCase(),name:e.name.toLowerCase(),validate:n},(function(t){var n=t.formikfield;t.form;return r.a.createElement(o,Object.assign({field:e,setFieldValue:s.props.setFieldValue,onBlur:l.handleBlur,activeRecord:s.props.activeRecord},l,n))}))}},{key:"renderKeyElementTemplateSelect",value:function(e,t,n){var s=this,l=Object.assign({},t);return r.a.createElement(a.Fragment,null,r.a.createElement(g.a,{key:e.name.toLowerCase(),name:e.name.toLowerCase()},(function(t){t.formikfield,t.form;return r.a.createElement(N,{value:s.props,field:e.name.toLowerCase(),setFieldValue:function(e,t){l.setFieldValue(e,t),s.uinField.focus()},key:e.name.toLowerCase()})})))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",initialValues:this.getInitialValues(),enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0423\u0418\u041d"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleClick,color:"primary",type:"submit",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:e.props.method.fields[0].name.toLowerCase(),name:e.props.method.fields[0].name.toLowerCase()},(function(){return r.a.createElement(w,{field:e.props.method.fields[0],setFieldValue:t.setFieldValue,setFieldTouched:t.setFieldTouched,onBlur:t.handleBlur,activeRecord:e.props.activeRecord,ref:function(t){e.uinField=t},countField:t.values.count_field})})),r.a.createElement(_.a,null,r.a.createElement(y.a,{xs:12,md:8},e.renderKeyElementTemplateSelect(e.props.method.fields[2],t)),r.a.createElement(y.a,{xs:12,md:4},r.a.createElement(g.a,{key:e.props.method.fields[1].name.toLowerCase(),name:e.props.method.fields[1].name.toLowerCase(),validate:e.validateCount},(function(){return r.a.createElement(S,{field:e.props.method.fields[1],onBlur:t.handleBlur,activeRecord:e.props.activeRecord,errors:t.errors[e.props.method.fields[1]],touched:t.touched[e.props.method.fields[1]],uinField:t.values.uin_field,setFieldValue:function(n,a){console.log("PluginNumber setvalue2",e.uinField),t.setFieldValue(n,a),void 0!=e.uinField&&null!=e.uinField&&(setTimeout((function(){e.uinField.focus()}),1),console.log("PluginNumber setvalue1",e.uinField))}})})))))}}))}},{key:"validateCount",value:function(e){var t;return(e<1||e>400)&&(t="\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0447\u0438\u0441\u043b\u043e \u043e\u0442 1 \u0434\u043e 400"),t}},{key:"handleClick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.refs.formik.state.values,console.log("values",t),n="",this.isNullObject(t.parttype_field)&&(n=String().concat(n,"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u0435\u0439.")),(null==t.count_field||t.count_field<1||t.count_field>400)&&(n=String().concat(n," ","\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0438\u0441\u043b\u0430 \u043e\u0442 1 \u0434\u043e 400.")),this.isEmptyString(t.uin_field)&&1==t.count_field&&(n=String().concat(n," ","\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0423\u0418\u041d.")),!this.isNotEmptyString(n)){e.next=10;break}return e.abrupt("return",T(!1,n));case 10:return a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({template:t.parttype_field.recid,count:t.count_field,uin:t.uin_field})},console.log("requestBody",a),e.next=14,D("/plugins/nbdlogicplugin/masscreatekeyelementsdraft",a.body);case 14:if(r=e.sent,console.log("result_replace_resp",r),!r.success){e.next=22;break}return window.closePluginModal(),1==t.count_field&&null!=r.data&&window.open("/tables/reestr_key_elements/".concat(r.data.recid),"_self"),e.abrupt("return",T(!0,"".concat(r.message)));case 22:return e.abrupt("return",T(!1,"".concat(r.message)));case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isEmptyString",value:function(e){return null==e||"undefined"===e||""===e||0===e.length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotNullObject",value:function(e){return null!=e&&"undefined"!==e&&e&&0!==Object.keys(e).length}},{key:"isEmptyOrNullArray",value:function(e){return!e||null==e||"undefined"===e||e.length<=0}},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}}]),n}(r.a.Component),z={SysString:w,SysInt:S,SysBoolean:x,SysNumber:S,SysRelation:N},B={SysGUID:"",SysString:"",SysMultiLineString:"",SysBoolean:!1,SysNumber:null,SysInt:null,SysMoney:0,SysDecimal:null,SysENUM:null,SysRelation:null},G=(n(566),a.Component,n(1164)),$=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t=""===e.target.value?null:e.target.value;(""===e.target.value||/^-?[0-9\b]*$/.test(e.target.value))&&(a.props.setFieldValue(a.props.field.name,t),a.props.updateData(t),a.setState({isValid:t>=1&&t<=400}))},a.state={isValid:!0},a}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},!this.props.field.isPasported&&this.props.field.isUinDataEmpty&&this.props.field.isAssemblyElement?r.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(E.a,{type:"number",name:this.props.field.name,onChange:this.handleChange,value:this.props.field.count,defaultValue:1,invalid:!this.state.isValid}),!this.state.isValid&&r.a.createElement(G.a,null,"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0446\u0438\u0444\u0440\u044b \u043e\u0442 1 \u0434\u043e 400")):r.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(E.a,{type:"number",name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,value:1,disabled:!0}))}}]),n}(a.Component),U=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){console.log(t.target.value),e.props.updateUinFieldValue(t.target.value),e.props.setFieldValue(e.props.field.name,t.target.value),e.props.updateUinFieldState(""==t.target.value||null==t.target.value),e.props.updateUinState()},e}return Object(i.a)(n,[{key:"focus",value:function(){this.refInput.focus()}},{key:"render",value:function(){var e=this;return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(k.a,null,r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement("input",{name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,value:this.props.field.value,defaultValue:"",disabled:this.props.field.isDisabled,autoFocus:this.props.field.autoFocus||!1,ref:function(t){e.refInput=t},className:"form-control"}))}}]),n}(a.Component),K=n(62),J=(n(567),n(84)),W=n(1170),H=n(1165),Z=n(1166),Y=n(1167);function X(e){var t=["A","C","E","T","B","M","H","K","P","O","X"],n=["\u0410","\u0421","\u0415","\u0422","\u0412","\u041c","\u041d","\u041a","\u0420","\u041e","\u0425"],a="";e=e.toUpperCase();for(var r=0;r<e.length;r++){var s=n.indexOf(e[r]);a+=-1!=s?t[s]:e[r]}return a}var Q=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),null!=e&&e.length>a.state.options.length&&a.handleNewOptionClick(e[e.length-1]);var t=e.map((function(e){return{number:e.number,position:e.position}}));a.props.setFieldValue(a.props.field.name,JSON.stringify(t))},a.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),n=X(t.value),a.setState({isLoadingDetail:!0}),e.next=5,a.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(n,"')"));case 5:if(r=e.sent,!a.isNullOrEmptyResponse(r)){e.next=8;break}return e.abrupt("return",a.modalError("\u0423\u0418\u041d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435"));case 8:return s=r.value[0],e.next=11,a.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(s.recid,")"));case 11:return l=e.sent,e.next=14,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(s.recid,")"));case 14:if(o=e.sent,!a.isNullOrEmptyResponse(o)||!a.isNullOrEmptyResponse(l)){e.next=17;break}return e.abrupt("return",a.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 17:if((i=a.state.addedItems).push(n),!(null!=a.state.options&&a.state.options.length>0)){e.next=24;break}if(c=Object(C.a)(a.state.options),null==c.find((function(e){return e.numberValue==n}))){e.next=24;break}return e.abrupt("return",a.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 24:if(a.isNullOrEmptyResponse(l)||!a.isNullOrEmptyResponse(o)){e.next=31;break}return u=l.value[0],e.next=28,a.defineKeyElementPositions(u);case 28:a.setState({addedItems:i}),e.next=36;break;case 31:if(a.isNullOrEmptyResponse(o)){e.next=36;break}return d=o.value[0],e.next=35,a.defineAssemblyElementPositions(d);case 35:a.setState({addedItems:i});case 36:a.props.updateUinElementsFieldState(0==a.state.addedItems.length||null==a.state.addedItems),a.props.updateUinState();case 38:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.prepareValue=function(){return a.props.value instanceof Array?a.props.value[0]:a.props.value},a.state={selectedTemplate:a.props.field.selectedTemplate,options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null},a.handleNewOptionClick=a.handleNewOptionClick.bind(Object(h.a)(a)),a.getOptions=a.getOptions.bind(Object(h.a)(a)),a.handleModalChange=a.handleModalChange.bind(Object(h.a)(a)),a.renderDeleteConfirm=a.renderDeleteConfirm.bind(Object(h.a)(a)),a.handleOkModal=a.handleOkModal.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"focus",value:function(){this.refInput.focus()}},{key:"componentWillReceiveProps",value:function(e){e.field.selectedTemplate!==this.state.selectedTemplate&&this.setState({selectedTemplate:e.field.selectedTemplate,options:[]})}},{key:"assemblyElementAlreadyExist",value:function(e,t){return 0==e.length||null==e.find((function(e){return null!=e.node&&null!=t&&e.node==t}))}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&T(!1,e)}},{key:"defineKeyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v,E,O,x,S,w,C,j,A,N,R,D=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,a=null,r=null,s=null,null==t.ke_node||""==t.ke_node){e.next=18;break}return e.next=7,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.ke_node,")"));case 7:if(l=e.sent,!this.isNullOrEmptyResponse(l)){e.next=10;break}return e.abrupt("return");case 10:if(n=l.value[0],a=n.recid,r=n.ke_node_type,s=t.position_on_node,!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,a)){e.next=16;break}return e.abrupt("return",this.modalError("\u0423\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0444\u043e\u0440\u043c\u0443."));case 16:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o||null==s){e.next=18;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 18:return o=t.key_element_code,t.documentation_number_calculated,this.setState({currentElement:t,currentElementType:"keyElement"}),e.next=23,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(this.props.field.options.recid,")"));case 23:if(i=e.sent,!this.isNullOrEmptyResponse(i)){e.next=26;break}return e.abrupt("return");case 26:return c=i.value[0],u=c.ke_node_type,e.next=30,this.checkAssemblyElementCompositionAsync(t,n,u);case 30:if((d=e.sent).success){e.next=33;break}return e.abrupt("return",this.modalError(d.message));case 33:if(null!=a&&""!=a){e.next=99;break}return m=null!=u&&""!=u?" and (node_type eq ".concat(u,")"):"",e.next=37,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(o,")").concat(m));case 37:if(h=e.sent,f=h.value,b=[],_=[],"477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"34c12f72-eb33-4ab1-ba3e-a80166258e5d"!=o&&"ff1d8011-75dc-4d30-832f-f47c3d5ac430"!=o&&"4aed23f8-9710-4904-a2f5-b89d9bc7c75c"!=o&&"975cd310-7675-4436-899f-4c6b84555f6a"!=o&&"38dd229a-915f-49ef-bba8-a28f055c9962"!=o||0!=f.length){e.next=45;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 45:if("e4ef0365-0365-40df-ab4e-a77104c352df"!=o){e.next=87;break}if(t.has_rough_axis_number){e.next=50;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 50:return e.next=52,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(ke_node_type eq ".concat(u,") and (scheme eq ").concat(c.documentation,")"));case 52:if(y=e.sent,!this.isNullOrEmptyResponse(y)){e.next=55;break}return e.abrupt("return",this.modalError('\u0414\u043b\u044f \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0443\u0437\u043b\u0430/\u0421\u0415 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0441\u043f\u0440\u0430\u0432\u043e\u043d\u0438\u043a\u0435 "\u041a\u043e\u043b-\u0432\u043e \u0421\u0427/\u0421\u0415 \u0432 \u0421\u0415/\u0443\u0437\u043b\u0435".'));case 55:if(null!=(g=y.value[0]).rough_axis_count&&0!=g.rough_axis_count){e.next=60;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 60:if(k=null,!t.has_rough_axis_number){e.next=69;break}if(null!=t.rough_axis&&""!=t.rough_axis){e.next=64;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u041e\u0441\u0438 \u0447\u0438\u0441\u0442\u043e\u0432\u043e\u0439 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0443\u044e."));case 64:return e.next=66,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(t.rough_axis,")"));case 66:if(null!=(k=e.sent)){e.next=69;break}return e.abrupt("return",this.modalError("\u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0430\u044f \u0432 \u043e\u0441\u0438 \u0447\u0438\u0441\u0442\u043e\u0432\u043e\u0439, \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 69:if(null==t.blockchainhash||""==t.blockchainhash||null!=k.blockchainhash&&""!=k.blockchainhash){e.next=71;break}return e.abrupt("return",this.modalError("\u041d\u0435\u043b\u044c\u0437\u044f \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u041e\u0441\u044c \u0447\u0438\u0441\u0442\u043e\u0432\u0443\u044e \u0441 \u0423\u0418\u041d ".concat(t.numberke,", \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u0430\u044f \u0441 \u043d\u0435\u0439 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f \u0441 \u0423\u0418\u041d ").concat(k.numberke," \u043d\u0435 \u0432\u044b\u043f\u0443\u0449\u0435\u043d\u0430 \u0432 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435.")));case 71:if(null!=t.blockchainhash&&""!=t.blockchainhash){e.next=75;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return",T(!0,"\u0421\u0427 \u041e\u0441\u044c \u0447\u0438\u0441\u0442\u043e\u0432\u0430\u044f \u0441 \u0423\u0418\u041d ".concat(t.numberke," \u043d\u0435 \u0432\u044b\u043f\u0443\u0449\u0435\u043d \u0432 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0439 \u0441 \u043d\u0438\u043c \u0421\u0427 \u041e\u0441\u044c \u0427\u0435\u0440\u043d\u043e\u0432\u0430\u044f c \u0423\u0418\u041d ").concat(k.numberke," \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d.")));case 75:if(null==t.blockchainhash||""==t.blockchainhash||null==k.blockchainhash||""==k.blockchainhash){e.next=84;break}if(v=this.props.refComponentDataGrid.getStateTableData(),null!=v.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=82;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 82:return e.next=84,this.updateStateTable("add",{value:k.recid,number:k.recid,numberValue:k.numberke,node:null,nodeObj:k,isKeyElement:!0});case 84:return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 87:if("a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o){e.next=89;break}return e.abrupt("return",this.modalError("\u041d\u0435\u043b\u044c\u0437\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0421\u0427 \u0442\u0438\u043f\u0430 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f."));case 89:if(this.state.options.length>0)for(E=0;E<this.state.options.length;E++)_.push(this.state.options[E].position);if((b=_.length>0?f.filter((function(e){return null==_.find((function(t){return t==e.recid}))})):f).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),1!=b.length){e.next=96;break}return this.setState({modalItems:b,modalValue:b[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 96:this.setState({modalItems:b,modalValue:""}),e.next=148;break;case 99:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o){e.next=101;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 101:if(m=null!=r&&""!=r?" and (parent_node_type eq ".concat(u,")"):"",O="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=u){e.next=109;break}return e.next=106,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(c.documentation,") and\n\t\t\t\t\t\t(ke_node_type eq ").concat(u,")"));case 106:x=e.sent,S=x.value[0],O=S.slider_body_count>2&&S.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 109:return e.next=111,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=(key_element_code eq ".concat(o,") and (child_node_type eq ").concat(r,")").concat(m).concat(O));case 111:if(w=e.sent,C=w.value,j=[],j=C.filter((function(e){return e.position_on_node==s})),A=j.map((function(e){return e.alternative_position})),[],C.filter((function(e){return null!=A.find((function(t){return t==e.recname}))})).map((function(e){null==j.find((function(t){return t.recid==e.recid}))&&j.push(e)})),_=[],b=[],!(this.state.options.length>0)){e.next=136;break}E=0;case 123:if(!(E<this.state.options.length)){e.next=136;break}if(this.state.options[E].isKeyElement){e.next=132;break}return e.next=127,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t\t\t\t\t\t(child_node_type eq ".concat(this.state.options[E].nodeObj.ke_node_type,") \n\t\t\t\t\t\t\t\tand (node_position eq ").concat(this.state.options[E].position,")").concat(O));case 127:w=e.sent,(N=w.value).length>0&&N.forEach((function(e){_.push(e.recid)})),e.next=133;break;case 132:_.push(this.state.options[E].position);case 133:E++,e.next=123;break;case 136:if(b=_.length>0?j.filter((function(e){return null==_.find((function(t){return t==e.recid}))})):j,R=[],this.state.options.length>0)for(E=0;E<this.state.options.length;E++)null!=this.state.options[E].node&&this.state.options[E].node!=a&&null!=this.state.options[E].positionObj&&null!=this.state.options[E].positionObj.child_node_type&&null!=(R=b.filter((function(e){return e.parent_node_type==u&&e.node_position==D.state.options[E].positionObj.node_position&&e.child_node_type==D.state.options[E].positionObj.child_node_type})))&&R.length>0&&(b=b.filter((function(e){return null==R.find((function(t){return t.recid==e.recid}))})));if(b.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),!(b.length<=1)){e.next=146;break}return this.setState({modalItems:b,modalValue:b[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 146:this.setState({modalItems:b,modalValue:""});case 147:this.setState({modalItems:b,modalValue:""});case 148:this.setState({showModal:!0});case 149:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"defineAssemblyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({currentElement:t,currentElementType:"assemblyElement"}),!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,t.recid)){e.next=3;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t.unique_number," \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0432 \u0444\u043e\u0440\u043c\u0443.")));case 3:return e.next=5,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types(".concat(t.ke_node_type,")"));case 5:if(n=e.sent,console.log("ddd",n),!n.is_variable){e.next=9;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0421\u0427."));case 9:return console.log("assemblyUnit",t),e.next=12,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(this.props.field.options.recid,")"));case 12:if(a=e.sent,!this.isNullOrEmptyResponse(a)){e.next=15;break}return e.abrupt("return");case 15:if(r=a.value[0],s=r.ke_node_type,l="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=s){e.next=24;break}return e.next=21,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(r.documentation,") and\n\t\t\t\t(ke_node_type eq ").concat(s,")"));case 21:o=e.sent,i=o.value[0],l=i.slider_body_count>2&&i.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 24:return e.next=26,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n.recid,") and \n\t\t\t(parent_node_type eq ").concat(s,") ").concat(l));case 26:return c=e.sent,u=c.value,console.log("aaaa",u),e.next=31,this.checkAssemblyElementCompositionAsync(null,t,s);case 31:if((d=e.sent).success){e.next=34;break}return e.abrupt("return",this.modalError(d.message));case 34:m=[],h=[],f=[],b=Object(K.a)(u),e.prev=38,b.s();case 40:if((_=b.n()).done){e.next=49;break}if(null==(y=_.value).node_position||null!=m.find((function(e){return e.recid==y.node_position}))){e.next=47;break}return e.next=45,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recid eq ".concat(y.node_position,")"));case 45:g=e.sent,this.isNullOrEmptyResponse(g)||m.push(g.value[0]);case 47:e.next=40;break;case 49:e.next=54;break;case 51:e.prev=51,e.t0=e.catch(38),b.e(e.t0);case 54:return e.prev=54,b.f(),e.finish(54);case 57:if(this.state.options.length>0)for(k=0;k<this.state.options.length;k++)(v=this.state.options[k]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n.recid&&h.push(v.positionObj.node_position):null!=v.position&&n.recid==v.nodeObj.ke_node_type&&h.push(v.positionObj.recid);if(!(h.length>0)){e.next=64;break}if(0!=(f=m.filter((function(e){return null==h.find((function(t){return t==e.recid}))}))).length){e.next=62;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415."));case 62:e.next=65;break;case 64:f=m;case 65:if(0!=f.length){e.next=69;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 69:if(f.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),!(f.length<=1)){e.next=76;break}return this.setState({modalItems:f,modalValue:f[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 76:this.setState({modalItems:f,modalValue:""});case 77:this.setState({modalItems:f,modalValue:""}),this.setState({showModal:!0});case 79:case"end":return e.stop()}}),e,this,[[38,51,54,57]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOkModal",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleOkModal_",this),console.log("handleOkModal__",this.state),t=this.state.options,console.log("handleOkModal",t),c=!1,"keyElement"==this.state.currentElementType?(null==this.state.modalValue||""==this.state.modalValue?n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated):(n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),a=this.state.modalValue.recid,r=this.state.modalValue),s=null!=this.state.currentElement.ke_node&&""!=this.state.currentElement.ke_node?this.state.currentElement.ke_node:null,u=this.state.currentElement.numberke,l=this.state.currentElement.recid,o=null!=s?"#4bf1547d":"#ebf5ff",i=null!=s?"#027707":"#007eff",c=!0):"numberkeConfirm"==this.state.currentElementType?(console.log(this.state),null!=this.state.modalValue&&""!=this.state.modalValue||(n="".concat(this.state.currentElement)),u=this.state.currentElement,c=!0):(null==this.state.modalValue||""==this.state.modalValue?n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated):(n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),a=this.state.modalValue.recid,r=this.state.modalValue),u=this.state.currentElement.unique_number,s=this.state.currentElement.recid,l=this.state.currentElement.recid,o="#4bf1547d",i="#027707"),console.log("handleOkModal2",t),t.push({value:"".concat(this.state.currentElement.recid),label:n,position:a,positionObj:r,number:l,numberValue:u,backgroundColor:o,color:i,node:s,nodeObj:this.state.currentElement,isKeyElement:c}),console.log("handleOkModal3",t),this.setState({options:t,showModal:!1,isLoadingDetail:!1,modalValue:""}),console.log("handleOkModal4",t),d=t.map((function(e){return{number:e.number,position:e.position,numberValue:e.numberValue}})),this.props.setFieldValue(this.props.field.name,JSON.stringify(d)),e.next=15,this.updateStateTable("add");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,console.log("getAssemblyElementPattern",a.length),e.abrupt("return",a.length>0?a[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllNodePositions();case 2:if(a=e.sent,console.log("this_update_state_table",this),null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),r=this.props.refComponentDataGrid.getStateTableData()),s=null,l=null,o=null,null!=n?l=n:(console.log("add",this.state.options.length),"add"==t?l=this.state.options[this.state.options.length-1]:"delete"==t&&(l=this.state.itemForDelete)),null!=l){e.next=11;break}return e.abrupt("return");case 11:if(i=null,c=null,null==this.props.field.options.recid){e.next=21;break}return e.next=16,this.getAssemblyElementPattern(this.props.field.options.recid);case 16:if(null!=(u=e.sent)&&null!=u.ke_node_type&&null!=u.documentation){e.next=19;break}return e.abrupt("return");case 19:i=u.ke_node_type,c=u.documentation;case 21:if(null!=(s=l.isKeyElement?null!=l.node?r.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==l.positionObj.child_node_type})):r.find((function(e){return null!=e.keyElementTypeId&&e.keyElementTypeId==l.nodeObj.key_element_code})):r.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==l.nodeObj.ke_node_type})))){e.next=24;break}return e.abrupt("return");case 24:if("delete"!=t||0!=s.usedPositionsCount){e.next=26;break}return e.abrupt("return");case 26:if(null==s.assemblyElementTypeId){e.next=32;break}return e.next=29,this.getAvailablePositionsByAssemblyElementOnAssemblyElement(i,s.assemblyElementTypeId,c,a);case 29:o=e.sent,e.next=36;break;case 32:if(null==s.keyElementTypeId){e.next=36;break}return e.next=35,this.getAvailablePositionsByKeyElementOnAssemblyElement(i,s.keyElementTypeId);case 35:o=e.sent;case 36:d=r.indexOf(s),"add"==t?s.usedPositionsCount=s.usedPositionsCount+1:"delete"==t&&(s.usedPositionsCount=s.usedPositionsCount-1),s.isFull=s.usedPositionsCount===s.positionsCount,s.assemblyElementCountStr=s.usedPositionsCount+" \u0438\u0437 "+s.positionsCount,null!=o&&o.length>0?(h=o.map((function(e){return e.recname})),m=h.join(", ")):m=null,s.assemblyElementAvailablePositions=m,r[d]=s,null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),r=this.props.refComponentDataGrid.setStateTableData(r));case 44:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(n,")").concat(a));case 3:if(r=e.sent,s=r.value,console.log("allPositionsResp",s.length),null!=s||0!=s.length){e.next=8;break}return e.abrupt("return",null);case 8:for(l=[],o=[],null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),i=this.props.refComponentDataGrid.state.childKeyElements),console.log("installedKeyElements",this.state),c=0;c<i.length;c++)null!=i[c].position_on_node&&l.push(i[c].position_on_node);if(console.log("installedKeyElements",this.state.options),this.state.options.length>0)for(c=0;c<this.state.options.length;c++)l.push(this.state.options[c].position);return(o=l.length>0?s.filter((function(e){return null==l.find((function(t){return t==e.recid}))})):s).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(a,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:l=e.sent,o=l.value[0],s=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(s));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(K.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=r.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(console.log("allPositionsOnNode",u.length),null!=u||0!=u.length){e.next=19;break}return e.abrupt("return",null);case 19:for(null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),y=this.props.refComponentDataGrid.state.childAssemblyElements),console.log("alreadyInstalledNodes",y.length),g=0;g<y.length;g++)null!=(k=y[g]).position_on_assembly_element&&d.push(k.position_on_assembly_element);if(console.log("athis.state.optionsaa",this.state.options),this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(v=this.state.options[g]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n&&d.push(v.positionObj.node_position):null!=v.position&&n==v.nodeObj.ke_node_type&&d.push(v.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"checkAssemblyElementCompositionAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a){var r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=9;break}return e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(a,") and (child_assembly_element eq ").concat(n.ke_node_type,")"));case 3:if(r=e.sent,null!=(s=r.value)&&0!=s.length){e.next=7;break}return e.abrupt("return",{success:!1,message:"\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 "+n.unique_number+" ("+n.ke_node_type_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430."});case 7:e.next=15;break;case 9:return e.next=11,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(a,") and (child_key_element eq ").concat(t.key_element_code,")"));case 11:if(r=e.sent,null!=(s=r.value)&&0!=s.length){e.next=15;break}return e.abrupt("return",{success:!1,message:"\u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c "+t.numberke+" ("+t.key_element_code_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430."});case 15:return e.abrupt("return",{success:!0,message:null});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getOptions",value:function(){var e=this;this.setState({isLoading:!0}),fetch("/odata/$metadata/".concat(this.props.field.relation.table),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){var n=t.fieldGroups.autoLookup.fields.map((function(e){return e.name.toLowerCase()})),a=e.props.field.relation,r=a.field,s=a.displayField;null==r&&(r="recid"),null==s&&(s="recname"),null==n.find((function(e){return e==s.toLowerCase()}))&&n.push(s.toLowerCase());var l="",o=!1;if(null!=e.props.field.lookup){var i=e.props.field.lookup.field,c=e.props.activeRecord[i];l="$filter=(".concat(i," eq '").concat(c,"')"),-1==n.findIndex((function(e){return e==i}))&&(n.push(i),o=!0)}fetch("/odata/".concat(e.props.field.relation.table,"?").concat(l,"&$select=").concat(n.join(",")),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){o&&(n=n.filter((function(t){return t!=e.props.field.lookup.field}))),-1==t.value.findIndex((function(t){return t.recid==e.props.value}))&&e.props.setFieldValue(e.props.field.name,null);var a=t.value.map((function(e){return{id:e[r.toLowerCase()],value:n.filter((function(e){return"recid"!=e})).map((function(t){return e[t]})).join(", ")}})).sort((function(e,t){return e.value<t.value?-1:e.value>t.value?1:0}));e.setState({options:a,isLoading:!1,isLoadingDetail:!1})}))}))}},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(C.a)(this.state.options),-1!==(a=n.indexOf(t))&&(n.splice(a,1),this.setState({options:n}),this.props.setFieldValue(this.props.field.name,JSON.stringify(n))),this.setState({showDeleteModal:!1}),r=Object(C.a)(this.state.addedItems),s=r.find((function(e){return e==t.numberValue})),-1!==(l=r.indexOf(s))&&(r.splice(l,1),this.setState({addedItems:r}),this.props.updateUinElementsFieldState(0==r.length||null==r),this.props.updateUinState()),!(o=this.state.itemForDelete).isKeyElement||"e4ef0365-0365-40df-ab4e-a77104c352df"!=o.nodeObj.key_element_code){e.next=24;break}if(null==this.props.refComponentDataGrid){e.next=15;break}if(console.log("refComponentDataGrid",this.props.refComponentDataGrid),null!=(i=this.props.refComponentDataGrid.getStateTableData(i))||0!=i.length){e.next=15;break}return e.abrupt("return");case 15:if(null==i.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=24;break}if(!o.nodeObj.has_rough_axis_number||null==o.nodeObj.rough_axis||""==o.nodeObj.rough_axis){e.next=24;break}return e.next=20,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(o.nodeObj.rough_axis,")"));case 20:if(null==(c=e.sent)){e.next=24;break}return e.next=24,this.updateStateTable("delete",{value:c.recid,number:c.recid,numberValue:c.numberke,node:null,nodeObj:c,isKeyElement:!0});case 24:return e.next=26,this.updateStateTable("delete");case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return a.createElement(W.a,{isOpen:this.state.showDeleteModal,size:"xl"},a.createElement(H.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),a.createElement(Z.a,null,a.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),a.createElement(Y.a,null,a.createElement(b.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),a.createElement(b.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},a.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;console.log("render_creatable",this.props);return a.createElement(k.a,null,a.createElement(v.a,null,a.createElement("b",null,this.props.field.displayName)),a.createElement(J.a,{ref:function(t){e.refInput=t},name:this.props.field.name,components:{MultiValue:function(t){var n={backgroundColor:t.data.backgroundColor,color:t.data.color};return a.createElement("div",{className:"SelectValue",style:n},a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t.data)}},"\xd7"),a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.options,isMulti:!0,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.props.field.isDisabled||this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}),a.createElement(W.a,{isOpen:this.state.showModal,toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},a.createElement(H.a,{toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),a.createElement(Z.a,null,a.createElement(f.a,null,a.createElement(b.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal,style:{width:"124px",height:"32px"}},a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",a.createElement(b.a,{size:"sm",onClick:function(){return e.setState({showModal:!1,modalItems:[],isLoadingDetail:!1})},style:{width:"103.63px",height:"32px"}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),a.createElement("hr",null),a.createElement(v.a,null,"\u041d\u043e\u043c\u0435\u0440"),a.createElement(E.a,{id:"number",value:"keyElement"==this.state.currentElementType?this.state.currentElement.ke_number_calculated:this.state.currentElement.unique_number,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),a.createElement(E.a,{id:"element_name",value:"keyElement"==this.state.currentElementType?this.state.currentElement.key_element_code_calculated:this.state.currentElement.ke_node_type_calculated,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),a.createElement(j.a,{name:"testname",options:this.state.modalItems,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",getOptionLabel:function(e){return e.recname},getOptionValue:function(e){return e.recid},onChange:this.handleModalChange,value:this.state.modalValue,onValueClick:function(e){return T(!0,e.value)},styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}))),this.renderDeleteConfirm())}}]),n}(a.Component),ee=n(43),te=n.n(ee),ne=n(1168),ae=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).onCellPrepared=function(e){console.log(e.data),"data"===e.rowType&&null!=e.data&&(e.cellElement.style.backgroundColor=e.data.positionsCount==e.data.usedPositionsCount?"rgb(91, 223, 127)":"rgb(222, 91, 91)")},a.state={options:[],selectedRowNotes:"",data:[],uin:"",elements_in_vagon:{},select_element:{},is_circ:!1,visible_alert:!1,name_old_element:"",name_new_element:null,elementType:"",assemblyElementPatternId:null,stateTableLoaded:!1,stateTableLoading:!1,childKeyElements:[],childAssemblyElements:[]},a.loadStateTable=a.loadStateTable.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount",this.props),console.log("this_componentDidMount",this),e.next=4,this.loadStateTable();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("componentDidUpdate",this),this.props.ref=this,this.state.assemblyElementPatternId==this.props.field.data){e.next=11;break}if(this.state.stateTableLoaded||this.state.stateTableLoading||null==this.props.field.data){e.next=7;break}return e.next=6,this.loadStateTable();case 6:return e.abrupt("return");case 7:if(!this.state.stateTableLoaded||this.state.stateTableLoading||this.state.assemblyElementPatternId!=this.props.field.data==null){e.next=11;break}return e.next=10,this.loadStateTable();case 10:return e.abrupt("return");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v,E,O;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadStateTable",this.props),this.setState({stateTableLoading:!0}),this.props.updateStateTableLoading(!0),t="assemblyElement",this.setState({elementType:t}),e.next=7,this.getAllKeyElementTypes();case 7:return n=e.sent,e.next=10,this.getAllAssemblyElementTypes();case 10:return a=e.sent,e.next=13,this.getAllNodePositions();case 13:if(r=e.sent,s=[],"assemblyElement"!=t){e.next=81;break}return l=null,o=null,e.next=20,this.getAssemblyElementPattern(this.props.field.data);case 20:if(i=e.sent,console.log("assemblyElementPattern",i),this.setState({assemblyElementPatternId:i.recid}),null!=i&&null!=i.ke_node_type&&null!=i.documentation){e.next=29;break}return this.setState({stateTableLoading:!1,stateTableLoaded:!0}),this.props.updateStateTableLoading(!1),this.props.updateStateTableLoaded(!0),this.setStateTableData([]),e.abrupt("return");case 29:if(l=i.ke_node_type,o=i.documentation,null==l){e.next=81;break}return console.log("parentAssemblyElementTypeId",[l,o]),e.next=35,this.getAssemblyElementComposition(l,o);case 35:if(c=e.sent,console.log("assemblyElementComposition",c),console.log("assemblyElementComposition",c.length),0==c.length){e.next=81;break}return e.next=41,this.getChildKeyElementsByAssemblyElement(this.props.activeRecord.recid);case 41:return u=e.sent,e.next=44,this.getChildAssemblyElementsByAssemblyElement(this.props.activeRecord.recid);case 44:d=e.sent,this.state.childKeyElements=u,this.state.childAssemblyElements=d,m=0;case 48:if(!(m<c.length)){e.next=81;break}if(console.log("assemblyElementComposition2",c),console.log("assemblyElementComposition2",c.length),h=c[m],f=null!=h.child_key_element,b=null!=h.child_assembly_element,!f){e.next=65;break}return t=n.find((function(e){return e.recid==h.child_key_element})),_=t.recname,y=u.filter((function(e){return e.key_element_code==h.child_key_element})),e.next=60,this.getAvailablePositionsByKeyElementOnAssemblyElement(l,h.child_key_element);case 60:g=e.sent,v=h.child_key_element,E=null,e.next=74;break;case 65:if(!b){e.next=74;break}return t=a.find((function(e){return e.recid==h.child_assembly_element})),_=t.recname,y=d.filter((function(e){return e.ke_node_type==h.child_assembly_element})),e.next=71,this.getAvailablePositionsByAssemblyElementOnAssemblyElement(l,h.child_assembly_element,o,r);case 71:g=e.sent,v=null,E=h.child_assembly_element;case 74:console.log("availablePositions",g.length),console.log("childElements",y.length),null!=g&&g.length>0?(O=g.map((function(e){return e.recname})),k=O.join(", ")):k=null,h.count&&h.count>0&&(s.push({keyElementTypeId:v,assemblyElementTypeId:E,positionsCount:h.count,usedPositionsCount:y.length,isFull:h.count===y.length,number:m+1,assemblyElementName:_,assemblyElementCountStr:y.length+" \u0438\u0437 "+h.count,assemblyElementAvailablePositions:k}),this.setStateTableData(s));case 78:m++,e.next=48;break;case 81:null!=s&&s.length>0?(this.setState({stateTableLoaded:!0}),this.props.updateStateTableLoaded(!0)):(this.setStateTableData([]),this.setState({stateTableLoaded:!1}),this.props.updateStateTableLoaded(!1)),this.setState({stateTableLoading:!1}),this.props.updateStateTableLoading(!1);case 84:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllKeyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_key_elements_codes?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllAssemblyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a.length>0?a[0]:null);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChildAssemblyElementsByAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAssemblyElementComposition",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(t,") and (documentation_number eq ").concat(n,")"));case 2:return a=e.sent,r=a.value,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getChildKeyElementsByAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_node eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(n,")").concat(a));case 3:if(r=e.sent,s=r.value,console.log("allPositions",s),null!=s||0!=s.length){e.next=8;break}return e.abrupt("return",null);case 8:for(l=[],o=[],console.log("allPositions2",s),i=this.state.childKeyElements,console.log("installedKeyElements",i),c=0;c<i.length;c++)null!=i[c].position_on_node&&l.push(i[c].position_on_node);if(this.state.options.length>0)for(c=0;c<this.state.options.length;c++)l.push(this.state.options[c].position);return(o=l.length>0?s.filter((function(e){return null==l.find((function(t){return t==e.recid}))})):s).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(a,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:l=e.sent,o=l.value[0],s=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(s));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(K.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=r.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(null!=u||0!=u.length){e.next=18;break}return e.abrupt("return",null);case 18:for(y=this.state.childAssemblyElements,g=0;g<y.length;g++)null!=(k=y[g]).position_on_assembly_element&&d.push(k.position_on_assembly_element);if(this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(v=this.state.options[g]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n&&d.push(v.positionObj.node_position):null!=v.position&&n==v.nodeObj.ke_node_type&&d.push(v.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){(console.log("setStateTableData",e),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance)&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(console.log("getStateTableData"),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"render",value:function(){return r.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},r.a.createElement(y.a,{md:"auto"},r.a.createElement(te.a,{preloadEnabled:!1,name:this.props.field.name,selection:{mode:"single"},showBorders:!0,showColumnLines:!1,showRowLines:!0,hoverStateEnabled:!0,columnAutoWidth:!0,onCellPrepared:this.onCellPrepared,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},r.a.createElement(ee.Column,{width:"3%",dataField:"number",caption:"#",dataType:"number"}),r.a.createElement(ee.Column,{width:"30%",dataField:"assemblyElementName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",dataType:"string"}),r.a.createElement(ee.Column,{width:"10%",dataField:"assemblyElementCountStr",caption:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"assemblyElementAvailablePositions",caption:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",dataType:"string"})),r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ne.a,{color:"success",isOpen:this.state.visible_alert},r.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),this.state.selectedRowNotes))))}},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,s,l,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedRowsData,"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0435\u0437 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445"!=(a=n[0]).nameke&&"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430"!=a.nameke&&"\u0422\u0435\u043b\u0435\u0436\u043a\u0430"!=a.nameke||(this.setState({is_circ:!0}),a.is_circ=!0),null==this.props.values.select_field.key_element_code){e.next=12;break}if(null==this.props.values.select_field.ke_node){e.next=11;break}return e.next=7,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.ke_node,")"));case 7:l=e.sent,s=r.a.createElement("b",null,l.value[0].ke_node_type_calculated," ",l.value[0].unique_number),e.next=12;break;case 11:s=r.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke);case 12:if(null==this.props.values.select_field.ke_node_type){e.next=21;break}if(null==this.props.values.select_field.parent_ke_node){e.next=20;break}return e.next=16,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.parent_ke_node,")"));case 16:o=e.sent,s=r.a.createElement("b",null,o.value[0].ke_node_type_calculated," ",o.value[0].unique_number),e.next=21;break;case 20:s=r.a.createElement("b",null,this.props.values.select_field.ke_node_type_calculated," ",this.props.values.select_field.unique_number);case 21:i=r.a.createElement("p",null,"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435 ",this.props.activeRecord.manufacturer_number," ",r.a.createElement("b",null,a.nameke," ",a.numberke)," \u043d\u0430 ",s),this.setState({visible_alert:!0,select_element:a,selectedRowNotes:i}),this.props.setFieldValue(this.props.field,a);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(a.Component),re=n(172),se=n.n(re),le=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),a.setState({selectedValue:e}),a.setState({option:e}),a.props.updateData(e,a.props.field.title)},a.handleChangeTemplate=function(e){console.log("handleChangeTemplate",e),a.setState({selectedValue:e}),a.props.setFieldValue(a.props.field,a.state.selectedValue),a.setState({option:e}),a.props.updateData(e)},a.state={option:"",currentElement:{},currentElementType:"",text_select:"",modalItems:[],selectedValue:""},a.getTemplates=a.getTemplates.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount"),e.next=3,this.getTemplates();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTemplates",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],"select_field"!=this.props.field.name){e.next=6;break}return e.next=4,fetch("/odata/reestr_ke_node_types?$select=recname,recid,ke_node_type,assembly_element_type_calculated&$orderBy=recname&$filter=recstate eq 1",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(r.isNullOrEmptyResponse(e))return console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b");r.setState({modalItems:e.value})})).then((function(){return fetch("/odata/reestr_ke_nodes?$top=10&$select=reestr_ke_node_type,recid&$filter=(recstate eq 1) and (reestr_ke_node_type ne null)&$orderBy=reccreated desc",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}})})).then((function(e){return e.json()})).then((function(e){if(r.isNotEmptyOrNullArray(e.value))for(var t=0;t<e.value.length;t++)if(null!=e.value[t].reestr_ke_node_type){var n=r.state.modalItems.find((function(n){return n.recid==e.value[t].reestr_ke_node_type.toString()}));r.handleChangeTemplate(n);break}})).catch((function(e){return console.log("Request failed: ",e)}));case 4:e.next=49;break;case 6:if("select_template_plate_field"!=this.props.field.name){e.next=17;break}return e.next=9,this.sendRequestAsync("/odata/reestr_parts_type?$select=template_name,recid,key_element_code&$orderBy=recname&$filter=(recstate eq 1) and (key_element_code eq 8d6deb72-5c2e-4294-a289-01bd8a1d7f2f)");case 9:if(n=e.sent,!this.isNullOrEmptyResponse(n)){e.next=12;break}return e.abrupt("return",console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 12:a=n.value,t=a,this.setState({modalItems:t}),e.next=49;break;case 17:if("select_template_insert_field"!=this.props.field.name){e.next=28;break}return e.next=20,this.sendRequestAsync("/odata/reestr_parts_type?$select=template_name,recid,key_element_code&$orderBy=recname&$filter=(recstate eq 1) and (key_element_code eq f8f1d758-81a5-493d-8e9d-d5b4166dd34e)");case 20:if(n=e.sent,!this.isNullOrEmptyResponse(n)){e.next=23;break}return e.abrupt("return",console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 23:a=n.value,t=a,this.setState({modalItems:t}),e.next=49;break;case 28:if("select_template_ring_field"!=this.props.field.name){e.next=39;break}return e.next=31,this.sendRequestAsync("/odata/reestr_parts_type?$select=template_name,recid,key_element_code&$orderBy=recname&$filter=(recstate eq 1) and (key_element_code eq 8cdec5a2-69ac-4dd9-8568-f53853b55f86)");case 31:if(n=e.sent,!this.isNullOrEmptyResponse(n)){e.next=34;break}return e.abrupt("return",console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 34:a=n.value,t=a,this.setState({modalItems:t}),e.next=49;break;case 39:if("select_application_number_field"!=this.props.field.name){e.next=49;break}return e.next=42,this.sendRequestAsync("/odata/rfid_request?$select=application_number,recid&$orderBy=application_number&$filter=(recstate eq 1) and (rfid_request_status eq 10)");case 42:if(n=e.sent,console.log("select_application_number_field",n),!this.isNullOrEmptyResponse(n)){e.next=46;break}return e.abrupt("return",console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 46:a=n.value,t=a,this.setState({modalItems:t});case 49:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}},{key:"sendRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});case 2:return n=e.sent,console.log(n),e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,null,r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(j.a,{id:this.props.field,name:this.props.field.name,label:this.props.field.displayName,onChange:this.props.isTemplate?this.handleChangeTemplate:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",options:this.state.modalItems,getOptionLabel:function(t){return"select_field"==e.props.field.name?t.recname:"select_application_number_field"==e.props.field.name?t.application_number:t.template_name},getOptionValue:function(e){return e.recid},isClearable:!0,isSearchable:!0,value:this.state.selectedValue,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}))}}]),n}(a.Component),oe=n(173),ie=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={checkBoxValue:void 0},e.onValueChanged=e.onValueChanged.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"onValueChanged",value:function(e){this.setState({checkBoxValue:e.value}),this.props.setFieldValue(this.props.field,e.value),this.props.updateData(e.value)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(oe.CheckBox,{name:this.props.field.name,onValueChanged:this.onValueChanged,text:this.props.field.text,defaultValue:!1}))}}]),n}(a.Component),ce=n(1169),ue=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),de=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){a.setState({value:e})},a.state={value:""},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(W.a,{isOpen:this.props.field.showModal,toggle:function(){return e.props.setFalseModalState()}},r.a.createElement(H.a,{toggle:function(){return e.props.setFalseModalState()}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),r.a.createElement(Z.a,null,r.a.createElement(f.a,null,r.a.createElement(b.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sm",onClick:function(){return e.props.setFalseModalState()}},r.a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),r.a.createElement("hr",null),r.a.createElement(v.a,null,"\u041d\u043e\u043c\u0435\u0440"),r.a.createElement(E.a,{id:"number",value:null!=this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1]?this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1].label:"",readOnly:!0}),r.a.createElement("br",null),r.a.createElement(v.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),r.a.createElement(E.a,{id:"element_name",value:null!=this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1]?this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1].title:"",readOnly:!0}),r.a.createElement("br",null),r.a.createElement(v.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),console.log(this.props.field.positions.map((function(e){return{value:e,label:e.toString()}}))),r.a.createElement(j.a,{name:"testname",options:null!=this.props.field.positions?this.props.field.positions.map((function(e){return{value:e,label:e.toString()}})):null,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.value,onValueClick:function(t){return e.popupNotifyMessage(!0,t.value)}})))}}]),n}(a.Component),pe=(n(99),[{title:"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445 \u0443\u0437\u043b\u043e\u0432",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u041f\u043e\u0434\u0448\u0438\u043f\u043d\u0438\u043a \u0431\u0443\u043a\u0441\u043e\u0432\u043e\u0433\u043e \u0443\u0437\u043b\u0430",current_quantity:0,necessary_quantity:2,available_positions:[1,2]},{title:"\u0417\u0430\u043c\u043e\u043a",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u0412\u0430\u043b\u0438\u043a \u043f\u043e\u0434\u044a\u0435\u043c\u043d\u0438\u043a\u0430",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u041a\u043e\u0440\u043f\u0443\u0441 \u0430\u0432\u0442\u043e\u0441\u0446\u0435\u043f\u043a\u0438",current_quantity:0,necessary_quantity:1,available_positions:null}]),me=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:{}},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){console.log("activeRecord",window),null!=window.activeRecord?this.setState({activeRecord:window.activeRecord}):this.setState({activeRecord:{reccode:null,reccreated:"2020-10-20T11:38:42.320928+08:00",reccreatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",recdescription:null,recid:"9f46e82c-f027-49d3-b81c-f032f869c25a",recname:null,recstate:1,recupdated:"2020-10-23T00:49:34.77997+08:00",recupdatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",sysboolean_test:!1,sysdate_test:null,sysdecimal_test:null,sysenum_test:1,sysfile_test:null,sysimage_test:"",sysint_test:null,sysmoney_test:0,sysnumber_test:"\u0422\u0435\u0441\u0442\u043e\u0432\u043e\u0435 \u043e\u043a\u043d\u043e",sysstring_test:"",systime_test:null,systimedate_test:null}})}},{key:"render",value:function(){return r.a.createElement(he,{method:{name:"test_procedure_update",displayName:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",isEnabled:null,isAnonymous:!1,static:!1,fields:[{name:"sysstring_field",type:"SysString",typeName:"SysString",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"sysint_field",type:"SysInt",typeName:"SysInt",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"checkbox_field",type:"SysBoolean",typeName:"SysBoolean",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"creatable_field",type:"SysString",typeName:"SysString",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:!0,default:null,lookup:null,searchLevel:null}],showModalYesNo:null,initMethodParams:null,isPacketSigned:null,workflow:null,table:"types_table"},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord})}}]),n}(a.Component),he=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateTemplateForNode=function(t,n){switch(console.log("updateTemplateForNode",t),console.log("updateTemplateForNode",n),n){case"template_plate":e.setState({select_template_plate_field:t});break;case"template_insert":e.setState({select_template_insert_field:t});break;case"template_ring":e.setState({select_template_ring_field:t});break;case"application_number":e.setState({select_application_number_field:t})}},e.selectTemplate=function(t){e.setState({selected_template:t,is_pasported:!1,is_uin_data_empty:!0,count:1,uin_field_value:"",select_template_plate_field:null,select_template_insert_field:null,select_template_ring_field:null,select_application_number_field:null,stateTableLoaded:!1,stateTableLoading:!1}),e.clearFormik()},e.updateCount=function(t){e.setState({count:t}),e.clearFormik()},e.updateUinFieldValue=function(t){e.setState({uin_field_value:t})},e.updatePastprted=function(t){e.setState({is_pasported:t,is_uin_data_empty:!0,uin_field_value:"",count:1}),e.clearFormik()},e.updateUinFieldState=function(t){e.setState({is_uin_field_empty:t})},e.updateUinElementsFieldState=function(t){e.setState({is_uin_elements_field_empty:t})},e.updateUinState=function(){e.setState((function(e){return{is_uin_data_empty:e.is_uin_field_empty&&e.is_uin_elements_field_empty}}))},e.countingNumberParts=function(t){for(var n=0;n<e.state.selected_template.elements.length;n++)e.state.selected_template.elements[n].current_quantity=0;if(null!=t&&0!=t.length)for(var a=function(n){var a=e.state.selected_template.elements.find((function(e){return e.title==t[n].title}));null!=a&&a.current_quantity<a.necessary_quantity&&(a.current_quantity+=1)},r=0;r<t.length;r++)a(r)},e.updateGroupingElements=function(t){e.state.uin_grouping_elements.length<t.length&&e.setState({show_modal:!0}),e.setState({uin_grouping_elements:t})},e.updateStateTableLoaded=function(t){e.setState({stateTableLoaded:t})},e.updateStateTableLoading=function(t){e.setState({stateTableLoading:t})},e.setFalseModalState=function(){e.setState({show_modal:!1}),e.state.uin_grouping_elements.pop()},e.state={selected_template:null,count:1,uin_field_value:"",is_pasported:!1,is_uin_field_empty:!0,is_uin_elements_field_empty:!0,is_uin_data_empty:!0,uin_grouping_elements:[],show_modal:!1,ref_data_grid:null,select_template_plate_field:null,select_template_insert_field:null,select_template_ring_field:null,select_application_number_field:null,processingAction:!1,isActionError:!1,successMessage:"",stateTableLoaded:!1,stateTableLoading:!1},e.selectTemplate=e.selectTemplate.bind(Object(h.a)(e)),e.updateCount=e.updateCount.bind(Object(h.a)(e)),e.updateUinFieldValue=e.updateUinFieldValue.bind(Object(h.a)(e)),e.updatePastprted=e.updatePastprted.bind(Object(h.a)(e)),e.updateUinFieldState=e.updateUinFieldState.bind(Object(h.a)(e)),e.updateUinElementsFieldState=e.updateUinElementsFieldState.bind(Object(h.a)(e)),e.updateUinState=e.updateUinState.bind(Object(h.a)(e)),e.countingNumberParts=e.countingNumberParts.bind(Object(h.a)(e)),e.updateGroupingElements=e.updateGroupingElements.bind(Object(h.a)(e)),e.setFalseModalState=e.setFalseModalState.bind(Object(h.a)(e)),e.dataGrid={},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.updateTemplateForNode=e.updateTemplateForNode.bind(Object(h.a)(e)),e.updateStateTableLoaded=e.updateStateTableLoaded.bind(Object(h.a)(e)),e.updateStateTableLoading=e.updateStateTableLoading.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"componentDidUpdate",value:function(){var e=this;void 0!=this.uinAssemblyUnitField&&null!=this.uinAssemblyUnitField||void 0==this.uinElementsField||null==this.uinElementsField||setTimeout((function(){e.uinElementsField.focus()}),1)}},{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("this",this),t="",this.state.is_pasported?(console.log(this.refs.formik.fields.uin_field.props.formik.values.uin_elements_field),n=this.refs.formik.fields.uin_field.props.formik.values.uin_elements_field,console.log(this.refs.formik.fields.uin_field.props.formik.values.uin_field),t=this.refs.formik.fields.uin_field.props.formik.values.uin_field):(n=this.refs.formik.fields.uin_elements_field.props.formik.values.uin_elements_field,console.log(this.refs.formik.fields.uin_elements_field.props.formik.values.uin_elements_field),t=this.refs.formik.fields.uin_elements_field.props.formik.values.uin_field,console.log(this.refs.formik.fields.uin_elements_field.props.formik.values.uin_field)),console.log(this.state.count),console.log(this.state.is_pasported),console.log(this.state.selected_template),console.log(this.state.select_template_plate_field),console.log(this.state.select_template_insert_field),console.log(this.state.select_template_ring_field),console.log(this.state.select_application_number_field),a=this.state.selected_template,r=this.state.select_template_plate_field,s=this.state.select_template_insert_field,l=this.state.select_template_ring_field,o=this.state.select_application_number_field,i={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null},"3607f67c-c619-43bd-bd9c-90acff9a5f28"!=this.state.selected_template.assembly_element_type_calculated){e.next=33;break}if("c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"!=this.state.selected_template.ke_node_type||!this.state.is_pasported){e.next=31;break}if(c=[],null==o&&c.push('\u041f\u043e\u043b\u0435 "\u041d\u043e\u043c\u0435\u0440 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c'),null==l&&c.push('\u041f\u043e\u043b\u0435 "\u041a\u043e\u043b\u044c\u0446\u043e \u0432 \u043f\u043e\u0434\u043f\u044f\u0442\u043d\u0438\u043a" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c'),null==r&&c.push('\u041f\u043e\u043b\u0435 "\u041f\u043b\u0430\u0441\u0442\u0438\u043d\u044b \u0432 \u043a\u043b\u0438\u043d\u043e\u0432\u044b\u0445 \u043a\u0430\u0440\u043c\u0430\u043d\u0430\u0445" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c'),null==s&&c.push('\u041f\u043e\u043b\u0435 "\u0412\u0441\u0442\u0430\u0432\u043a\u0438 \u0432 \u043a\u043b\u0438\u043d\u043e\u0432\u044b\u0435 \u043a\u0430\u0440\u043c\u0430\u043d\u044b" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c'),!(c.length>0)){e.next=27;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(c.join())));case 27:i.body=JSON.stringify({numbers_pool:o.recid,pattern_for_saddle_ring:l.recid,pattern_for_wedge_pockets:r.recid,pattern_for_wedge_pockets_inserts:s.recid,pressure_beam_uin:t,reestr_ke_node_type:a.recid,is_passported:this.state.is_pasported,ke_node_type:this.state.selected_template.ke_node_type,assembly_element_type:this.state.selected_template.assembly_element_type_calculated}),console.log("createassemblyunitornodeelement",i),e.next=33;break;case 31:i.body=JSON.stringify({ke_numbers:n,reestr_ke_node_type:a.recid,assembly_element_type:this.state.selected_template.assembly_element_type_calculated,ke_node_type:this.state.selected_template.ke_node_type,is_passported:this.state.is_pasported}),console.log("createassemblyunitornodeelement",i);case 33:return"62b3559e-10da-4189-8b25-d558ba451ac8"==this.state.selected_template.assembly_element_type_calculated&&(i.body=JSON.stringify({unique_number:t,reestr_ke_node_type:a.recid,is_passported:this.state.is_pasported,ke_node_type:this.state.selected_template.ke_node_type,assembly_element_type:this.state.selected_template.assembly_element_type_calculated,ke_numbers:n,count:this.state.count}),console.log("createassemblyunitornodeelement",i)),e.next=36,D("/plugins/nbdlogicplugin/createassemblyunitornodeelement",i.body);case 36:if(!(u=e.sent).success){e.next=44;break}return this.setState({processingAction:!1}),window.closePluginModal(),1==this.state.count&&null!=u.data&&window.open("/tables/reestr_ke_nodes/".concat(u.data),"_self"),e.abrupt("return",T(!0,"".concat(u.message)));case 44:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(u.message)));case 46:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"clearFormik",value:function(){console.log("formik",this.refs.formik),"undefined"!==typeof this.refs.formik.fields.uin_field&&("undefined"!==typeof this.refs.formik.fields.uin_field.props.formik.values.uin_elements_field&&(this.refs.formik.fields.uin_field.props.formik.values.uin_elements_field=null),"undefined"!==typeof this.refs.formik.fields.uin_field.props.formik.values.uin_field&&(this.refs.formik.fields.uin_field.props.formik.values.uin_field=null)),"undefined"!==typeof this.refs.formik.fields.uin_elements_field&&("undefined"!==typeof this.refs.formik.fields.uin_elements_field.props.formik.values.uin_elements_field&&(this.refs.formik.fields.uin_elements_field.props.formik.values.uin_elements_field=null),"undefined"!==typeof this.refs.formik.fields.uin_elements_field.props.formik.values.uin_field&&(this.refs.formik.fields.uin_elements_field.props.formik.values.uin_field=null))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0421\u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0421\u0427 \u0432 \u0443\u0437\u0435\u043b/\u0421\u0415"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(_.a,{form:!0},r.a.createElement(y.a,null,r.a.createElement(g.a,{key:"select_type_field",name:"select_type_field"},(function(){return r.a.createElement(le,{setFieldValue:function(n,a){t.setFieldValue(n,a),void 0!=e.uinAssemblyUnitField&&null!=e.uinAssemblyUnitField?(e.uinAssemblyUnitField.focus(),console.log("template setvalue",e.uinAssemblyUnitField)):void 0!=e.uinElementsField&&null!=e.uinElementsField&&(e.uinElementsField.focus(),console.log("template setvalue",e.uinElementsField))},updateData:e.selectTemplate,isTemplate:!0,field:{name:"select_field",displayName:"\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0443\u0437\u043b\u043e\u0432/\u0421\u0415",options:null}})}))),null!=e.state.selected_template&&r.a.createElement(y.a,{md:2},r.a.createElement(g.a,{key:"count_field",name:"count_field"},(function(){return r.a.createElement($,{setFieldValue:function(n,a){t.setFieldValue(n,a),void 0!=e.uinAssemblyUnitField&&null!=e.uinAssemblyUnitField?(setTimeout((function(){e.uinAssemblyUnitField.focus()}),1),console.log("PluginNumber setvalue1",e.uinAssemblyUnitField)):void 0!=e.uinElementsField&&null!=e.uinElementsField&&(setTimeout((function(){e.uinElementsField.focus()}),1),console.log("PluginNumber setvalue2",e.uinElementsField))},updateData:e.updateCount,field:{name:"count_field",displayName:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",isPasported:e.state.is_pasported,isUinDataEmpty:e.state.is_uin_data_empty,isAssemblyElement:"62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated,count:e.state.count}})})))),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&r.a.createElement(g.a,{key:"is_pasported",name:"is_pasported"},(function(){return r.a.createElement(ie,{setFieldValue:t.setFieldValue,updateData:e.updatePastprted,field:{name:"is_pasported",text:"\u041a\u043e\u043c\u043f\u043b\u0435\u043a\u0442\u0443\u044e\u0449\u0438\u0435 \u043d\u0435 \u043f\u0430\u0441\u043f\u043e\u0440\u0442\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u044b"}})})),null!=e.state.selected_template&&("62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated||"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported)&&r.a.createElement(g.a,{key:"uin_field",name:"uin_field"},(function(){return r.a.createElement(U,{setFieldValue:function(n,a){t.setFieldValue(n,a),console.log("PluginText setvalue",e.uinElementsField),12==a.length&&void 0!=e.uinElementsField&&null!=e.uinElementsField&&e.uinElementsField.focus()},updateUinFieldValue:e.updateUinFieldValue,updateUinFieldState:e.updateUinFieldState,updateUinState:e.updateUinState,ref:function(t){e.uinAssemblyUnitField=t},field:{name:"uin_field",displayName:"62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated?"\u0423\u0418\u041d":"\u0423\u0418\u041d \u0431\u0430\u043b\u043a\u0438 \u043d\u0430\u0434\u0440\u0435\u0441\u0441\u043e\u0440\u043d\u043e\u0439",isDisabled:1!=e.state.count,value:e.state.uin_field_value,autoFocus:!0}})})),null!=e.state.selected_template&&("62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated||"22ca1065-868e-4726-8f52-b6a5fdb8dfdc"==e.state.selected_template.ke_node_type||"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&!e.state.is_pasported)&&r.a.createElement(g.a,{key:"uin_elements_field",name:"uin_elements_field"},(function(){return r.a.createElement(Q,{setFieldValue:t.setFieldValue,updateUinElementsFieldState:e.updateUinElementsFieldState,updateUinState:e.updateUinState,updateGroupingElements:e.updateGroupingElements,updateModalState:e.updateModalState,refComponentDataGrid:e.dataGrid,ref:function(t){e.uinElementsField=t},field:{name:"uin_elements_field",displayName:"\u0423\u0418\u041d \u0434\u0435\u0442\u0430\u043b\u0435\u0439 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0438",isUinElementsField:!0,isDisabled:1!=e.state.count||!e.state.stateTableLoaded||e.state.stateTableLoading,options:e.state.selected_template,selectedTemplate:e.state.selected_template,autoFocus:void 0==e.uinAssemblyUnitField||null==e.uinAssemblyUnitField}})})),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported&&r.a.createElement(g.a,{key:"select_template_plate_field",name:"select_template_plate_field"},(function(){return r.a.createElement(le,{setFieldValue:t.setFieldValue,updateData:e.updateTemplateForNode,field:{name:"select_template_plate_field",displayName:'\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0421\u0427 "\u041f\u043b\u0430\u0441\u0442\u0438\u043d\u044b \u0432 \u043a\u043b\u0438\u043d\u043e\u0432\u044b\u0445 \u043a\u0430\u0440\u043c\u0430\u043d\u0430\u0445"',title:"template_plate"}})})),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported&&r.a.createElement(g.a,{key:"select_template_insert_field",name:"select_template_insert_field"},(function(){return r.a.createElement(le,{setFieldValue:t.setFieldValue,updateData:e.updateTemplateForNode,field:{name:"select_template_insert_field",displayName:'\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0421\u0427 "\u0412\u0441\u0442\u0430\u0432\u043a\u0438 \u0432 \u043a\u043b\u0438\u043d\u043e\u0432\u044b\u0435 \u043a\u0430\u0440\u043c\u0430\u043d\u044b"',title:"template_insert"}})})),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported&&r.a.createElement(g.a,{key:"select_template_ring_field",name:"select_template_ring_field"},(function(){return r.a.createElement(le,{setFieldValue:t.setFieldValue,updateData:e.updateTemplateForNode,field:{name:"select_template_ring_field",displayName:'\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0421\u0427 "\u041a\u043e\u043b\u044c\u0446\u043e \u0432 \u043f\u043e\u0434\u043f\u044f\u0442\u043d\u0438\u043a"',title:"template_ring"}})})),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported&&r.a.createElement(g.a,{key:"select_application_number_field",name:"select_application_number_field"},(function(){return r.a.createElement(le,{setFieldValue:t.setFieldValue,updateData:e.updateTemplateForNode,field:{name:"select_application_number_field",displayName:"\u041d\u043e\u043c\u0435\u0440 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f",title:"application_number"}})})),null!=e.state.selected_template&&("62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated||"22ca1065-868e-4726-8f52-b6a5fdb8dfdc"==e.state.selected_template.ke_node_type||"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&!e.state.is_pasported)&&r.a.createElement(g.a,{key:"data_grid",name:"data_grid"},(function(n){var a=n.formikfield;n.form;return r.a.createElement(ae,Object.assign({value:e.props,field:{name:"data_grid",data:e.state.selected_template.recid},setFieldValue:t.setFieldValue,updateStateTableLoaded:e.updateStateTableLoaded,updateStateTableLoading:e.updateStateTableLoading,updateData:e.updateDataFromDataGrid,activeRecord:e.props.activeRecord,ref:function(t){return e.dataGrid=t}},t,a))})),r.a.createElement(g.a,{key:"modal_select_poition",name:"modal_select_poition"},(function(){return r.a.createElement(de,{setFieldValue:t.setFieldValue,setFalseModalState:e.setFalseModalState,field:{name:"modal_select_poition",displayName:"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",showModal:e.state.show_modal,uinGroupingElements:e.state.uin_grouping_elements,positions:pe[1].available_positions}})})))}}),r.a.createElement(ue,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}}]),n}(r.a.Component),fe=(n(743),n(453),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){null!=e&&(console.log("handleChange",e),a.handleNewOptionClick(e))},a.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,r,s,l,o,i,c,u,d,m,h,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),n="",r="",s="",l="",o="",i=t.value,a.setState({isLoadingDetail:!0}),e.next=10,a.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(i,"')"));case 10:if(c=e.sent,!a.isNullOrEmptyResponse(c)){e.next=13;break}return e.abrupt("return",a.modalError("".concat("reestr_key_elements"==a.props.tableName?"\u0421\u043e\u0441\u0442\u0430\u0432\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c":"\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u0430\u044f \u0435\u0434\u0438\u043d\u0438\u0446\u0430 (\u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c)"," \u0441 \u0442\u0430\u043a\u0438\u043c \u0423\u0418\u041d \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435")));case 13:return u=c.value[0],e.next=16,a.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(u.recid,")"));case 16:return d=e.sent,e.next=19,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(u.recid,") and (assembly_element_type eq 62b3559e-10da-4189-8b25-d558ba451ac8)"));case 19:if(m=e.sent,!a.isNullOrEmptyResponse(m)||!a.isNullOrEmptyResponse(d)){e.next=22;break}return e.abrupt("return",a.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 22:if(a.isNullOrEmptyResponse(d)||!a.isNullOrEmptyResponse(m)){e.next=52;break}if(o=d.value[0],n="reestr_key_elements",r=String().concat(o.numberke,", ",o.key_element_code_calculated),s=o.recid,l=o.key_element_code,"reestr_key_elements"==window.rdev_modalDataPack.tableName){e.next=48;break}if(null!=o.ke_node){e.next=33;break}return e.abrupt("return",a.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u0434\u043b\u044f ".concat(o.key_element_code_calculated,' \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b "\u0421\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438"')));case 33:if("c82c2eb8-0cf9-4693-8a2b-c6bf605c97ab"==o.statuske||"259762d5-2ee4-4acb-a2c7-18593cb6cc4f"==o.statuske){e.next=35;break}return e.abrupt("return",a.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442, \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043e\u0447\u0435\u0440\u043d\u0435\u0439 \u0421\u0427 ".concat(o.key_element_code_calculated," ").concat(o.numberke," - ").concat(o.statuske_calculated)));case 35:return e.next=37,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(o.ke_node,")"));case 37:if(h=e.sent,!a.isNullOrEmptyResponse(h)){e.next=40;break}return e.abrupt("return",a.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 40:if("62b3559e-10da-4189-8b25-d558ba451ac8"==h.value[0].assembly_element_type){e.next=42;break}return e.abrupt("return",a.modalError("\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0445 \u0435\u0434\u0438\u043d\u0438\u0446 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"));case 42:return e.next=44,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(o.ke_node,") and (assembly_element_type eq 62b3559e-10da-4189-8b25-d558ba451ac8)"));case 44:if(f=e.sent,!a.isNullOrEmptyResponse(f)){e.next=48;break}if("823cc6e9-465b-416e-beda-8a642149c235"==h.value[0].status||"25d67987-0cd4-404a-85d7-847d142af11f"==h.value[0].status){e.next=48;break}return e.abrupt("return",a.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u043d\u0430 ".concat(h.value[0].ke_node_type_calculated," ").concat(h.value[0].readonly_ke_node," \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 ").concat(h.value[0].status_calculated)));case 48:if("c82c2eb8-0cf9-4693-8a2b-c6bf605c97ab"==o.statuske||"259762d5-2ee4-4acb-a2c7-18593cb6cc4f"==o.statuske){e.next=50;break}return e.abrupt("return",a.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u043d\u0430 ".concat(o.key_element_code_calculated," ").concat(o.numberke," \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 ").concat(o.statuske_calculated)));case 50:e.next=64;break;case 52:if(a.isNullOrEmptyResponse(m)){e.next=64;break}if(o=m.value[0],n="reestr_ke_nodes",r=String().concat(o.unique_number,", ",o.ke_node_type_calculated),s=o.recid,l=o.ke_node_type,"reestr_ke_nodes"==window.rdev_modalDataPack.tableName){e.next=60;break}return e.abrupt("return",a.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u0434\u043b\u044f ".concat(m.value[0].ke_node_type_calculated,' \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b "\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0435 \u0435\u0434\u0438\u043d\u0438\u0446\u044b"')));case 60:if("823cc6e9-465b-416e-beda-8a642149c235"==o.status||"25d67987-0cd4-404a-85d7-847d142af11f"==o.status||"01d8f0ce-28db-4d3d-a956-38bb26260437"==o.status){e.next=62;break}return e.abrupt("return",a.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u043d\u0430 ".concat(o.ke_node_type_calculated," ").concat(o.readonly_ke_node," \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 ").concat(o.status_calculated)));case 62:if(null==o.vehicle){e.next=64;break}return e.abrupt("return",a.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u043d\u0430 ".concat(o.ke_node_type_calculated," ").concat(o.readonly_ke_node," \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 ").concat(o.status_calculated,", \u0442.\u043a. \u043e\u043d\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u043d\u0430 \u0432\u0430\u0433\u043e\u043d ").concat(o.vehicle_manufacturer_number)));case 64:t.label=r,a.setState({option:t,isLoadingDetail:!1}),a.props.setFieldValue(a.props.field.name,{label:r,recname:u.recname,recid:s,tableName:n,filterDefect:l}),a.props.updateUinState(),a.props.updateData({recname:u.recname,recid:s,tableName:n,filterDefect:l},o);case 69:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.prepareValue=function(){return a.props.value instanceof Array?a.props.value[0]:a.props.value},a.state={option:"",options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null},a.handleNewOptionClick=a.handleNewOptionClick.bind(Object(h.a)(a)),a.handleModalChange=a.handleModalChange.bind(Object(h.a)(a)),a.renderDeleteConfirm=a.renderDeleteConfirm.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"assemblyElementAlreadyExist",value:function(e,t){return 0==e.length||null==e.find((function(e){return null!=e.node&&null!=t&&e.node==t}))}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&T(!1,e)}},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,console.log("getAssemblyElementPattern",a.length),e.abrupt("return",a.length>0?a[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("deleteValue",t),this.setState({option:""}),this.props.setFieldValue(this.props.field.name,JSON.stringify(t)),this.props.updateData(null,null),this.setState({showDeleteModal:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return a.createElement(W.a,{isOpen:this.state.showDeleteModal,size:"xl"},a.createElement(H.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),a.createElement(Z.a,null,a.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),a.createElement(Y.a,null,a.createElement(b.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),a.createElement(b.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},a.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;return a.createElement(k.a,{row:!0},a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},a.createElement("b",null,this.props.field.displayName)),a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},a.createElement(J.a,{name:this.props.field.name,components:{SingleValue:function(t){var n={backgroundColor:t.data.backgroundColor,color:t.data.color};return a.createElement("div",{className:"SelectValue",style:n},a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t)}},"\xd7"),a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.option,isMulti:!1,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}})),this.renderDeleteConfirm())}}]),n}(a.Component)),be=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),a.setState({selectedValue:e}),a.props.setFieldValue(a.props.field,a.state.selectedValue),a.props.updateData(e,a.props.field.name)},a.state={options:[],uin:null,currentElement:{},currentElementType:"",text_select:"",selectedValue:null,fieldForShow:"recname"},a.getDictionaries=a.getDictionaries.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("state=",this.state),console.log("props=",this.props),console.log("componentDidMount"),this.getDictionaries(),this.props.field.isUinField&&(this.setState({uin:null!=this.props.field.uin?this.props.field:null}),null!=this.props.field.uin&&this.props.updateUinState(!1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){switch(console.log("prevProps=",e),console.log("props=",this.props),this.props.field.name){case"type_repair_field":break;case"type_fault_field":e.field.filterDefect!=this.props.field.filterDefect&&this.getDictionaries();break;case"repair_operation_field":e.field.filterOperation!=this.props.field.filterOperation&&this.getDictionaries()}}},{key:"getDictionaries",value:function(){var e=this;console.log("loadRepairTypes");var t="",n="",a="",r="";switch(this.props.field.name){case"type_repair_field":t="dictionary_type_work",this.setState({fieldForShow:"type_repair_work"}),n="type_repair_work";break;case"type_fault_field":if(this.setState({options:null}),this.setState({selectedValue:null}),t="dictionary_type_malfunction_pressure_beam",this.setState({fieldForShow:"recname"}),n="recname,name_key_element,name_ke_node",console.log("this.props.field.filterDefect",this.props.field.filterDefect),console.log("this.props.field.tableName",this.props.field.tableName),""==(a=null!=this.props.field.filterDefect&&""!=this.props.field.filterDefect?"reestr_key_elements"==this.props.field.tableName?"name_key_element eq ".concat(this.props.field.filterDefect," and "):"name_ke_node eq ".concat(this.props.field.filterDefect," and "):""))return this.setState({options:null}),void this.setState({selectedValue:null});break;case"repair_operation_field":if(t="dictionary_type_work_performed",this.setState({selectedValue:null,fieldForShow:"recname"}),console.log("this.props.field.filterOperation",this.props.field.filterOperation),n="work_performed_type,work_performed_type_operation",r="work_performed_type_operationitem($select=repair_operation)",""==(a=null!=this.props.field.filterOperation&&""!=this.props.field.filterOperation?"work_performed_type eq ".concat(this.props.field.filterOperation," and "):""))return this.setState({options:null}),void this.setState({selectedValue:null});break;case"uin_relation_field":n="reestr_key_elements"==(t=this.props.tableName)?"key_element_code,numberke":"unique_number,ke_node_type",a="recid eq ".concat(this.props.activeRecord.recid," and "),r="reestr_key_elements"==t?"key_element_codeitem($select=recname)":"ke_node_typeitem($select=recname)"}console.log("/odata/".concat(t,"?$select=").concat(n,",recid&$orderBy=").concat(n,"&$filter=").concat(a,"recstate eq 1&$expand=").concat(r)),fetch("/odata/".concat(t,"?$select=").concat(n,",recid&$orderBy=").concat(n,"&$filter=").concat(a,"recstate eq 1&$expand=").concat(r),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(n){if(e.isNullOrEmptyResponse(n))return console.log("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 ".concat(t," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));if("repair_operation_field"==e.props.field.name&&n.value.forEach((function(e){return e.recname=e.work_performed_type_operationitem.repair_operation})),"uin_relation_field"==e.props.field.name){console.log("uin response",n.value);var a={recid:n.value[0],recname:"reestr_key_elements"==t?"".concat(n.value[0].numberke,", ").concat(n.value[0].key_element_codeitem.recname):"".concat(n.value[0].unique_number,", ").concat(n.value[0].ke_node_typeitem.recname)};e.setState({selectedValue:a}),e.props.updateData(n.value[0],e.props.field.name)}else e.setState({options:n.value}),console.log("loadRepairTypes data.value ",n.value)})).catch((function(e){console.log("Request failed: ",e)}))}},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,{row:!0},r.a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(j.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(t){return t[e.state.fieldForShow]},getOptionValue:function(e){return e.recid},options:this.state.options,onChange:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,isDisabled:this.props.field.isUinField||this.props.field.isDisabled,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}})))}}]),n}(a.Component),_e=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={selectedRowNotes:"",notFoundAssemblyUnits:!1,isNeedShowDataGrid:!1},a.onSelectionChanged=a.onSelectionChanged.bind(Object(h.a)(a)),a.loadStateTable=a.loadStateTable.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("componentDidMount data grid",this.props),null==this.props.activeRecord){e.next=4;break}return e.next=4,this.loadStateTable(this.props.activeRecord);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(m.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("data grid ",this.props),this.props.activeRecord===t.activeRecord||null==this.props.activeRecord){e.next=5;break}return e.next=4,this.loadStateTable(this.props.activeRecord);case 4:case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadStateTable",t),e.next=3,this.getData(t);case 3:n=e.sent,this.setStateTableData(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(console.log("getStateTableData",this.props),console.log("getStateTableData",this.refs),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"getAllChildAssemblyUnits",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("getAllChildAssemblyUnits",t),void 0!=t&&null!=t){e.next=3;break}return e.abrupt("return",n);case 3:return e.next=5,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(t.recid,") and (recstate eq 1)"));case 5:return e.sent.value.forEach((function(e){if("62b3559e-10da-4189-8b25-d558ba451ac8"==e.assembly_element_type)return n.push(e),a.getAllChildAssemblyUnits(e,n)})),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMainParentAssemblyUnits",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.parent_ke_node,") and (recstate eq 1)"));case 2:if(void 0!=(n=e.sent).value[0]&&null!=n.value[0]){e.next=5;break}return e.abrupt("return",T(!1,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0438 \u0421\u0415."));case 5:if(null==n.value[0].parent_ke_node||""==n.value[0].parent_ke_node){e.next=11;break}return e.next=8,this.getMainParentAssemblyUnits(n.value[0]);case 8:return e.abrupt("return",e.sent);case 11:return e.abrupt("return",n.value[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getData",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,console.log("date grid get data",n),e.next=4,this.sendRequestAsync("/odata/reestr_key_elements?$filter=(recid eq ".concat(n.recid,")"));case 4:return a=e.sent,e.next=7,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(n.recid,")"));case 7:if(r=e.sent,!this.isNullOrEmptyResponse(r)||!this.isNullOrEmptyResponse(a)){e.next=10;break}return e.abrupt("return",T(!1,"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 10:if(s=[],l=[],o=null,this.isNullOrEmptyResponse(a)||!this.isNullOrEmptyResponse(r)){e.next=24;break}if(null==n.ke_node){e.next=23;break}return e.next=17,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(n.ke_node,")"));case 17:if(i=e.sent,"62b3559e-10da-4189-8b25-d558ba451ac8"==(o=i.value[0]).assembly_element_type){e.next=21;break}return e.abrupt("return",T(!1,"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0445 \u0435\u0434\u0438\u043d\u0438\u0446 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"));case 21:e.next=24;break;case 23:return e.abrupt("return",T(!1,"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u0434\u043b\u044f ".concat(n.key_element_code_calculated,', \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b "\u0421\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438".')));case 24:if(!this.isNullOrEmptyResponse(a)||this.isNullOrEmptyResponse(r)){e.next=32;break}if(void 0==r.value[0].parent_ke_node||null==r.value[0].parent_ke_node){e.next=31;break}return e.next=28,this.getMainParentAssemblyUnits(r.value[0]);case 28:o=e.sent,e.next=32;break;case 31:o=r.value[0];case 32:return l.push(o),e.next=35,this.getAllChildAssemblyUnits(o,l);case 35:for(console.log("allNodes=",l),c=0;c<l.length;c++)("823cc6e9-465b-416e-beda-8a642149c235"==(u=l[c]).status||"25d67987-0cd4-404a-85d7-847d142af11f"==u.status||"01d8f0ce-28db-4d3d-a956-38bb26260437"==u.status&&null==u.vehicle&&"62b3559e-10da-4189-8b25-d558ba451ac8"==u.assembly_element_type)&&s.push({uin:u.unique_number,title:u.ke_node_type_calculated,recid:u.recid});return s.length<=0?this.setState({notFoundAssemblyUnits:!0,selectedRowNotes:"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0445 \u0435\u0434\u0438\u043d\u0438\u0446 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"}):this.isNullOrEmptyResponse(r)||1!=s.length?(this.setState({isNeedShowDataGrid:!0}),this.props.updateDataGridNeed(!0)):(this.setState({notFoundAssemblyUnits:!1,isNeedShowDataGrid:!1}),this.props.updateDataGridNeed(!1)),e.abrupt("return",s);case 39:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedRowsData,a=n[0],console.log("onSelectionChanged data",a),void 0==a||null==a){e.next=10;break}return e.next=6,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(a.recid,")"));case 6:r=e.sent,this.props.updateData(a,r.value[0]),e.next=11;break;case 10:this.props.updateData(null,null);case 11:this.props.setFieldValue(this.props.field,a);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(k.a,{row:!0,className:"justify-content-md-center",hidden:!this.state.isNeedShowDataGrid},r.a.createElement(v.a,{sm:4,hidden:!this.state.isNeedShowDataGrid,style:{flex:"0 0 30%",maxWidth:"30%"}}),r.a.createElement(y.a,{sm:8,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement("p",null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0443\u044e \u0435\u0434\u0438\u043d\u0438\u0446\u0443 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"),r.a.createElement(te.a,{preloadEnabled:!1,name:this.props.field,selection:{mode:"single"},showBorders:!0,showColumnLines:!0,showRowLines:!0,hoverStateEnabled:!0,columnAutoWidth:!0,visible:!this.state.notFoundAssemblyUnits&&this.state.isNeedShowDataGrid,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},r.a.createElement(ee.Column,{dataField:"uin",caption:"\u0423\u0418\u041d",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"title",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0439 \u0435\u0434\u0438\u043d\u0438\u0446\u044b",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"recid",caption:"Guid \u0437\u0430\u043f\u0438\u0441\u0438 \u0421\u0427/\u0421\u0415",width:0,dataType:"string",visible:!1})),r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ne.a,{color:"danger",isOpen:this.state.notFoundAssemblyUnits&&this.state.isNeedShowDataGrid},r.a.createElement("h4",{className:"alert-heading"},this.state.selectedRowNotes)))))}}]),n}(a.Component),ye=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),ge=n(151),ke=n(108),ve=n.n(ke),Ee=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){if(console.log("date change"),null!=e.value){ve()().utcOffset();var t=ve()(e.value),n=new Date(Date.UTC(t.year(),t.month(),t.date()));a.setState({selectedValue:n}),a.props.setFieldValue(a.props.field.name,n)}else a.setState({selectedValue:null}),a.props.setFieldValue(a.props.field.name,e.value);a.props.setFieldTouched(a.props.field.name,!0),a.props.updateData(e.value,a.props.field.name)},a.getType=function(){return"SysTimeDate"===a.props.field.type?"datetime":"SysDate"===a.props.field.type?"date":"datetime"},a.state={selectedValue:new Date},a.handleChange=a.handleChange.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",elementAttr:{class:"rdev-read-only-control"}},r.a.createElement(k.a,{key:"input_".concat(this.props.field.name),row:!0},r.a.createElement(v.a,{sm:4,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:8,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(ge.DateBox,{className:"repairFormDateBox",width:"100%",type:"date",id:this.props.field,name:this.props.field.name,defaultValue:new Date,showClearButton:!0,useMaskBehavior:!0,displayFormat:"dd.MM.yyyy",onValueChanged:this.handleChange,value:this.state.selectedValue})))}}]),n}(a.Component),Oe=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,tableName:"",place:"",isNeedDataGrid:!1},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){console.log("rdev_modalDataPack",window.rdev_modalDataPack),"edit"==window.rdev_modalDataPack.place?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords}):window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords[0]}):this.setState({activeRecord:null,isNeedDataGrid:!0}),this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place}),console.log("active=",window.rdev_modalDataPack.selectedRecords)}},{key:"render",value:function(){return r.a.createElement(xe,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},place:this.state.place,tableName:this.state.tableName,initialValues:{},activeRecord:this.state.activeRecord,isNeedDataGrid:this.state.isNeedDataGrid})}}]),n}(a.Component),xe=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateSelectedValues=function(t,n){switch(n){case"uin_relation_field":e.setState({selectedRecord:e.props.activeRecord,selectedElementType:"reestr_key_elements"==e.props.tableName?t.key_element_code:t.ke_node_type}),e.updateUinState(!1);break;case"type_repair_field":e.setState({selectedRepairType:t}),e.updateTypeRepairState(t);break;case"type_fault_field":e.setState({selectedFaultType:t});break;case"repair_operation_field":e.setState({selectedRepairOperation:t})}},e.updateTypeRepairState=function(t){e.isNotNullObject(t)?e.setState({is_type_repair_empty:!1}):(e.setState({is_type_repair_empty:!0}),e.setState({selectedRepairOperation:null}),console.log("state selectedRepairOperation",e.state))},e.updateSelectedDate=function(t,n){console.log("updateSelectedDate ",t),e.setState({selectedRepairDate:t})},e.updateselectedRecord=function(t,n){console.log("updateselectedRecord ",t),null!=t&&null!=n?e.setState({activeRecord:n,selectedRecord:n,selectedElementType:t.filterDefect,selectedTable:t.tableName,isVisibleDataGrid:!!t}):(e.setState({activeRecord:n,selectedRecord:n,selectedElementType:t,selectedTable:t,isVisibleDataGrid:t}),e.setState({selectedFaultType:t}),e.setState({is_uin_creatable_lookup_empty:!0}),e.setState({is_uin_empty:!0}),console.log("this.state_test",e.state))},e.updateDataFromDataGrid=function(t,n){null!=t?e.setState({selectedRecord:n,selectedRow:t,selectedElementType:null!=n?n.ke_node_type:null}):e.setState({selectedRow:null,selectedElementType:null}),console.log("updateDataFromDataGrid",e.state)},e.updateDataGridNeed=function(t){e.setState({isVisibleDataGrid:t})},e.updateUinCreatableLookupState=function(t){null!=t&&t.length>0?e.setState({is_uin_creatable_lookup_empty:!1}):e.setState({is_uin_creatable_lookup_empty:!0})},e.updateUinElementsFieldState=function(t){e.setState({is_uin_elements_field_empty:t})},e.updateUinState=function(t){e.setState({is_uin_empty:t})},e.state={selectedRepairType:null,selectedFaultType:null,selectedRepairOperation:null,selectedRepairDate:new Date,selectedRecord:null,selectedRow:null,selectedTable:"",selectedElementType:"",isVisibleDataGrid:!1,inputRecord:null,uin:null,is_type_repair_empty:!0,is_uin_creatable_lookup_empty:!0,is_uin_empty:!0,processingAction:!1,ref_data_grid:null},e.updateTypeRepairState=e.updateTypeRepairState.bind(Object(h.a)(e)),e.updateUinCreatableLookupState=e.updateUinCreatableLookupState.bind(Object(h.a)(e)),e.updateUinState=e.updateUinState.bind(Object(h.a)(e)),e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.dataGrid={},e.updateUinElementsFieldState=e.updateUinElementsFieldState.bind(Object(h.a)(e)),e.updateSelectedValues=e.updateSelectedValues.bind(Object(h.a)(e)),e.updateSelectedDate=e.updateSelectedDate.bind(Object(h.a)(e)),e.updateselectedRecord=e.updateselectedRecord.bind(Object(h.a)(e)),e.updateDataFromDataGrid=e.updateDataFromDataGrid.bind(Object(h.a)(e)),e.updateDataGridNeed=e.updateDataGridNeed.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(this.refs.formik.fields),console.log(this.refs.formik.state.values),console.log(this.state),this.setState({processingAction:!0}),t="",console.log("selectedRecordvselectedRecord",this.state.selectedRecord),console.log("tableName",this.props.tableName),console.log("selectedRow",this.state.selectedRow),this.isNullObject(this.state.selectedRecord)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0423\u0418\u041d". ')),this.props.isNeedDataGrid&&this.state.isVisibleDataGrid&&"reestr_ke_nodes"==this.props.tableName&&this.isNullObject(this.state.selectedRow)&&(t=String().concat(t,"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0430\u044f \u0435\u0434\u0438\u043d\u0438\u0446\u0430. ")),"undefined"!==this.state.selectedRepairDate&&null!=this.state.selectedRepairDate||(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0414\u0430\u0442\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430". ')),this.isNullObject(this.state.selectedRepairType)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0412\u0438\u0434 \u0440\u0435\u043c\u043e\u043d\u0442\u0430". ')),this.isNullObject(this.state.selectedFaultType)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0412\u0438\u0434 \u043d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u043e\u0441\u0442\u0438". ')),this.isNullObject(this.state.selectedRepairOperation)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u044f \u0440\u0435\u043c\u043e\u043d\u0442\u0430". ')),n=new Date(this.state.selectedRepairDate).toLocaleDateString(),console.log("this.state.selectedRepairDate",n),!this.isNotEmptyString(t)){e.next=21;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,t));case 21:return a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({recid:this.isNotNullObject(this.state.selectedRecord)?this.state.selectedRecord.recid:this.props.activeRecord.recid,table_name:this.props.tableName,repair_date:n,repair_type:this.state.selectedRepairType.type_repair_work,repair_defect:this.state.selectedFaultType.recname,repair_operation:this.state.selectedRepairOperation.recname})},console.log("requestBody",a),e.next=25,D("/plugins/nbdlogicplugin/registerrepair",a.body);case 25:if(r=e.sent,console.log("result_registerrepair_resp",r),!r.success){e.next=33;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(r.message)));case 33:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(r.message)));case 35:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442"),r.a.createElement("hr",null),null!=e.props.activeRecord&&r.a.createElement(g.a,{key:"uin_relation_field",name:"uin_relation_field"},(function(){return r.a.createElement(be,{setFieldValue:t.setFieldValue,updateUinState:e.updateUinState,updateData:e.updateSelectedValues,field:{name:"uin_relation_field",displayName:"\u0423\u0418\u041d",options:null,isUinField:!0},activeRecord:e.props.activeRecord,tableName:e.props.tableName})})),null==e.props.activeRecord&&r.a.createElement(g.a,{key:"uin_creatable_lookup_field",name:"uin_creatable_lookup_field"},(function(){return r.a.createElement(fe,{setFieldValue:t.setFieldValue,updateData:e.updateselectedRecord,updateUinElementsFieldState:e.updateUinElementsFieldState,updateUinState:e.updateUinState,updateGroupingElements:e.updateGroupingElements,updateModalState:e.updateModalState,refComponentDataGrid:e.dataGrid,field:{name:"uin_creatable_lookup_field",displayName:"\u0423\u0418\u041d",isUinElementsField:!0},tableName:e.props.tableName})})),"reestr_ke_nodes"==e.props.tableName&&e.state.isVisibleDataGrid&&e.props.isNeedDataGrid&&r.a.createElement(g.a,{key:"data_grid",name:"data_grid"},(function(n){var a=n.formikfield;n.form;return r.a.createElement(_e,Object.assign({value:e.props,field:"data_grid",setFieldValue:t.setFieldValue,updateData:e.updateDataFromDataGrid,updateDataGridNeed:e.updateDataGridNeed,activeRecord:e.state.activeRecord,selectedRecord:e.state.selectedRecord,tableName:e.props.tableName,ref:function(t){return e.dataGrid=t}},t,a))})),r.a.createElement(g.a,{key:"date_field",name:"date_field"},(function(){return r.a.createElement(Ee,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedDate,field:{name:"date_field",displayName:"\u0414\u0430\u0442\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430",isUinElementsField:!0}},t))})),r.a.createElement(g.a,{key:"type_repair_field",name:"type_repair_field"},(function(){return r.a.createElement(be,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,field:{name:"type_repair_field",displayName:"\u0412\u0438\u0434 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"}},t))})),r.a.createElement(g.a,{key:"type_fault_field",name:"type_fault_field"},(function(){return r.a.createElement(be,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,field:{name:"type_fault_field",displayName:"\u0412\u0438\u0434 \u043d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u043e\u0441\u0442\u0438",isDisabled:e.state.is_uin_empty&&e.state.is_uin_creatable_lookup_empty&&("reestr_ke_nodes"!=e.props.tableName||null==e.state.selectedRow),filterDefect:null!=e.state.selectedRecord?e.state.selectedElementType:"",tableName:e.props.tableName}},t))})),r.a.createElement(g.a,{key:"repair_operation_field",name:"repair_operation_field"},(function(){return r.a.createElement(be,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,field:{name:"repair_operation_field",displayName:"\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u044f \u0440\u0435\u043c\u043e\u043d\u0442\u0430",isDisabled:e.state.is_type_repair_empty,filterOperation:null!=e.state.selectedRepairType?e.state.selectedRepairType.recid:"",tableName:e.props.tableName}},t))})),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0"))}}),r.a.createElement(ye,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}))}},{key:"isEmptyString",value:function(e){return null==e||"undefined"===e||""===e||0===e.length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotNullObject",value:function(e){return null!=e&&"undefined"!==e&&e&&0!==Object.keys(e).length}},{key:"isEmptyOrNullArray",value:function(e){return!e||null==e||"undefined"===e||e.length<=0}},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}}]),n}(r.a.Component),Se=(n(1135),a.Component,a.Component,a.Component,a.Component,function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={checkBoxValue:void 0},e.onValueChanged=e.onValueChanged.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"onValueChanged",value:function(e){this.setState({checkBoxValue:e.value}),this.props.updateData(e.value),this.props.setFieldValue(this.props.field,e.value)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(oe.CheckBox,{name:this.props.field,onValueChanged:this.onValueChanged,text:"\u041f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0443\u044e \u0435\u0434\u0438\u043d\u0438\u0446\u0443 \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0435\u0440\u0432\u043e\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",defaultValue:!1}))}}]),n}(a.Component)),we=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={selectedRowNotes:"",data:[],uin:"",elements_in_vagon:{},select_element:{},is_circ:!1,visible_alert:!1,name_old_element:"",name_new_element:null,isVisibleCheckbox:"hidden",marginTopCheckBox:"0px",marginTopAddMessage:"0px",additionMessage:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0430\u044f \u0435\u0434\u0438\u043d\u0438\u0446\u0430 \u0431\u044b\u043b\u0430 \u043f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u0430, \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d \u043f\u0435\u0440\u0435\u0441\u0447\u0435\u0442 \u0432\u0441\u0435\u0445 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439",isVisibleAdditionMessage:"hidden"},a.onSelectionChanged=a.onSelectionChanged.bind(Object(h.a)(a)),a.loadStateTable=a.loadStateTable.bind(Object(h.a)(a)),a.renderCheckBoxNbd=a.renderCheckBoxNbd.bind(Object(h.a)(a)),a.updateDataCheckBox=a.updateDataCheckBox.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=this.props.values.select_field)){e.next=4;break}return e.next=4,this.loadStateTable(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData(t);case 2:n=e.sent,this.setStateTableData(n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"getData",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h,f,b,_;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props.activeRecord.recid,e.next=3,this.sendRequestAsync("/odata/reestr_key_elements?$filter=(recid eq ".concat(t.recid,")"));case 3:return a=e.sent,e.next=6,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.recid,")"));case 6:if(r=e.sent,!this.isNullOrEmptyResponse(r)||!this.isNullOrEmptyResponse(a)){e.next=10;break}return T(!1,"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."),e.abrupt("return",se()({message:"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435.",width:350,height:"auto",position:"bottom right",hoverStateEnabled:!1},"error",5500));case 10:if(s=null,l=[],this.isNullOrEmptyResponse(a)||!this.isNullOrEmptyResponse(r)){e.next=30;break}if(null==t.ke_node){e.next=25;break}return e.next=16,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.ke_node,")"));case 16:return o=e.sent,i=o.value[0],e.next=20,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(ke_node_type eq ".concat(i.ke_node_type,") and (vehicle eq ").concat(n,")"));case 20:for(s=e.sent,c=s.value,u=0;u<c.length;u++)d=c[u],l.push({numberke:d.unique_number,nameke:d.ke_node_type_calculated,position:d.assembly_element_position_on_vagon_calculated,recid:d.recid});e.next=30;break;case 25:return e.next=27,this.sendRequestAsync("/odata/reestr_key_elements?$filter=(key_element_code eq ".concat(t.key_element_code,") and (vehicle eq ").concat(n,")"));case 27:for(s=e.sent,c=s.value,m=0;m<c.length;m++)h=c[m],f=void 0,f="\u0421\u043c\u0435\u043d\u043d\u044b\u0439 \u0436\u0435\u043b\u0435\u0437\u043d\u043e\u0434\u043e\u0440\u043e\u0436\u043d\u044b\u0439 \u043a\u0443\u0437\u043e\u0432"==h.key_element_code_calculated?"1":h.position_on_vagon_calculated,l.push({numberke:h.numberke,nameke:h.key_element_code_calculated,position:f,recid:h.recid});case 30:if(this.isNullOrEmptyResponse(r)){e.next=39;break}return e.next=33,this.findMainNode(t);case 33:return i=e.sent,e.next=36,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(ke_node_type eq ".concat(i.ke_node_type,") and (vehicle eq ").concat(n,")"));case 36:for(s=e.sent,c=s.value,b=0;b<c.length;b++)_=c[b],l.push({numberke:_.unique_number,nameke:_.ke_node_type_calculated,position:_.assembly_element_position_on_vagon_calculated,recid:_.recid});case 39:return e.abrupt("return",l);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"renderCheckBoxNbd",value:function(e){if(console.log("renderCheckBoxNbd_props_",e),console.log("renderCheckBoxNbd_props_",this.props),0!=this.state.is_circ)return r.a.createElement(Se,{value:this.props,field:"check_box_nbd",activeRecord:this.props.activeRecord})}},{key:"updateDataCheckBox",value:function(e){console.log("isCheck",e),e?this.setState({isVisibleAdditionMessage:"visible",marginTopAddMessage:"30px"}):this.setState({isVisibleAdditionMessage:"hidden",marginTopAddMessage:"0px"})}},{key:"render",value:function(){return r.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},r.a.createElement(y.a,{md:"auto"},r.a.createElement(v.a,null,r.a.createElement("b",null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u0447\u0442\u043e \u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c")),r.a.createElement(te.a,{preloadEnabled:!1,name:this.props.field,selection:{mode:"single"},showBorders:!0,hoverStateEnabled:!0,columnAutoWidth:!0,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},r.a.createElement(ee.Column,{dataField:"numberke",caption:"\u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"nameke",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"position",caption:"\u041f\u043e\u0437\u0438\u0446\u0438\u044f \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"is_circ",caption:"\u0412\u043e\u0437\u043c\u043e\u0436\u0435\u043d \u043f\u043e\u0432\u043e\u0440\u043e\u0442",width:0,dataType:"boolean",visible:!1}),r.a.createElement(ee.Column,{dataField:"recid",caption:"Guid \u0437\u0430\u043f\u0438\u0441\u0438 \u0421\u0427/\u0421\u0415",width:0,dataType:"string",visible:!1})),r.a.createElement("div",{style:{marginTop:this.state.marginTopCheckBox,visibility:this.state.isVisibleCheckbox}},r.a.createElement(Se,{value:this.props,field:"check_box_nbd",setFieldValue:this.props.setFieldValue,activeRecord:this.props.activeRecord,updateData:this.updateDataCheckBox})),r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ne.a,{color:"success",isOpen:this.state.visible_alert},r.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),this.state.selectedRowNotes,r.a.createElement("p",{style:{marginBottom:this.state.marginTopAddMessage,visibility:this.state.isVisibleAdditionMessage}},r.a.createElement("b",null,this.state.additionMessage))))))}},{key:"visibleCheckboxChanged",value:function(e){"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0435\u0437 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445 \u0443\u0437\u043b\u043e\u0432"==e.nameke||"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430"==e.nameke||"\u0422\u0435\u043b\u0435\u0436\u043a\u0430"==e.nameke?(this.setState({isVisibleCheckbox:"visible",marginTopCheckBox:"30px"}),console.log("selection_change",this.state)):(this.setState({isVisibleCheckbox:"hidden",marginTopCheckBox:"0"}),console.log("selection_change2",this.state))}},{key:"findMainNode",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.parent_ke_node){e.next=7;break}return e.next=3,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.parent_ke_node,")"));case 3:return n=e.sent,e.abrupt("return",this.findMainNode(n.value[0]));case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,s,l,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedRowsData,a=n[0],console.log("data",a),this.visibleCheckboxChanged(a),null==this.props.values.select_field.key_element_code){e.next=15;break}if(null==this.props.values.select_field.ke_node){e.next=13;break}return e.next=8,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.ke_node,")"));case 8:o=e.sent,l=o.value[0],s=r.a.createElement(r.a.Fragment,null,r.a.createElement("b",null,l.ke_node_type_calculated," ",l.unique_number),", \u0432 \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043e ",r.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke)),e.next=15;break;case 13:l=this.props.values.select_field,s=r.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke);case 15:if(null==this.props.values.select_field.ke_node_type){e.next=20;break}return e.next=18,this.findMainNode(this.props.values.select_field);case 18:l=e.sent,s=null!=this.props.values.select_field.parent_ke_node?r.a.createElement(r.a.Fragment,null,r.a.createElement("b",null,l.ke_node_type_calculated," ",l.unique_number),", \u0432 \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043e ",r.a.createElement("b",null,this.props.values.select_field.ke_node_type_calculated," ",this.props.values.select_field.unique_number)):r.a.createElement("b",null,l.ke_node_type_calculated," ",l.unique_number);case 20:this.props.updateData(a,l.recid),i=r.a.createElement("p",null,"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435 ",this.props.activeRecord.manufacturer_number," ",r.a.createElement("b",null,a.nameke," ",a.numberke)," \u043d\u0430 ",s),this.setState({visible_alert:!0,select_element:a,selectedRowNotes:i}),this.props.setFieldValue(this.props.field,a);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(a.Component);n(1136);function Ce(e){return je.apply(this,arguments)}function je(){return(je=Object(m.a)(p.a.mark((function e(t){var n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(t,")"));case 2:if(n=e.sent,(a=n.value).forEach((function(e){r=Ce(e.recid)})),console.log("childelements",t,n,a.concat(r)),!(void 0!=r&&null!=r&&r.length>0)){e.next=10;break}return e.abrupt("return",a.concat(r));case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F("/odata/reestr_key_elements?$filter=(ke_node eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e){return Te.apply(this,arguments)}function Te(){return(Te=Object(m.a)(p.a.mark((function e(t){var n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Array,"",console.log("GetLinksToElementsUnregisteredInRzd",t,n),null==t){e.next=16;break}return t.is_registratred_in_rzd||n.push({link:"/tables/reestr_ke_nodes/".concat(t.recid),text:t.unique_number}),e.next=8,Ae(t.recid);case 8:return a=e.sent,console.log("childKeyElements",a),a.forEach((function(e){e.is_registratred_in_rzd||n.push({link:"/tables/reestr_key_elements/".concat(e.recid),text:e.numberke})})),e.next=13,Ce(t.recid);case 13:r=e.sent,console.log("childAssemblyElements",r),r.forEach((function(e){e.is_registratred_in_rzd||n.push({link:"/tables/reestr_ke_nodes/".concat(e.recid),text:e.unique_number})}));case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var De=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){null!=e&&(console.log("handleChange",e),a.handleNewOptionClick(e))},a.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,r,s,l,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),a.setState({isLoadingDetail:!0}),n=X(t.value),e.next=5,a.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(n,"')"));case 5:if(r=e.sent,!a.isNullOrEmptyResponse(r)){e.next=9;break}return a.setState({isLoadingDetail:!1}),e.abrupt("return",a.modalError("\u0421\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u0423\u0418\u041d ".concat(n," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435")));case 9:return s=r.value[0],e.next=12,a.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(s.recid,")"));case 12:return l=e.sent,e.next=15,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(s.recid,")"));case 15:if(o=e.sent,!a.isNullOrEmptyResponse(o)||!a.isNullOrEmptyResponse(l)){e.next=19;break}return a.setState({isLoadingDetail:!1}),e.abrupt("return",a.modalError("\u041f\u043e \u0423\u0418\u041d ".concat(n," \u043d\u0435 \u0431\u044b\u043b\u043e \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0439 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435.")));case 19:if(c=null,d=null,a.isNullOrEmptyResponse(l)||!a.isNullOrEmptyResponse(o)){e.next=39;break}if(null!=(c=l.value[0]).ke_node){e.next=30;break}i="".concat(c.numberke,", ").concat(c.key_element_code_calculated),a.setState({currentElementType:"key_element"}),u="",c.is_registratred_in_rzd||(d=[{link:"/tables/reestr_key_elements/".concat(c.recid),text:c.numberke}]),e.next=39;break;case 30:return e.next=32,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(c.ke_node,")"));case 32:return m=e.sent,i="".concat(c.numberke,", ").concat(c.key_element_code_calculated),a.setState({currentElementType:"key_element"}),u="\u0412\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 ".concat(m.value[0].ke_node_type_calculated," ").concat(m.value[0].unique_number),e.next=38,Re(m.value[0]);case 38:d=e.sent;case 39:if(a.isNullOrEmptyResponse(o)){e.next=60;break}if(null!=(c=o.value[0]).parent_ke_node){e.next=50;break}return i="".concat(c.unique_number,", ").concat(c.ke_node_type_calculated),a.setState({currentElementType:"assembly_element"}),u="",e.next=47,Re(c);case 47:d=e.sent,e.next=60;break;case 50:return e.next=52,a.getparentse(c.parent_ke_node);case 52:return h=e.sent,console.log("parentAssemblyUnit",h),i="".concat(c.unique_number,", ").concat(c.ke_node_type_calculated),a.setState({currentElementType:"assembly_element"}),u="\u0412\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 ".concat(h.ke_node_type_calculated," ").concat(h.unique_number),e.next=59,Re(h);case 59:d=e.sent;case 60:return t.label=i,a.setState({option:t,currentElement:c,isLoadingDetail:!1}),a.setState({text_select:u}),a.props.updateData(null==d||0==d.length,d),a.props.setFieldValue(a.props.field,a.state.currentElement),e.abrupt("return");case 66:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.getparentse=function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getparentse",t),e.next=3,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t,")"));case 3:if(n=e.sent,console.log("getparentse",n),a.isNullOrEmptyResponse(n)){e.next=11;break}if(null==n.value[0].parent_ke_node){e.next=10;break}return e.abrupt("return",a.getparentse(n.value[0].parent_ke_node));case 10:return e.abrupt("return",n.value[0]);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.state={option:"",currentElement:{},currentElementType:"",text_select:"\u0421\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0434\u043b\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u043a\u043e\u043c\u043f\u043b\u0435\u043a\u0442\u0430\u0446\u0438\u0438 \u0432\u0430\u0433\u043e\u043d\u0430",isLoadingDetail:!1},a.handleNewOptionClick=a.handleNewOptionClick.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"deleteValue",value:function(){this.setState({option:null}),this.setState({text_select:"\u0421\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0434\u043b\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u043a\u043e\u043c\u043f\u043b\u0435\u043a\u0442\u0430\u0446\u0438\u0438 \u0432\u0430\u0433\u043e\u043d\u0430"}),this.props.updateData(!1),this.props.setFieldValue(this.props.field,null)}},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&T(!1,e)}},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},r.a.createElement(y.a,{sm:4},r.a.createElement(v.a,{for:"creatable"},r.a.createElement("b",null,"\u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438"))),r.a.createElement(y.a,{sm:8},r.a.createElement(J.a,{id:"creatable",name:this.props.field,components:{SingleValue:function(t){var n={backgroundColor:t.data.backgroundColor,color:t.data.color};return r.a.createElement("div",{className:"SelectValue",style:n},r.a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.deleteValue()}},"\xd7"),r.a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,r.a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.option,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isMulti:!1,isClearable:!1,isLoading:this.state.isLoadingDetail,isDisabled:this.state.isLoadingDetail,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}},autoFocus:!0}),r.a.createElement(O.a,{className:"text-muted"},this.state.text_select)))}}]),n}(a.Component),qe=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?this.setState({waiting:!1}):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),Ve=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:{}},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){console.log("activeRecord",window.activeRecord),null!=window.activeRecord?this.setState({activeRecord:window.activeRecord}):this.setState({activeRecord:{reccode:null,reccreated:"2020-10-20T11:38:42.320928+08:00",reccreatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",recdescription:null,recid:"9f46e82c-f027-49d3-b81c-f032f869c25a",recname:null,recstate:1,recupdated:"2020-10-23T00:49:34.77997+08:00",recupdatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",sysboolean_test:!1,sysdate_test:null,sysdecimal_test:null,sysenum_test:1,sysfile_test:null,sysimage_test:"",sysint_test:null,sysmoney_test:0,sysnumber_test:"\u0422\u0435\u0441\u0442\u043e\u0432\u043e\u0435 \u043e\u043a\u043d\u043e",sysstring_test:"",systime_test:null,systimedate_test:null}})}},{key:"render",value:function(){return r.a.createElement(Me,{method:{name:"test_procedure_update",displayName:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",isEnabled:null,isAnonymous:!1,static:!1,fields:[],showModalYesNo:null,initMethodParams:null,isPacketSigned:null,workflow:null,table:"types_table"},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord})}}]),n}(a.Component),Me=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={scunned_element:"",replaced_element:"",new_element:"",is_visible_data_grid:!1,link_unregistered_elements:"",processingAction:!1,isActionError:!1,successMessage:"",showModal:!1},e.getInitialValues=e.getInitialValues.bind(Object(h.a)(e)),e.renderPluginDataGrid=e.renderPluginDataGrid.bind(Object(h.a)(e)),e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.updateDataFromSelect=e.updateDataFromSelect.bind(Object(h.a)(e)),e.updateDataFromDataGrid=e.updateDataFromDataGrid.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"getInitialValues",value:function(){var e=this,t={};return this.props.method.fields.forEach((function(n){if(null!=e.props.initialValues){var a=void 0!==Fe[n.type]?Fe[n.type]:"";if(n.default){var r="var activeRecord = ".concat(JSON.stringify(e.props.initialValues),"; var result = ").concat(n.default,"(); return result;");a=new Function(r)()}t[n.name]=null!=e.props.initialValues[n.name]?e.props.initialValues[n.name]:a}else t[n.name]=Fe[n.type]})),t}},{key:"renderPluginDataGrid",value:function(e){var t=this;return this.state.is_visible_data_grid?r.a.createElement(g.a,{key:"data_grid",name:"data_grid"},(function(n){var a=n.formikfield;n.form;return r.a.createElement(we,Object.assign({value:t.props,field:"data_grid",setFieldValue:e.setFieldValue,updateData:t.updateDataFromDataGrid,activeRecord:t.props.activeRecord},e,a))})):null!=this.state.link_unregistered_elements&&0!=this.state.link_unregistered_elements.length?r.a.createElement("div",{style:{marginTop:"20px"}},r.a.createElement(ne.a,{color:"dark",isOpen:!0,style:{backgroundColor:"#e8e8e8"}},r.a.createElement("p",{style:{margin:"0 auto"}},r.a.createElement("h4",{className:"alert-heading"},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435"),"\u0423\u0447\u0435\u0442 \u0438\u0437\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0423\u0418\u041d ",this.state.link_unregistered_elements.map((function(e,n){return console.log("element",e),r.a.createElement("a",{href:e.link,target:"_blank",class:"alert-link"},n==t.state.link_unregistered_elements.length-1?e.text:e.text+", ")}))," \u043d\u0435 \u0431\u044b\u043b \u043e\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043b\u0435\u043d, \u0437\u0430\u043c\u0435\u043d\u0430 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430."))):void 0}},{key:"validateRegistratedInRzd",value:function(e){}},{key:"updateDataFromSelect",value:function(e,t){console.log("updateDataFromSelect",e,t),this.setState({is_visible_data_grid:e,link_unregistered_elements:t}),console.log("updateDataFromSelect",this.state)}},{key:"updateDataFromDataGrid",value:function(e,t){console.log("value3",e),this.setState({replaced_element:e,new_element:t}),console.log("updateDataFromDataGrid",this.state)}},{key:"modalError",value:function(e){this.setState({showModal:!1}),null!=e&&(this.setState({processingAction:!1}),T(!1,e))}},{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("handleclick1",this.refs.formik),void 0!=(t=this.refs.formik.state.values).data_grid&&null!=t.data_grid){e.next=6;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430\u043c\u0435\u043d\u0443. \u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d \u0437\u0430\u043c\u0435\u043d\u044f\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442"));case 6:if(console.log("newElement",this.state.new_element),n=this.state.new_element,t.data_grid.numberke,a=t.check_box_nbd,r=t.data_grid.position,s=t.data_grid.recid,n!=s){e.next=15;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430\u043c\u0435\u043d\u0443. \u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0423\u0418\u041d \u0421\u0427 \u0443\u0436\u0435 \u0441\u0442\u043e\u0438\u0442 \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435"));case 15:if(null==t.select_field.batchid){e.next=18;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430\u043c\u0435\u043d\u0443. \u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0423\u0418\u041d \u0421\u0427/\u0421\u0415 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u0438"));case 18:return(l={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null}).body=JSON.stringify({vehicle_recid:this.props.activeRecord.recid,new_element_recid:n,is_rotation:a,position:r,old_element_recid:s}),e.next=22,D("/plugins/nbdlogicplugin/replacekeyelementorassemblyunitinvehicle",l.body);case 22:if(o=e.sent,console.log("result_replace_resp",o),!o.success){e.next=32;break}return this.setState({processingAction:!1}),this.setState({processingAction:!1,successMessage:o.message,errorMessage:o.message,isActionError:o.success}),window.closePluginModal(),T(!0,"".concat(o.message)),e.abrupt("return",{success:o.success,message:o.message});case 32:this.setState({processingAction:!1}),this.setState({processingAction:!1,successMessage:o.message,errorMessage:o.message,isActionError:o.success}),T(!1,"".concat(o.message));case 35:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderTest",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",initialValues:this.getInitialValues(),enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0417\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u0434\u0435\u0442\u0430\u043b\u0438"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0},disabled:null!=e.state.link_unregistered_elements&&0!=e.state.link_unregistered_elements.length},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"select_field",name:"select_field"},(function(){return r.a.createElement(De,{setFieldValue:t.setFieldValue,field:"select_field",updateData:e.updateDataFromSelect})})),e.renderPluginDataGrid(t))}}),r.a.createElement(qe,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}))}}]),n}(r.a.Component),Fe={SysGUID:"",SysString:"",SysMultiLineString:"",SysBoolean:!1,SysNumber:null,SysInt:null,SysMoney:0,SysDecimal:null,SysENUM:null,SysRelation:null},Pe=Ve,Ie=(n(1137),a.Component,a.Component,a.Component,n(1138),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){null!=e&&e.length>a.state.options.length&&a.handleNewOptionClick(e[e.length-1]),console.log("handle_change"),console.log("handle_change",e),a.props.setFieldValue(a.props.field.name,JSON.stringify(e))},a.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleNewOptionClick",t),n=X(t.value),a.setState({isLoadingDetail:!0}),(r=a.state.addedItems).push(n),!(null!=a.state.options&&a.state.options.length>0)){e.next=10;break}if(s=Object(C.a)(a.state.options),null==s.find((function(e){return e.numberValue==n}))){e.next=10;break}return e.abrupt("return",a.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 10:if(null==n&&""==n){e.next=15;break}return e.next=13,a.validateKeyElementForConfirmBatch(n);case 13:e.next=16;break;case 15:return e.abrupt("return",a.modalError("\u0412 \u043f\u0430\u0440\u0442\u0438\u044e \u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0421\u0427"));case 16:a.setState({addedItems:r});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.prepareValue=function(){return a.props.value instanceof Array?a.props.value[0]:a.props.value},a.state={options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null,isAssemblyUnit:!1,hintText:"\u0421\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0432 \u043f\u0430\u0440\u0442\u0438\u0438"},a.handleNewOptionClick=a.handleNewOptionClick.bind(Object(h.a)(a)),a.handleModalChange=a.handleModalChange.bind(Object(h.a)(a)),a.renderDeleteConfirm=a.renderDeleteConfirm.bind(Object(h.a)(a)),a.handleOkModal=a.handleOkModal.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"validateKeyElementForConfirmBatch",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h,f,b,_;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("24225a06-5efb-4966-9db6-1c47acb92bcf"==this.props.activeRecord.batch_status){e.next=2;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0423\u0418\u041d, \u043f\u043e\u043a\u0430 \u043f\u0430\u0440\u0442\u0438\u044f <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441\u0435.")));case 2:if(80,!(this.props.activeRecord.count_passport+this.state.options.length>=80)){e.next=5;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427 ").concat(t,": \u043f\u0440\u0435\u0432\u044b\u0448\u0435\u043d \u043b\u0438\u043c\u0438\u0442 \u0432 \u043f\u0430\u0440\u0442\u0438\u0438.")));case 5:return this.setState({currentElement:t,currentElementType:"numberkeConfirm"}),n={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"ke_numbers",options:{recname:t}}},e.next=9,V("/api/executejs",n);case 9:if(0!=(a=e.sent).result.result.success||null!=a.result.result.data){e.next=12;break}return e.abrupt("return",this.modalError("\u0423\u0418\u041d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435"));case 12:return r=a.result.result.data[0],s={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_key_elements",options:{ke_number:r.recid}}},e.next=16,V("/api/executejs",s);case 16:return l=e.sent,o={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{unique_number_relation:r.recid}}},e.next=20,V("/api/executejs",o);case 20:if(i=e.sent,!this.isNullOrEmptyResponseAnonym(l.result.result)||!this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=23;break}return e.abrupt("return",this.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 23:if(c=null,this.isNullOrEmptyResponseAnonym(l.result.result)||!this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=32;break}return u={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_key_elements",options:{numberke:t,batchid:this.props.activeRecord.recid}}},e.next=28,V("/api/executejs",u);case 28:if(c=e.sent,!this.isNullOrEmptyResponseAnonym(c.result.result)){e.next=31;break}return e.abrupt("return",this.modalError("\u0421\u0427 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a >.")));case 31:this.setState({currentElement:l.result.result.data[0]});case 32:if(!this.isNullOrEmptyResponseAnonym(l.result.result)||this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=40;break}return d={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{unique_number:t,batchid:this.props.activeRecord.recid}}},e.next=36,V("/api/executejs",d);case 36:if(c=e.sent,!this.isNullOrEmptyResponseAnonym(c.result.result)){e.next=39;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a >.")));case 39:this.setState({currentElement:i.result.result.data[0],isAssemblyUnit:!0});case 40:if(this.isNullOrEmptyResponseAnonym(l.result.result)||this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=48;break}return d={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{unique_number:t,batchid:this.props.activeRecord.recid}}},e.next=44,V("/api/executejs",d);case 44:if(c=e.sent,!this.isNullOrEmptyResponseAnonym(c.result.result)){e.next=47;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a >.")));case 47:this.setState({currentElement:i.result.result.data[0],isAssemblyUnit:!0});case 48:if(c.result.result.data[0],2!=this.props.activeRecord.is_assembly_unit_or_key_element){e.next=69;break}if(null==this.props.activeRecord.product_name||""==this.props.activeRecord.product_name){e.next=69;break}if(this.isNullOrEmptyResponseAnonym(l.result.result)){e.next=59;break}return m={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{recid:l.result.result.data[0].ke_node,batchid:this.props.activeRecord.recid}}},e.next=55,V("/api/executejs",m);case 55:if(h=e.sent,h.result.result.data[0],!this.isNullOrEmptyResponseAnonym(h.result.result)){e.next=59;break}return e.abrupt("return",this.modalError("\u0421\u0427 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a > \u0438\u043b\u0438 \u043d\u0435 \u0432\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0421\u0415, \u043d\u0430\u0445\u043e\u0434\u044f\u0449\u0438\u0439\u0441\u044f \u0432 \u043f\u0430\u0440\u0442\u0438\u0438.")));case 59:if(this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=69;break}if(null==(f=i.result.result.data[0]).parent_ke_node||""==f.parent_ke_node){e.next=69;break}return b={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{recid:f.parent_ke_node,batchid:this.props.activeRecord.recid}}},e.next=65,V("/api/executejs",b);case 65:if(_=e.sent,_.result.result.data[0],!this.isNullOrEmptyResponseAnonym(_.result.result)){e.next=69;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a > \u0438\u043b\u0438 \u043d\u0435 \u0432\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0421\u0415, \u043d\u0430\u0445\u043e\u0434\u044f\u0449\u0438\u0439\u0441\u044f \u0432 \u043f\u0430\u0440\u0442\u0438\u0438.")));case 69:return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 72:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&T(!1,e)}},{key:"isNullOrEmptyResponseAnonym",value:function(e){return null==e.data||0==e.success}},{key:"handleOkModal",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleOkModal_",this),t=this.state.options,console.log("handleOkModal",t),a=!1,"numberkeConfirm"==this.state.currentElementType&&(console.log("numberkeConfirm",this.state),null!=this.state.modalValue&&""!=this.state.modalValue||(n="".concat(1==this.state.isAssemblyUnit?this.state.currentElement.unique_number:this.state.currentElement.numberke)),console.log("numberValue_state",this.state),r=1==this.state.isAssemblyUnit?this.state.currentElement.unique_number:this.state.currentElement.numberke,s=1==this.state.isAssemblyUnit?this.state.currentElement.ke_node_type_calculated:this.state.currentElement.key_element_code_calculated,console.log("numberValue",r),a=!0),console.log("test_options",this.state),t.push({value:"".concat(this.state.currentElement.recid),label:n,numberValue:r,backgroundColor:void 0,color:void 0,node:void 0,nodeObj:this.state.currentElement,isKeyElement:a,isAssemblyUnit:this.state.isAssemblyUnit,name:s}),console.log("handleOkModal3",t),this.setState({options:t,showModal:!1,isLoadingDetail:!1,modalValue:""}),console.log("handleOkModal4",t),l=t.map((function(e){return{numberValue:e.numberValue,recid:e.value,isAssemblyUnit:e.isAssemblyUnit,name:e.name}})),console.log("handleOkModal4",l),this.props.setFieldValue(this.props.field.name,JSON.stringify(l));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(C.a)(this.state.options),-1!==(a=n.indexOf(t))&&(n.splice(a,1),this.setState({options:n}),this.props.setFieldValue(this.props.field.name,JSON.stringify(n))),this.setState({showDeleteModal:!1}),r=Object(C.a)(this.state.addedItems),s=r.find((function(e){return e==t.numberValue})),-1!==(l=r.indexOf(s))&&(r.splice(l,1),this.setState({addedItems:r}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return a.createElement(W.a,{isOpen:this.state.showDeleteModal,size:"xl"},a.createElement(H.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),a.createElement(Z.a,null,a.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),a.createElement(Y.a,null,a.createElement(b.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),a.createElement(b.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},a.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;console.log("render_creatable",this.props);return a.createElement(k.a,null,a.createElement(v.a,null,a.createElement("b",null,this.props.field.displayName)),a.createElement(J.a,{name:this.props.field.name,components:{MultiValue:function(t){var n={backgroundColor:t.data.backgroundColor,color:t.data.color};return a.createElement("div",{className:"SelectValue",style:n},a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t.data)}},"\xd7"),a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.options,isMulti:!0,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.props.field.isDisabled||this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,autoFocus:this.props.field.autoFocus||!1,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}),a.createElement(O.a,{className:"text-muted"},1!=this.props.isGetBatchField?this.state.hintText:"\u0421\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0445 \u0447\u0430\u0441\u0442\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b"),this.renderDeleteConfirm())}}]),n}(a.Component)),Le=(a.Component,a.Component,function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={checkBoxValue:void 0},e.onValueChanged=e.onValueChanged.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"onValueChanged",value:function(e){this.setState({checkBoxValue:e.value}),this.props.setFieldValue(this.props.field.name,e.value),this.props.updateData(e.value)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(oe.CheckBox,{name:this.props.field.name,onValueChanged:this.onValueChanged,text:this.props.field.displayName,defaultValue:!1}))}}]),n}(a.Component)),ze=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),Be=(a.Component,function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={value:""},a}return Object(i.a)(n,[{key:"render",value:function(){return console.log("this.props_message",this.props),console.log("this.props_message",this.refs),r.a.createElement("div",{style:{marginTop:"20px"}},r.a.createElement(ne.a,{color:"dark",isOpen:this.props.isvisibleMessage,name:this.props.field.name,style:{backgroundColor:"#e8e8e8"}},r.a.createElement("p",{style:{margin:"0 auto"}},r.a.createElement("b",null,this.props.field.text_bold),this.props.field.text)))}}]),n}(a.Component));function Ge(e){return"undefined"!==typeof e&&null!=e&&Object.keys(e).forEach((function(t){"undefined"!==typeof e[t]&&null!=e[t]&&{}.hasOwnProperty.call(e[t],"_value")&&(e[t]=e[t]._value),"object"===typeof e[t]&&(e[t]=Ge(e[t]))})),e}var $e=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,tableName:"",place:""},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){console.log("rdev_modalDataPack",window.rdev_modalDataPack),"edit"==window.rdev_modalDataPack.place?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords}):window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent?this.setState({activeRecord:Ge(window.rdev_modalDataPack.selectedRecords[0])}):this.setState({activeRecord:null}),this.setState({tableName:window.rdev_modalDataPack.tableName}),this.setState({place:window.rdev_modalDataPack.place}),console.log("active=",window.rdev_modalDataPack.selectedRecords)}},{key:"render",value:function(){return r.a.createElement(Ue,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},place:this.state.place,tableName:this.state.tableName,initialValues:{},activeRecord:this.state.activeRecord})}}]),n}(a.Component),Ue=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateStateMessage=function(t){e.setState({is_visible_message:t})},e.state={selected_template:null,count:1,is_pasported:!1,is_uin_field_empty:!0,is_uin_elements_field_empty:!0,is_uin_data_empty:!0,uin_grouping_elements:[],show_modal:!1,ref_data_grid:null,select_template_plate_field:null,select_template_insert_field:null,select_template_ring_field:null,select_application_number_field:null,processingAction:!1,isActionError:!1,successMessage:"",stateTableLoaded:!1,stateTableLoading:!1,is_visible_message:!1},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.updateStateMessage=e.updateStateMessage.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("handleclick",this.props),console.log("handleclick",this.refs),"undefined"!==this.refs.formik.state.values.uin_elements_field&&null!=this.refs.formik.state.values.uin_elements_field){e.next=6;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0423\u0418\u041d \u0434\u043b\u044f \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438". '));case 6:if("undefined"!==this.refs.formik.state.values.is_get_batch_field&&null!=this.refs.formik.state.values.is_get_batch_field||(this.refs.formik.state.values.is_get_batch_field=!1),t=JSON.parse(this.refs.formik.state.values.uin_elements_field),console.log("ke_numbers_arr",t),t.length,1==this.refs.formik.state.values.is_get_batch_field){e.next=21;break}return n=t[0].numberValue,a={ke_number:n,recid:this.props.activeRecord.recid,is_get_batch_partially:this.refs.formik.state.values.is_get_batch_field},r={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)},console.log("requestBody",r),e.next=17,D("/plugins/nbdlogicplugin/confirmbatch",r.body);case 17:s=e.sent,console.log("result_confirmbatch_resp",s),e.next=30;break;case 21:return console.log("\u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e\u0435 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435"),a={ke_number:JSON.stringify(t),recid:this.props.activeRecord.recid,is_get_batch_partially:this.refs.formik.state.values.is_get_batch_field},console.log("parameters",a),r={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)},console.log("requestBody",r),e.next=28,D("/plugins/nbdlogicplugin/confirmbatchpartially",r.body);case 28:s=e.sent,console.log("result_confirmbatch_resp",s);case 30:if(!s.success){e.next=36;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(s.message)));case 36:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(s.message)));case 38:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"uin_elements_field",name:"uin_elements_field"},(function(){return r.a.createElement(Ie,{setFieldValue:t.setFieldValue,activeRecord:e.props.activeRecord,tableName:e.props.tableName,isGetBatchField:e.state.is_visible_message,field:{name:"uin_elements_field",displayName:"\u0423\u0418\u041d \u0434\u043b\u044f \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438",autoFocus:!0}})})),r.a.createElement(g.a,{key:"is_get_batch_field",name:"is_get_batch_field"},(function(){return r.a.createElement(Le,{setFieldValue:t.setFieldValue,activeRecord:e.props.activeRecord,tableName:e.props.tableName,updateData:e.updateStateMessage,defaultValues:!1,field:{name:"is_get_batch_field",displayName:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u0442\u0438\u044e \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e"}})})),r.a.createElement(g.a,{key:"message_field",name:"message_field"},(function(){return r.a.createElement(Be,{setFieldValue:t.setFieldValue,activeRecord:e.props.activeRecord,tableName:e.props.tableName,isvisibleMessage:e.state.is_visible_message,field:{name:"message_field",text_bold:"\u0412 \u0440\u0430\u043c\u043a\u0430\u0445 \u0434\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u0440\u0442\u0438\u0438 \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u0440\u0438\u043d\u044f\u0442\u044b \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438, \u0423\u0418\u041d \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0431\u044b\u043b\u0438 \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u044b. ",text:"\u0412\u0441\u0435 \u043f\u0440\u043e\u0447\u0438\u0435 \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438 \u0431\u0443\u0434\u0443\u0442 \u043f\u0440\u0438\u043d\u044f\u0442\u044b \u0438 \u043f\u043e \u043d\u0438\u043c \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0441\u043f\u043e\u0440\u0442\u0430."}})})))}}),r.a.createElement(ze,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}}]),n}(r.a.Component),Ke=(n(1139),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),a.setState({selectedValue:e}),a.props.setFieldValue(a.props.field,a.state.selectedValue),a.props.updateData(e,a.props.field.name)},a.state={options:[],uin:null,currentElement:{},currentElementType:"",text_select:"",selectedValue:null,fieldForShow:"recname"},a.getDictionaries=a.getDictionaries.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("state=",this.state),console.log("props=",this.props),console.log("componentDidMount"),this.getDictionaries(),this.props.field.isUinField&&(this.setState({uin:null!=this.props.field.uin?this.props.field:null}),null!=this.props.field.uin&&this.props.updateUinState(!1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDictionaries",value:function(){var e=this,t="",n="",a="",r="";switch(this.props.field.name){case"disposal_reason_field":if(t="dictionary_disposal_reasons",this.setState({fieldForShow:"recname"}),n="recname,name_key_element,name_ke_node",console.log("this.props.field.filter",this.props.field.filter),console.log("this.props.tableName",this.props.tableName),""==(a=null!=this.props.field.filter&&""!=this.props.field.filter?"reestr_key_elements"==this.props.tableName?"name_key_element eq ".concat(this.props.field.filter," and "):"name_ke_node eq ".concat(this.props.field.filter," and "):""))return this.setState({options:null}),void this.setState({selectedValue:null});break;case"uin_relation_field":n="reestr_key_elements"==(t=this.props.tableName)?"key_element_code,numberke":"unique_number,ke_node_type",a="recid eq ".concat(this.props.activeRecord.recid," and "),r="reestr_key_elements"==t?"key_element_codeitem($select=recname)":"ke_node_typeitem($select=recname)"}console.log("/odata/".concat(t,"?$select=").concat(n,",recid&$orderBy=").concat(n,"&$filter=").concat(a,"recstate eq 1&$expand=").concat(r)),fetch("/odata/".concat(t,"?$select=").concat(n,",recid&$orderBy=").concat(n,"&$filter=").concat(a,"recstate eq 1&$expand=").concat(r),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(n){if(e.isNullOrEmptyResponse(n))return console.log("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 ".concat(t," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));if("repair_operation_field"==e.props.field.name&&n.value.forEach((function(e){return e.recname=e.work_performed_type_operationitem.repair_operation})),"uin_relation_field"==e.props.field.name){console.log("uin response",n.value);var a={recid:n.value[0],recname:"reestr_key_elements"==t?"".concat(n.value[0].numberke,", ").concat(n.value[0].key_element_codeitem.recname):"".concat(n.value[0].unique_number,", ").concat(n.value[0].ke_node_typeitem.recname)};e.setState({selectedValue:a}),e.props.updateData(n.value[0],e.props.field.name)}else e.setState({options:n.value}),console.log("loadRepairTypes data.value ",n.value)})).catch((function(e){console.log("Request failed: ",e)}))}},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,{row:!0},r.a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(j.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(t){return t[e.state.fieldForShow]},getOptionValue:function(e){return e.recid},options:this.state.options,onChange:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,isDisabled:this.props.field.isUinField||this.props.field.isDisabled,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}})))}}]),n}(a.Component)),Je=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),We=(n(1140),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){if(console.log("date change"),null!=e.value){ve()().utcOffset();var t=ve()(e.value),n=new Date(Date.UTC(t.year(),t.month(),t.date()));a.setState({selectedValue:n}),a.props.setFieldValue(a.props.field.name,n)}else a.setState({selectedValue:null}),a.props.setFieldValue(a.props.field.name,e.value);a.props.setFieldTouched(a.props.field.name,!0),a.props.updateData(e.value,a.props.field.name)},a.getType=function(){return"SysTimeDate"===a.props.field.type?"datetime":"SysDate"===a.props.field.type?"date":"datetime"},a.state={selectedValue:new Date},a.handleChange=a.handleChange.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",elementAttr:{class:"rdev-read-only-control"}},r.a.createElement(k.a,{key:"input_".concat(this.props.field.name),row:!0},r.a.createElement(v.a,{sm:4,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:8,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(ge.DateBox,{className:"repairFormDateBox",width:"100%",type:"date",id:this.props.field,name:this.props.field.name,defaultValue:new Date,showClearButton:!0,useMaskBehavior:!0,displayFormat:"dd.MM.yyyy",onValueChanged:this.handleChange,value:this.state.selectedValue})))}}]),n}(a.Component)),He=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(k.a,{row:!0},r.a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(E.a,{name:this.props.field.name,onBlur:this.props.onBlur,disabled:this.props.field.isDisabled,defaultValue:null!=this.props.activeRecord.numberke?this.props.activeRecord.numberke:this.props.activeRecord.unique_number})))}}]),n}(a.Component),Ze=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,tableName:"",place:"",isNeedDataGrid:!1},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){console.log("rdev_modalDataPack",window.rdev_modalDataPack),"edit"==window.rdev_modalDataPack.place?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords}):window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords[0]}):this.setState({activeRecord:null,isNeedDataGrid:!0}),this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place}),console.log("active=",window.rdev_modalDataPack.selectedRecords)}},{key:"render",value:function(){return r.a.createElement(Ye,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},place:this.state.place,tableName:this.state.tableName,initialValues:{},activeRecord:this.state.activeRecord})}}]),n}(a.Component),Ye=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateSelectedValues=function(t,n){switch(n){case"uin_relation_field":e.setState({selectedRecord:e.props.activeRecord,selectedElementType:"reestr_key_elements"==e.props.tableName?t.key_element_code:t.ke_node_type});break;case"disposal_reason_field":e.setState({selectedDisposalReason:t})}},e.updateSelectedDate=function(t){e.setState({selectedDisposalDate:t})},e.state={selectedDisposalReason:null,selectedFaultType:null,selectedRepairOperation:null,selectedDisposalDate:new Date,selectedRecord:null,selectedRow:null,selectedTable:"",selectedElementType:"",isVisibleDataGrid:!1,inputRecord:null,uin:null,is_type_repair_empty:!0,is_uin_creatable_lookup_empty:!0,is_uin_empty:!0,processingAction:!1,ref_data_grid:null},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.dataGrid={},e.updateSelectedValues=e.updateSelectedValues.bind(Object(h.a)(e)),e.updateSelectedDate=e.updateSelectedDate.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),t="","undefined"!==this.state.selectedDisposalDate&&null!=this.state.selectedDisposalDate||(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0414\u0430\u0442\u0430 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438". ')),this.isNullObject(this.state.selectedDisposalReason)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438". ')),n=new Date(this.state.selectedDisposalDate).toLocaleDateString(),console.log("this.state.selectedDisposalDate",n),!this.isNotEmptyString(t)){e.next=11;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,t));case 11:return a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({recid:this.props.activeRecord.recid,table_name:this.props.tableName,disposal_date:n,disposal_reason:this.state.selectedDisposalReason.recname})},console.log("requestBody",a),e.next=15,D("/plugins/nbdlogicplugin/registerdisposal",a.body);case 15:if(r=e.sent,console.log("registerdisposal_resp",r),!r.success){e.next=23;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(r.message)));case 23:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(r.message)));case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044e"),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"uin_relation_field",name:"uin_relation_field"},(function(){return r.a.createElement(He,{setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,field:{name:"uin_relation_field",displayName:"\u0423\u0418\u041d",isDisabled:!0},activeRecord:e.props.activeRecord,tableName:e.props.tableName})})),r.a.createElement(g.a,{key:"date_field",name:"date_field"},(function(){return r.a.createElement(We,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedDate,field:{name:"date_field",displayName:"\u0414\u0430\u0442\u0430 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438",isUinElementsField:!0}},t))})),r.a.createElement(g.a,{key:"disposal_reason_field",name:"disposal_reason_field"},(function(){return r.a.createElement(Ke,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,tableName:e.props.tableName,field:{name:"disposal_reason_field",displayName:"\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438",filter:null!=e.props.activeRecord&&null!=e.props.activeRecord?"reestr_key_elements"==e.props.tableName?void 0==e.props.activeRecord.key_element_code._value?e.props.activeRecord.key_element_code:e.props.activeRecord.key_element_code._value:void 0==e.props.activeRecord.ke_node_type._value?e.props.activeRecord.ke_node_type:e.props.activeRecord.ke_node_type._value:""}},t))})),r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ne.a,{color:"secondary",isOpen:null!=e.state.selectedDisposalReason},r.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),"reestr_key_elements"==e.props.tableName&&r.a.createElement(r.a.Fragment,null,"\u0412\u044b \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442\u0435 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u0434\u043b\u044f \u0421\u0427 ",null!=e.props.activeRecord&&null!=e.props.activeRecord?void 0==e.props.activeRecord.key_element_codeitem?e.props.activeRecord.key_element_code_calculated:e.props.activeRecord.key_element_codeitem.recname:""," \u0441 \u0423\u0418\u041d ",null!=e.props.activeRecord&&null!=e.props.activeRecord&&void 0==e.props.activeRecord.numberke._value?e.props.activeRecord.numberke:""," \u043f\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0435 ",null!=e.state.selectedDisposalReason?e.state.selectedDisposalReason.recname:"",". \u0414\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0441 \u0434\u0435\u0442\u0430\u043b\u044c\u044e \u0431\u0443\u0434\u0443\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b. \u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"),"reestr_ke_nodes"==e.props.tableName&&r.a.createElement(r.a.Fragment,null,"\u0412\u044b \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442\u0435 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u0434\u043b\u044f \u0421\u0415 ",null!=e.props.activeRecord&&null!=e.props.activeRecord?void 0==e.props.activeRecord.ke_assembly_unit_typeitem?e.props.activeRecord.ke_assembly_unit_type_calculated:e.props.activeRecord.ke_assembly_unit_typeitem.recname:""," \u0441 \u0423\u0418\u041d ",null!=e.props.activeRecord&&null!=e.props.activeRecord&&void 0==e.props.activeRecord.unique_number._value?e.props.activeRecord.unique_number:""," \u043f\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0435 ",null!=e.state.selectedDisposalReason?e.state.selectedDisposalReason.recname:"",". \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0432\u0441\u0435 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u044d\u0442\u043e\u0439 \u0421\u0415 \u0434\u0435\u0442\u0430\u043b\u0438, \u0431\u0443\u0434\u0443\u0442 \u0442\u0430\u043a\u0436\u0435 \u0443\u0442\u0438\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u044b. \u0414\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441 \u043d\u0438\u043c\u0438 \u0431\u0443\u0434\u0443\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b. \u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"))),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0"))}}),r.a.createElement(Je,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}))}},{key:"isEmptyString",value:function(e){return null==e||"undefined"===e||""===e||0===e.length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotNullObject",value:function(e){return null!=e&&"undefined"!==e&&e&&0!==Object.keys(e).length}},{key:"isEmptyOrNullArray",value:function(e){return!e||null==e||"undefined"===e||e.length<=0}},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}}]),n}(r.a.Component),Xe=(n(1141),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),a.setState({selectedValue:e}),a.props.setFieldValue(a.props.field.name,e),console.log(a.state.selectedValue),console.log(a.props)},a.state={modalItems:[],selectedValue:""},a.getData=a.getData.bind(Object(h.a)(a)),a.handleChange=a.handleChange.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount"),e.next=3,this.getData();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getData",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="","reestr_key_elements"==this.props.tableName?t=this.props.activeRecord.length>0?this.props.activeRecord[0].key_element_code._value:this.props.activeRecord.key_element_code:"reestr_ke_nodes"==this.props.tableName&&(t=this.props.activeRecord.length>0?this.props.activeRecord[0].ke_node_type._value:this.props.activeRecord.ke_node_type),"batch_field"!=this.props.field.name){e.next=5;break}return e.next=5,fetch("/odata/reestr_batch?$select=batch_number,recipient_calculated,product_name_calculated,recid&$orderBy=batch_number desc&$filter=((recstate eq 1) and (batch_status eq 255abbd7-fa7c-40d4-a270-5169a84fa05e) and ((count_passport eq 0) or (product_name eq ".concat(t,")))"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(n.isNullOrEmptyResponse(e))return console.log("\u041f\u0430\u0440\u0442\u0438\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b");n.setState({modalItems:e.value})})).then((function(){return fetch("/odata/reestr_batch?$top=10&$select=batch_number,recipient_calculated,product_name_text,recid&$filter=((recstate eq 1) and (batch_status eq 255abbd7-fa7c-40d4-a270-5169a84fa05e) and (count_passport eq 0))&$orderBy=reccreated desc",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}})})).then((function(e){return e.json()})).then((function(e){if(n.isNotEmptyOrNullArray(e.value)){var t=e.value[0];n.handleChange(t)}})).catch((function(e){return console.log("Request failed: ",e)}));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){return r.a.createElement(k.a,{row:!0},r.a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(j.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(e){var t=e.batch_number;return e.recipient_calculated&&e.recipient_calculated.length>0&&(t=t+", "+e.recipient_calculated),e.product_name_calculated&&e.product_name_calculated.length>0&&(t=t+", "+e.product_name_calculated),t},getOptionValue:function(e){return e.recid},options:this.state.modalItems,onChange:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,isDisabled:this.props.field.isUinField||this.props.field.isDisabled,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}})))}}]),n}(a.Component)),Qe=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),et=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,tableName:"",place:""},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){("edit"==window.rdev_modalDataPack.place||window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent)&&this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords}),this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place})}},{key:"render",value:function(){return r.a.createElement(tt,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord,tableName:this.state.tableName})}}]),n}(a.Component),tt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={processingAction:!1},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),t=this.refs.formik.state.values,console.log("this",this),console.log("vals",this.refs.formik.state.values),console.log("records",this.props.activeRecord),n="",this.isNullObject(t.batch_field)&&(n=String().concat(n,"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u043f\u0430\u0440\u0442\u0438\u044f.")),this.isNullObject(this.props.activeRecord)&&(n=String().concat(n,"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0432 \u043f\u0430\u0440\u0442\u0438\u044e.")),!this.isNotEmptyString(n)){e.next=13;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,n));case 13:if("reestr_key_elements"!=this.props.tableName){e.next=32;break}return a=[],this.props.activeRecord.length>0?a=this.props.activeRecord:(r={recid:this.props.activeRecord.recid},a.push(r)),s={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({selected_records:a,batch_recid:t.batch_field.recid})},console.log("requestBody",s),e.next=20,D("/plugins/nbdlogicplugin/addkeyelementstobatch",s.body);case 20:if(l=e.sent,console.log("result_addtobatch_resp",l),!l.success){e.next=28;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(l.message)));case 28:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(l.message)));case 30:e.next=49;break;case 32:return o={},i="",this.props.activeRecord.length>0?(i="/plugins/nbdlogicplugin/addassemblyunitstobatch",o={selected_records:this.props.activeRecord,batch_recid:t.batch_field.recid}):(i="/plugins/nbdlogicplugin/addassemblyunittobatch",o={batch_recid:t.batch_field.recid,assembly_unit_recid:this.props.activeRecord.recid}),s={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify(o)},console.log("requestBody",s),e.next=39,D(i,s.body);case 39:if(l=e.sent,console.log("result_addtobatch_resp",l),!l.success){e.next=47;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(l.message)));case 47:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(l.message)));case 49:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e"),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"batch_field",name:"batch_field"},(function(){return r.a.createElement(Xe,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,activeRecord:e.props.activeRecord,tableName:e.props.tableName,field:{name:"batch_field",displayName:"\u041f\u0430\u0440\u0442\u0438\u044f"}},t))})),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0"))}}),r.a.createElement(Qe,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}}]),n}(r.a.Component),nt=(n(1142),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChangeTemplate=function(e){console.log("handleChangeTemplate",e),a.setState({selectedValue:e}),a.props.setFieldValue(a.props.field,a.state.selectedValue),a.setState({option:e}),a.props.updateData(e,a.props.field.name)},a.handleChange=function(e){console.log("handleChange",e),a.setState({selectedValue:e}),a.props.setFieldValue(a.props.field,a.state.selectedValue),a.props.updateData(e,a.props.field.name)},a.state={options:[],currentElement:{},currentElementType:"",text_select:"",selectedValue:null,fieldForShow:"recname"},a.getTemplates=a.getTemplates.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("state=",this.state),console.log("props=",this.props),console.log("componentDidMount"),e.next=5,this.getTemplates();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDictionaries",value:function(){var e=this,t="",n="",a="",r="";switch(this.props.field.name){case"disposal_reason_field":if(t="dictionary_disposal_reasons",this.setState({fieldForShow:"recname"}),n="recname,name_key_element,name_ke_node",console.log("this.props.field.filter",this.props.field.filter),console.log("this.props.tableName",this.props.tableName),""==(a=null!=this.props.field.filter&&""!=this.props.field.filter?"reestr_key_elements"==this.props.tableName?"name_key_element eq ".concat(this.props.field.filter," and "):"name_ke_node eq ".concat(this.props.field.filter," and "):""))return this.setState({options:null}),void this.setState({selectedValue:null});break;case"uin_relation_field":n="reestr_key_elements"==(t=this.props.tableName)?"key_element_code,numberke":"unique_number,ke_node_type",a="recid eq ".concat(this.props.activeRecord.recid," and "),r="reestr_key_elements"==t?"key_element_codeitem($select=recname)":"ke_node_typeitem($select=recname)"}console.log("/odata/".concat(t,"?$select=").concat(n,",recid&$orderBy=").concat(n,"&$filter=").concat(a,"recstate eq 1&$expand=").concat(r)),fetch("/odata/".concat(t,"?$select=").concat(n,",recid&$orderBy=").concat(n,"&$filter=").concat(a,"recstate eq 1&$expand=").concat(r),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(n){if(e.isNullOrEmptyResponse(n))return console.log("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 ".concat(t," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));if("repair_operation_field"==e.props.field.name&&n.value.forEach((function(e){return e.recname=e.work_performed_type_operationitem.repair_operation})),"uin_relation_field"==e.props.field.name){console.log("uin response",n.value);var a={recid:n.value[0],recname:"reestr_key_elements"==t?"".concat(n.value[0].numberke,", ").concat(n.value[0].key_element_codeitem.recname):"".concat(n.value[0].unique_number,", ").concat(n.value[0].ke_node_typeitem.recname)};e.setState({selectedValue:a}),e.props.updateData(n.value[0],e.props.field.name)}else e.setState({options:n.value}),console.log("loadRepairTypes data.value ",n.value)})).catch((function(e){console.log("Request failed: ",e)}))}},{key:"getTemplates",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],"model_vagon_field"!=this.props.field.name){e.next=6;break}return e.next=4,fetch("/odata/dictionary_models?$select=code,cipher,recid&$orderBy=code&$filter=recstate eq 1",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(r.isNullOrEmptyResponse(e))return console.log("\u041c\u043e\u0434\u0435\u043b\u0438 \u0432\u0430\u0433\u043e\u043d\u043e\u0432 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b");console.log("\u041c\u043e\u0434\u0435\u043b\u0438 \u0432\u0430\u0433\u043e\u043d\u043e\u0432",e.value),r.setState({options:e.value})})).then((function(){return fetch("/odata/reestr_vehicles?$top=10&$select=dictionary_models,recid&$filter=(recstate eq 1) and (dictionary_models ne null)&$orderBy=reccreated desc",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}})})).then((function(e){return e.json()})).then((function(e){if(r.isNotEmptyOrNullArray(e.value))for(var t=0;t<e.value.length;t++)if(null!=e.value[t].dictionary_models){var n=r.state.options.find((function(n){return n.recid==e.value[t].dictionary_models.toString()}));r.handleChangeTemplate(n);break}})).catch((function(e){return console.log("Request failed: ",e)}));case 4:e.next=15;break;case 6:if("manufacturer_vehicle_field"!=this.props.field.name){e.next=15;break}return e.next=9,this.sendRequestAsync("/odata/dictionary_branding_codes?$select=code,recname,recid&$orderBy=recname&$filter=(recstate eq 1)");case 9:if(n=e.sent,!this.isNullOrEmptyResponse(n)){e.next=12;break}return e.abrupt("return",console.log("\u041a\u043e\u0434\u044b \u043a\u043b\u0435\u0439\u043c\u0435\u043d\u0438\u044f \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 12:a=n.value,t=a,this.setState({options:t});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"sendRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});case 2:return n=e.sent,console.log(n),e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,{row:!0},r.a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(j.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(t){return"model_vagon_field"==e.props.field.name?t.code+", "+t.cipher:"manufacturer_vehicle_field"==e.props.field.name?t.code+", "+t.recname:""},getOptionValue:function(e){return e.recid},options:this.state.options,onChange:this.handleChangeTemplate,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}})))}}]),n}(a.Component)),at=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),rt=(n(1143),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){if(console.log("date change"),console.log("handleChange_input",e),null!=e.value){ve()().utcOffset();var t=ve()(e.value),n=new Date(Date.UTC(t.year(),t.month(),t.date()));console.log("handleChange_otput",n),a.setState({selectedValue:n}),a.props.setFieldValue(a.props.field.name,n)}else a.setState({selectedValue:null}),a.props.setFieldValue(a.props.field.name,e.value);a.props.setFieldTouched(a.props.field.name,!0),a.props.updateData(e.value,a.props.field.name)},a.getType=function(){return"SysTimeDate"===a.props.field.type?"datetime":"SysDate"===a.props.field.type?"date":"datetime"},a.state={selectedValue:new Date},a.handleChange=a.handleChange.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",elementAttr:{class:"rdev-read-only-control"}},r.a.createElement(k.a,{key:"input_".concat(this.props.field.name),row:!0},r.a.createElement(v.a,{sm:4,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:8,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(ge.DateBox,{className:"repairFormDateBox",width:"100%",type:"date",id:this.props.field,name:this.props.field.name,defaultValue:new Date,showClearButton:!0,useMaskBehavior:!0,displayFormat:"dd.MM.yyyy",onValueChanged:this.handleChange,value:this.state.selectedValue})))}}]),n}(a.Component)),st=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){console.log(t.target.value),e.props.updateData(t.target.value),e.props.setFieldValue(e.props.field.name,t.target.value)},e}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(k.a,{row:!0},r.a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(E.a,{onChange:this.handleChange,name:this.props.field.name,onBlur:this.props.onBlur,disabled:this.props.field.isDisabled})))}}]),n}(a.Component),lt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t=""===e.target.value?null:e.target.value;console.log("handleChange_plugin_number",e.target.value),console.log("handleChange_plugin_number",e.target.value.length),(""===e.target.value||/^-?[0-9\b]*$/.test(e.target.value))&&(a.props.setFieldValue(a.props.field.name,t),a.props.updateData(t),a.setState({isValid:t.length>=8&&t.length<=8}))},a.state={isValid:!0},a}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(k.a,{row:!0,key:"input_".concat(this.props.field.name)},r.a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(E.a,{type:"number",name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,disabled:this.props.field.isDisabled,invalid:!this.state.isValid}),!this.state.isValid&&r.a.createElement(G.a,null,"\u0421\u0435\u0442\u0435\u0432\u043e\u0439 \u043d\u043e\u043c\u0435\u0440 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0438\u0437 8 \u0446\u0438\u0444\u0440")))}}]),n}(a.Component),ot=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,tableName:"",place:"",isNeedDataGrid:!1},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){console.log("rdev_modalDataPack",window.rdev_modalDataPack),this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place})}},{key:"render",value:function(){return r.a.createElement(it,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},place:this.state.place,tableName:this.state.tableName,initialValues:{},activeRecord:this.state.activeRecord})}}]),n}(a.Component),it=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateSelectedValues=function(t,n){switch(console.log("updateSelectedValuesnewValue",t),console.log("updateSelectedValuesfieldName",n),n){case"manufacturer_vehicle_field":e.setState({manufacturerVehicle:t});break;case"model_vagon_field":e.setState({modelVagon:t})}},e.updateManufacturerNumberField=function(t){console.log("updateManufacturerNumberField",t),e.setState({manufacturerNumber:t})},e.updateVehicleNumberField=function(t){e.setState({vehicleNumber:t})},e.updateSelectedDate=function(t){console.log("updateSelectedDate",t),e.setState({dateManufacture:t})},e.state={modelVagon:null,selectedFaultType:null,selectedRepairOperation:null,dateManufacture:new Date,selectedRecord:null,selectedRow:null,selectedTable:"",selectedElementType:"",isVisibleDataGrid:!1,inputRecord:null,processingAction:!1,manufacturerNumber:"",vehicleNumber:"",manufacturerVehicle:null},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.dataGrid={},e.updateSelectedValues=e.updateSelectedValues.bind(Object(h.a)(e)),e.updateSelectedDate=e.updateSelectedDate.bind(Object(h.a)(e)),e.ekshandleclick=e.ekshandleclick.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("state_test",this.state),t="","undefined"!==this.state.manufacturerNumber&&null!=this.state.manufacturerNumber&&""!=this.state.manufacturerNumber||(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0417\u0430\u0432\u043e\u0434\u0441\u043a\u043e\u0439 \u043d\u043e\u043c\u0435\u0440". ')),"undefined"!==this.state.dateManufacture&&null!=this.state.dateManufacture||(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0414\u0430\u0442\u0430 \u0438\u0437\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u0438\u044f". ')),this.isNullObject(this.state.modelVagon)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u041c\u043e\u0434\u0435\u043b\u044c \u0432\u0430\u0433\u043e\u043d\u0430". ')),n=new Date(this.state.dateManufacture).toLocaleDateString(),console.log("this.state.dateManufacture",n),!this.isNotEmptyString(t)){e.next=13;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,t));case 13:return a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({manufacturer_number:this.state.manufacturerNumber,date_manufacturer:n,model_vagon:this.state.modelVagon.recid})},console.log("requestBody",a),e.next=17,D("/plugins/nbdlogicplugin/addvehicle",a.body);case 17:if(!(r=e.sent).success){e.next=25;break}return window.closePluginModal(),null!=r.data&&window.open("/tables/reestr_vehicles/".concat(r.data.recid),"_self"),this.setState({processingAction:!1}),e.abrupt("return",T(!0,"".concat(r.message)));case 25:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(r.message)));case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ekshandleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("state_test",this.state),t="","undefined"!==this.state.vehicleNumber&&null!=this.state.vehicleNumber&&""!=this.state.vehicleNumber||(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0421\u0435\u0442\u0435\u0432\u043e\u0439 \u043d\u043e\u043c\u0435\u0440". ')),this.isNullObject(this.state.manufacturerVehicle)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u041f\u0440\u0435\u0434\u043f\u0440\u0438\u044f\u0442\u0438\u0435 \u0438\u0437\u0433\u043e\u0442\u043e\u0432\u0438\u0442\u0435\u043b\u044c". ')),!this.isNotEmptyString(t)){e.next=10;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,t));case 10:return n={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({vehicle_number:this.state.vehicleNumber,manufacturer_vehicle:this.state.manufacturerVehicle.recid})},console.log("requestBody",n),e.next=14,D("/plugins/nbdlogicplugin/eksaddvehicle",n.body);case 14:if(!(a=e.sent).success){e.next=22;break}return window.closePluginModal(),null!=a.data&&window.open("/tables/reestr_vehicles/".concat(a.data.recid),"_self"),this.setState({processingAction:!1}),e.abrupt("return",T(!0,"".concat(a.message)));case 22:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(a.message)));case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,"tscontroller"==window.activeUser.username.toLowerCase()&&r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c \u043e \u0432\u0430\u0433\u043e\u043d\u0435"),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"vehicle_manufacturer_number_field",name:"vehicle_manufacturer_number_field"},(function(){return r.a.createElement(st,{setFieldValue:t.setFieldValue,updateData:e.updateManufacturerNumberField,field:{name:"vehicle_manufacturer_number_field",displayName:"\u0417\u0430\u0432\u043e\u0434\u0441\u043a\u043e\u0439 \u043d\u043e\u043c\u0435\u0440",isDisabled:!1},activeRecord:e.props.activeRecord,tableName:e.props.tableName})})),r.a.createElement(g.a,{key:"date_manufacture_field",name:"date_manufacture_field"},(function(){return r.a.createElement(rt,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedDate,field:{name:"date_manufacture_field",displayName:"\u0414\u0430\u0442\u0430 \u0438\u0437\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u0438\u044f"}},t))})),r.a.createElement(g.a,{key:"model_vagon_field",name:"model_vagon_field"},(function(){return r.a.createElement(nt,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,tableName:e.props.tableName,field:{name:"model_vagon_field",displayName:"\u041c\u043e\u0434\u0435\u043b\u044c \u0432\u0430\u0433\u043e\u043d\u0430",filter:""}},t))})),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0"))}}),"ekspluatant"==window.activeUser.username.toLowerCase()&&r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u041f\u043e\u0438\u0441\u043a \u0437\u0430\u043f\u0438\u0441\u0438 \u043e \u0432\u0430\u0433\u043e\u043d\u0435"),r.a.createElement("hr",null),console.log("test_plugin_number",e.props),r.a.createElement(g.a,{key:"vehicle_number_field",name:"vehicle_number_field"},(function(){return r.a.createElement(lt,{setFieldValue:t.setFieldValue,updateData:e.updateVehicleNumberField,field:{name:"vehicle_number_field",displayName:"\u0421\u0435\u0442\u0435\u0432\u043e\u0439 \u043d\u043e\u043c\u0435\u0440",isDisabled:!1},activeRecord:e.props.activeRecord,tableName:e.props.tableName})})),r.a.createElement(g.a,{key:"manufacturer_vehicle_field",name:"manufacturer_vehicle_field"},(function(){return r.a.createElement(nt,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,tableName:e.props.tableName,field:{name:"manufacturer_vehicle_field",displayName:"\u041f\u0440\u0435\u0434\u043f\u0440\u0438\u044f\u0442\u0438\u0435 \u0438\u0437\u0433\u043e\u0442\u043e\u0432\u0438\u0442\u0435\u043b\u044c",filter:""}},t))})),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.ekshandleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0"))}}),r.a.createElement(at,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}))}},{key:"isEmptyString",value:function(e){return null==e||"undefined"===e||""===e||0===e.length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotNullObject",value:function(e){return null!=e&&"undefined"!==e&&e&&0!==Object.keys(e).length}},{key:"isEmptyOrNullArray",value:function(e){return!e||null==e||"undefined"===e||e.length<=0}},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}}]),n}(r.a.Component),ct=(n(1144),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){console.log(t.target.value),e.props.updateData(t.target.value),e.props.setFieldValue(e.props.field.name,t.target.value)},e}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(k.a,{row:!0},r.a.createElement(v.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(y.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},r.a.createElement(E.a,{onChange:this.handleChange,name:this.props.field.name,onBlur:this.props.onBlur,disabled:this.props.field.isDisabled,autoFocus:this.props.field.autoFocus||!1})))}}]),n}(a.Component)),ut=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),dt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,uin:""},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){if("edit"==window.rdev_modalDataPack.place)this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords});else if(window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent){var e={recid:window.rdev_modalDataPack.selectedRecords[0].recid._value};this.setState({activeRecord:e})}this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place})}},{key:"render",value:function(){return r.a.createElement(pt,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord,tableName:this.state.tableName})}}]),n}(a.Component),pt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateUinField=function(t){console.log("updateUinField",t),e.setState({uin:t})},e.state={processingAction:!1},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),this.refs.formik.state.values,console.log("this",this),console.log("vals",this.refs.formik.state.values),console.log("records",this.props.activeRecord),t="",this.isNullObject(this.state.uin)?t=String().concat(t,'\u041f\u043e\u043b\u0435 "\u0423\u0418\u041d" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e.'):12!=this.state.uin.length&&(t=String().concat(t,'\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0423\u0418\u041d" \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0438\u0437 12 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432.')),!this.isNotEmptyString(t)){e.next=12;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,t));case 12:return n={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({recid:this.props.activeRecord.recid,add_uin:this.state.uin})},console.log("requestBody",n),e.next=16,D("/plugins/nbdlogicplugin/adduinkeyelement",n.body);case 16:if(a=e.sent,console.log("result_addtobatch_resp",a),!a.success){e.next=24;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(a.message)));case 24:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(a.message)));case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0423\u0418\u041d"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"uin",name:"uin"},(function(){return r.a.createElement(ct,{setFieldValue:t.setFieldValue,updateData:e.updateUinField,field:{name:"uin",displayName:"\u0423\u0418\u041d",isDisabled:!1,autoFocus:!0},activeRecord:e.props.activeRecord,tableName:e.props.tableName})})))}}),r.a.createElement(ut,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}}]),n}(r.a.Component),mt=(n(1145),[{title:"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445 \u0443\u0437\u043b\u043e\u0432",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u041f\u043e\u0434\u0448\u0438\u043f\u043d\u0438\u043a \u0431\u0443\u043a\u0441\u043e\u0432\u043e\u0433\u043e \u0443\u0437\u043b\u0430",current_quantity:0,necessary_quantity:2,available_positions:[1,2]},{title:"\u0417\u0430\u043c\u043e\u043a",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u0412\u0430\u043b\u0438\u043a \u043f\u043e\u0434\u044a\u0435\u043c\u043d\u0438\u043a\u0430",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u041a\u043e\u0440\u043f\u0443\u0441 \u0430\u0432\u0442\u043e\u0441\u0446\u0435\u043f\u043a\u0438",current_quantity:0,necessary_quantity:1,available_positions:null}]),ht=(a.Component,function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){console.log(t.target.value),e.props.updateUinFieldValue(t.target.value),e.props.setFieldValue(e.props.field.name,t.target.value)},e}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(k.a,null,r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(E.a,{name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,value:this.props.field.value,defaultValue:"",disabled:this.props.field.isDisabled,autoFocus:this.props.field.autoFocus||!1}))}}]),n}(a.Component)),ft=(n(1146),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),null!=e&&e.length>a.state.options.length&&a.handleNewOptionClick(e[e.length-1]);var t=e.map((function(e){return{number:e.number,position:e.position}}));a.props.setFieldValue(a.props.field.name,JSON.stringify(t))},a.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),n=X(t.value),a.setState({isLoadingDetail:!0}),e.next=5,a.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(n,"')"));case 5:if(r=e.sent,!a.isNullOrEmptyResponse(r)){e.next=8;break}return e.abrupt("return",a.modalError("\u0423\u0418\u041d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435"));case 8:return s=r.value[0],e.next=11,a.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(s.recid,")"));case 11:return l=e.sent,e.next=14,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(s.recid,")"));case 14:if(o=e.sent,!a.isNullOrEmptyResponse(o)||!a.isNullOrEmptyResponse(l)){e.next=17;break}return e.abrupt("return",a.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 17:if((i=a.state.addedItems).push(n),!(null!=a.state.options&&a.state.options.length>0)){e.next=24;break}if(c=Object(C.a)(a.state.options),null==c.find((function(e){return e.numberValue==n}))){e.next=24;break}return e.abrupt("return",a.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 24:if(a.isNullOrEmptyResponse(l)||!a.isNullOrEmptyResponse(o)){e.next=31;break}return u=l.value[0],e.next=28,a.defineKeyElementPositions(u);case 28:a.setState({addedItems:i}),e.next=36;break;case 31:if(a.isNullOrEmptyResponse(o)){e.next=36;break}return d=o.value[0],e.next=35,a.defineAssemblyElementPositions(d);case 35:a.setState({addedItems:i});case 36:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.prepareValue=function(){return a.props.value instanceof Array?a.props.value[0]:a.props.value},a.state={options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null},a.handleNewOptionClick=a.handleNewOptionClick.bind(Object(h.a)(a)),a.getOptions=a.getOptions.bind(Object(h.a)(a)),a.handleModalChange=a.handleModalChange.bind(Object(h.a)(a)),a.renderDeleteConfirm=a.renderDeleteConfirm.bind(Object(h.a)(a)),a.handleOkModal=a.handleOkModal.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"focus",value:function(){this.refInput.focus()}},{key:"assemblyElementAlreadyExist",value:function(e,t){return 0==e.length||null==e.find((function(e){return null!=e.node&&null!=t&&e.node==t}))}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&T(!1,e)}},{key:"defineKeyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v,E,O,x,S,w,C,j,A,N,R,D=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,a=null,r=null,s=null,null==t.ke_node||""==t.ke_node){e.next=18;break}return e.next=7,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.ke_node,")"));case 7:if(l=e.sent,!this.isNullOrEmptyResponse(l)){e.next=10;break}return e.abrupt("return");case 10:if(n=l.value[0],a=n.recid,r=n.ke_node_type,s=t.position_on_node,!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,a)){e.next=16;break}return e.abrupt("return",this.modalError("\u0423\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0444\u043e\u0440\u043c\u0443."));case 16:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o||null==s){e.next=18;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 18:return o=t.key_element_code,t.documentation_number_calculated,this.setState({currentElement:t,currentElementType:"keyElement"}),e.next=23,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(this.props.activeRecord.reestr_ke_node_type.toString(),")"));case 23:if(i=e.sent,!this.isNullOrEmptyResponse(i)){e.next=26;break}return e.abrupt("return");case 26:return c=i.value[0],u=c.ke_node_type,e.next=30,this.checkAssemblyElementCompositionAsync(t,n,u);case 30:if((d=e.sent).success){e.next=33;break}return e.abrupt("return",this.modalError(d.message));case 33:if(null!=a&&""!=a){e.next=99;break}return m=null!=u&&""!=u?" and (node_type eq ".concat(u,")"):"",e.next=37,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(o,")").concat(m));case 37:if(h=e.sent,f=h.value,b=[],_=[],"477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"34c12f72-eb33-4ab1-ba3e-a80166258e5d"!=o&&"ff1d8011-75dc-4d30-832f-f47c3d5ac430"!=o&&"4aed23f8-9710-4904-a2f5-b89d9bc7c75c"!=o&&"975cd310-7675-4436-899f-4c6b84555f6a"!=o&&"38dd229a-915f-49ef-bba8-a28f055c9962"!=o||0!=f.length){e.next=45;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 45:if("e4ef0365-0365-40df-ab4e-a77104c352df"!=o){e.next=87;break}if(t.has_rough_axis_number){e.next=50;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 50:return e.next=52,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(ke_node_type eq ".concat(u,") and (scheme eq ").concat(c.documentation,")"));case 52:if(y=e.sent,!this.isNullOrEmptyResponse(y)){e.next=55;break}return e.abrupt("return",this.modalError('\u0414\u043b\u044f \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0443\u0437\u043b\u0430/\u0421\u0415 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0441\u043f\u0440\u0430\u0432\u043e\u043d\u0438\u043a\u0435 "\u041a\u043e\u043b-\u0432\u043e \u0421\u0427/\u0421\u0415 \u0432 \u0421\u0415/\u0443\u0437\u043b\u0435".'));case 55:if(null!=(g=y.value[0]).rough_axis_count&&0!=g.rough_axis_count){e.next=60;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 60:if(k=null,!t.has_rough_axis_number){e.next=69;break}if(null!=t.rough_axis&&""!=t.rough_axis){e.next=64;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u041e\u0441\u0438 \u0447\u0438\u0441\u0442\u043e\u0432\u043e\u0439 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0443\u044e."));case 64:return e.next=66,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(t.rough_axis,")"));case 66:if(null!=(k=e.sent)){e.next=69;break}return e.abrupt("return",this.modalError("\u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0430\u044f \u0432 \u043e\u0441\u0438 \u0447\u0438\u0441\u0442\u043e\u0432\u043e\u0439, \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 69:if(null==t.blockchainhash||""==t.blockchainhash||null!=k.blockchainhash&&""!=k.blockchainhash){e.next=71;break}return e.abrupt("return",this.modalError("\u041d\u0435\u043b\u044c\u0437\u044f \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u041e\u0441\u044c \u0447\u0438\u0441\u0442\u043e\u0432\u0443\u044e \u0441 \u0423\u0418\u041d ".concat(t.numberke,", \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u0430\u044f \u0441 \u043d\u0435\u0439 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f \u0441 \u0423\u0418\u041d ").concat(k.numberke," \u043d\u0435 \u0432\u044b\u043f\u0443\u0449\u0435\u043d\u0430 \u0432 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435.")));case 71:if(null!=t.blockchainhash&&""!=t.blockchainhash){e.next=75;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return",T(!0,"\u0421\u0427 \u041e\u0441\u044c \u0447\u0438\u0441\u0442\u043e\u0432\u0430\u044f \u0441 \u0423\u0418\u041d ".concat(t.numberke," \u043d\u0435 \u0432\u044b\u043f\u0443\u0449\u0435\u043d \u0432 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0439 \u0441 \u043d\u0438\u043c \u0421\u0427 \u041e\u0441\u044c \u0427\u0435\u0440\u043d\u043e\u0432\u0430\u044f c \u0423\u0418\u041d ").concat(k.numberke," \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d.")));case 75:if(null==t.blockchainhash||""==t.blockchainhash||null==k.blockchainhash||""==k.blockchainhash){e.next=84;break}if(v=this.props.refComponentDataGrid.getStateTableData(),null!=v.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=82;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 82:return e.next=84,this.updateStateTable("add",{value:k.recid,number:k.recid,numberValue:k.numberke,node:null,nodeObj:k,isKeyElement:!0});case 84:return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 87:if("a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o){e.next=89;break}return e.abrupt("return",this.modalError("\u041d\u0435\u043b\u044c\u0437\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0421\u0427 \u0442\u0438\u043f\u0430 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f."));case 89:if(this.state.options.length>0)for(E=0;E<this.state.options.length;E++)_.push(this.state.options[E].position);if((b=_.length>0?f.filter((function(e){return null==_.find((function(t){return t==e.recid}))})):f).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),1!=b.length){e.next=96;break}return this.setState({modalItems:b,modalValue:b[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 96:this.setState({modalItems:b,modalValue:""}),e.next=148;break;case 99:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o){e.next=101;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 101:if(m=null!=r&&""!=r?" and (parent_node_type eq ".concat(u,")"):"",O="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=u){e.next=109;break}return e.next=106,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(c.documentation,") and\n\t\t\t\t\t\t(ke_node_type eq ").concat(u,")"));case 106:x=e.sent,S=x.value[0],O=S.slider_body_count>2&&S.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 109:return e.next=111,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=(key_element_code eq ".concat(o,") and (child_node_type eq ").concat(r,")").concat(m).concat(O));case 111:if(w=e.sent,C=w.value,j=[],j=C.filter((function(e){return e.position_on_node==s})),A=j.map((function(e){return e.alternative_position})),[],C.filter((function(e){return null!=A.find((function(t){return t==e.recname}))})).map((function(e){null==j.find((function(t){return t.recid==e.recid}))&&j.push(e)})),_=[],b=[],!(this.state.options.length>0)){e.next=136;break}E=0;case 123:if(!(E<this.state.options.length)){e.next=136;break}if(this.state.options[E].isKeyElement){e.next=132;break}return e.next=127,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t\t\t\t\t\t(child_node_type eq ".concat(this.state.options[E].nodeObj.ke_node_type,") \n\t\t\t\t\t\t\t\tand (node_position eq ").concat(this.state.options[E].position,")").concat(O));case 127:w=e.sent,(N=w.value).length>0&&N.forEach((function(e){_.push(e.recid)})),e.next=133;break;case 132:_.push(this.state.options[E].position);case 133:E++,e.next=123;break;case 136:if(b=_.length>0?j.filter((function(e){return null==_.find((function(t){return t==e.recid}))})):j,R=[],this.state.options.length>0)for(E=0;E<this.state.options.length;E++)null!=this.state.options[E].node&&this.state.options[E].node!=a&&null!=this.state.options[E].positionObj&&null!=this.state.options[E].positionObj.child_node_type&&null!=(R=b.filter((function(e){return e.parent_node_type==u&&e.node_position==D.state.options[E].positionObj.node_position&&e.child_node_type==D.state.options[E].positionObj.child_node_type})))&&R.length>0&&(b=b.filter((function(e){return null==R.find((function(t){return t.recid==e.recid}))})));if(b.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),!(b.length<=1)){e.next=146;break}return this.setState({modalItems:b,modalValue:b[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 146:this.setState({modalItems:b,modalValue:""});case 147:this.setState({modalItems:b,modalValue:""});case 148:this.setState({showModal:!0});case 149:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"defineAssemblyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({currentElement:t,currentElementType:"assemblyElement"}),!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,t.recid)){e.next=3;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t.unique_number," \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0432 \u0444\u043e\u0440\u043c\u0443.")));case 3:return e.next=5,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types(".concat(t.ke_node_type,")"));case 5:if(n=e.sent,console.log("ddd",n),!n.is_variable){e.next=9;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0421\u0427."));case 9:return console.log("assemblyUnit",t),e.next=12,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(this.props.activeRecord.reestr_ke_node_type.toString(),")"));case 12:if(a=e.sent,!this.isNullOrEmptyResponse(a)){e.next=15;break}return e.abrupt("return");case 15:if(r=a.value[0],s=r.ke_node_type,l="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=s){e.next=24;break}return e.next=21,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(r.documentation,") and\n\t\t\t\t(ke_node_type eq ").concat(s,")"));case 21:o=e.sent,i=o.value[0],l=i.slider_body_count>2&&i.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 24:return e.next=26,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n.recid,") and \n\t\t\t(parent_node_type eq ").concat(s,") ").concat(l));case 26:return c=e.sent,u=c.value,console.log("aaaa",u),e.next=31,this.checkAssemblyElementCompositionAsync(null,t,s);case 31:if((d=e.sent).success){e.next=34;break}return e.abrupt("return",this.modalError(d.message));case 34:m=[],h=[],f=[],b=Object(K.a)(u),e.prev=38,b.s();case 40:if((_=b.n()).done){e.next=49;break}if(null==(y=_.value).node_position||null!=m.find((function(e){return e.recid==y.node_position}))){e.next=47;break}return e.next=45,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recid eq ".concat(y.node_position,")"));case 45:g=e.sent,this.isNullOrEmptyResponse(g)||m.push(g.value[0]);case 47:e.next=40;break;case 49:e.next=54;break;case 51:e.prev=51,e.t0=e.catch(38),b.e(e.t0);case 54:return e.prev=54,b.f(),e.finish(54);case 57:if(this.state.options.length>0)for(k=0;k<this.state.options.length;k++)(v=this.state.options[k]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n.recid&&h.push(v.positionObj.node_position):null!=v.position&&n.recid==v.nodeObj.ke_node_type&&h.push(v.positionObj.recid);if(!(h.length>0)){e.next=64;break}if(0!=(f=m.filter((function(e){return null==h.find((function(t){return t==e.recid}))}))).length){e.next=62;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415."));case 62:e.next=65;break;case 64:f=m;case 65:if(0!=f.length){e.next=69;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 69:if(f.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),!(f.length<=1)){e.next=76;break}return this.setState({modalItems:f,modalValue:f[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 76:this.setState({modalItems:f,modalValue:""});case 77:this.setState({modalItems:f,modalValue:""}),this.setState({showModal:!0});case 79:case"end":return e.stop()}}),e,this,[[38,51,54,57]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOkModal",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleOkModal_",this),console.log("handleOkModal__",this.state),t=this.state.options,console.log("handleOkModal",t),c=!1,"keyElement"==this.state.currentElementType?(null==this.state.modalValue||""==this.state.modalValue?n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated):(n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),a=this.state.modalValue.recid,r=this.state.modalValue),s=null!=this.state.currentElement.ke_node&&""!=this.state.currentElement.ke_node?this.state.currentElement.ke_node:null,u=this.state.currentElement.numberke,l=this.state.currentElement.recid,o=null!=s?"#4bf1547d":"#ebf5ff",i=null!=s?"#027707":"#007eff",c=!0):"numberkeConfirm"==this.state.currentElementType?(console.log(this.state),null!=this.state.modalValue&&""!=this.state.modalValue||(n="".concat(this.state.currentElement)),u=this.state.currentElement,c=!0):(null==this.state.modalValue||""==this.state.modalValue?n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated):(n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),a=this.state.modalValue.recid,r=this.state.modalValue),u=this.state.currentElement.unique_number,s=this.state.currentElement.recid,l=this.state.currentElement.recid,o="#4bf1547d",i="#027707"),console.log("handleOkModal2",t),t.push({value:"".concat(this.state.currentElement.recid),label:n,position:a,positionObj:r,number:l,numberValue:u,backgroundColor:o,color:i,node:s,nodeObj:this.state.currentElement,isKeyElement:c}),console.log("handleOkModal3",t),this.setState({options:t,showModal:!1,isLoadingDetail:!1,modalValue:""}),console.log("handleOkModal4",t),d=t.map((function(e){return{number:e.number,position:e.position,numberValue:e.numberValue}})),this.props.setFieldValue(this.props.field.name,JSON.stringify(d)),e.next=15,this.updateStateTable("add");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,console.log("getAssemblyElementPattern",a.length),e.abrupt("return",a.length>0?a[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllNodePositions();case 2:if(a=e.sent,console.log("this_update_state_table",this),null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),r=this.props.refComponentDataGrid.getStateTableData()),s=null,l=null,o=null,null!=n?l=n:(console.log("add",this.state.options.length),"add"==t?l=this.state.options[this.state.options.length-1]:"delete"==t&&(l=this.state.itemForDelete)),null!=l){e.next=11;break}return e.abrupt("return");case 11:if(i=null,c=null,null==this.props.activeRecord.reestr_ke_node_type){e.next=21;break}return e.next=16,this.getAssemblyElementPattern(this.props.activeRecord.reestr_ke_node_type.toString());case 16:if(null!=(u=e.sent)&&null!=u.ke_node_type&&null!=u.documentation){e.next=19;break}return e.abrupt("return");case 19:i=u.ke_node_type,c=u.documentation;case 21:if(null!=(s=l.isKeyElement?null!=l.node?r.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==l.positionObj.child_node_type})):r.find((function(e){return null!=e.keyElementTypeId&&e.keyElementTypeId==l.nodeObj.key_element_code})):r.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==l.nodeObj.ke_node_type})))){e.next=24;break}return e.abrupt("return");case 24:if("delete"!=t||0!=s.usedPositionsCount){e.next=26;break}return e.abrupt("return");case 26:if(null==s.assemblyElementTypeId){e.next=32;break}return e.next=29,this.getAvailablePositionsByAssemblyElementOnAssemblyElement(i,s.assemblyElementTypeId,c,a);case 29:o=e.sent,e.next=36;break;case 32:if(null==s.keyElementTypeId){e.next=36;break}return e.next=35,this.getAvailablePositionsByKeyElementOnAssemblyElement(i,s.keyElementTypeId);case 35:o=e.sent;case 36:d=r.indexOf(s),"add"==t?s.usedPositionsCount=s.usedPositionsCount+1:"delete"==t&&(s.usedPositionsCount=s.usedPositionsCount-1),s.isFull=s.usedPositionsCount===s.positionsCount,s.assemblyElementCountStr=s.usedPositionsCount+" \u0438\u0437 "+s.positionsCount,null!=o&&o.length>0?(h=o.map((function(e){return e.recname})),m=h.join(", ")):m=null,s.assemblyElementAvailablePositions=m,r[d]=s,null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),r=this.props.refComponentDataGrid.setStateTableData(r));case 44:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(n,")").concat(a));case 3:if(r=e.sent,s=r.value,console.log("allPositionsResp",s.length),null!=s||0!=s.length){e.next=8;break}return e.abrupt("return",null);case 8:for(l=[],o=[],null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),i=this.props.refComponentDataGrid.state.childKeyElements),console.log("installedKeyElements",this.state),c=0;c<i.length;c++)null!=i[c].position_on_node&&l.push(i[c].position_on_node);if(console.log("installedKeyElements",this.state.options),this.state.options.length>0)for(c=0;c<this.state.options.length;c++)l.push(this.state.options[c].position);return(o=l.length>0?s.filter((function(e){return null==l.find((function(t){return t==e.recid}))})):s).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(a,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:l=e.sent,o=l.value[0],s=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(s));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(K.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=r.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(console.log("allPositionsOnNode",u.length),null!=u||0!=u.length){e.next=19;break}return e.abrupt("return",null);case 19:for(null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),y=this.props.refComponentDataGrid.state.childAssemblyElements),console.log("alreadyInstalledNodes",y.length),g=0;g<y.length;g++)null!=(k=y[g]).position_on_assembly_element&&d.push(k.position_on_assembly_element);if(console.log("athis.state.optionsaa",this.state.options),this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(v=this.state.options[g]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n&&d.push(v.positionObj.node_position):null!=v.position&&n==v.nodeObj.ke_node_type&&d.push(v.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"checkAssemblyElementCompositionAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a){var r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=9;break}return e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(a,") and (child_assembly_element eq ").concat(n.ke_node_type,")"));case 3:if(r=e.sent,null!=(s=r.value)&&0!=s.length){e.next=7;break}return e.abrupt("return",{success:!1,message:"\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 "+n.unique_number+" ("+n.ke_node_type_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430."});case 7:e.next=15;break;case 9:return e.next=11,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(a,") and (child_key_element eq ").concat(t.key_element_code,")"));case 11:if(r=e.sent,null!=(s=r.value)&&0!=s.length){e.next=15;break}return e.abrupt("return",{success:!1,message:"\u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c "+t.numberke+" ("+t.key_element_code_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430."});case 15:return e.abrupt("return",{success:!0,message:null});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getOptions",value:function(){var e=this;this.setState({isLoading:!0}),fetch("/odata/$metadata/".concat(this.props.field.relation.table),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){var n=t.fieldGroups.autoLookup.fields.map((function(e){return e.name.toLowerCase()})),a=e.props.field.relation,r=a.field,s=a.displayField;null==r&&(r="recid"),null==s&&(s="recname"),null==n.find((function(e){return e==s.toLowerCase()}))&&n.push(s.toLowerCase());var l="",o=!1;if(null!=e.props.field.lookup){var i=e.props.field.lookup.field,c=e.props.activeRecord[i];l="$filter=(".concat(i," eq '").concat(c,"')"),-1==n.findIndex((function(e){return e==i}))&&(n.push(i),o=!0)}fetch("/odata/".concat(e.props.field.relation.table,"?").concat(l,"&$select=").concat(n.join(",")),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){o&&(n=n.filter((function(t){return t!=e.props.field.lookup.field}))),-1==t.value.findIndex((function(t){return t.recid==e.props.value}))&&e.props.setFieldValue(e.props.field.name,null);var a=t.value.map((function(e){return{id:e[r.toLowerCase()],value:n.filter((function(e){return"recid"!=e})).map((function(t){return e[t]})).join(", ")}})).sort((function(e,t){return e.value<t.value?-1:e.value>t.value?1:0}));e.setState({options:a,isLoading:!1,isLoadingDetail:!1})}))}))}},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(C.a)(this.state.options),-1!==(a=n.indexOf(t))&&(n.splice(a,1),this.setState({options:n}),this.props.setFieldValue(this.props.field.name,JSON.stringify(n))),this.setState({showDeleteModal:!1}),r=Object(C.a)(this.state.addedItems),s=r.find((function(e){return e==t.numberValue})),-1!==(l=r.indexOf(s))&&(r.splice(l,1),this.setState({addedItems:r})),!(o=this.state.itemForDelete).isKeyElement||"e4ef0365-0365-40df-ab4e-a77104c352df"!=o.nodeObj.key_element_code){e.next=24;break}if(null==this.props.refComponentDataGrid){e.next=15;break}if(console.log("refComponentDataGrid",this.props.refComponentDataGrid),null!=(i=this.props.refComponentDataGrid.getStateTableData(i))||0!=i.length){e.next=15;break}return e.abrupt("return");case 15:if(null==i.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=24;break}if(!o.nodeObj.has_rough_axis_number||null==o.nodeObj.rough_axis||""==o.nodeObj.rough_axis){e.next=24;break}return e.next=20,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(o.nodeObj.rough_axis,")"));case 20:if(null==(c=e.sent)){e.next=24;break}return e.next=24,this.updateStateTable("delete",{value:c.recid,number:c.recid,numberValue:c.numberke,node:null,nodeObj:c,isKeyElement:!0});case 24:return e.next=26,this.updateStateTable("delete");case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return a.createElement(W.a,{isOpen:this.state.showDeleteModal,size:"xl"},a.createElement(H.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),a.createElement(Z.a,null,a.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),a.createElement(Y.a,null,a.createElement(b.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),a.createElement(b.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},a.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;console.log("render_creatable",this.props);return a.createElement(k.a,null,a.createElement(v.a,null,a.createElement("b",null,this.props.field.displayName)),a.createElement(J.a,{ref:function(t){e.refInput=t},name:this.props.field.name,components:{MultiValue:function(t){var n={backgroundColor:t.data.backgroundColor,color:t.data.color};return a.createElement("div",{className:"SelectValue",style:n},a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t.data)}},"\xd7"),a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.options,isMulti:!0,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.props.field.isDisabled||this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}),a.createElement(W.a,{isOpen:this.state.showModal,toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},a.createElement(H.a,{toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),a.createElement(Z.a,null,a.createElement(f.a,null,a.createElement(b.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal,style:{width:"124px",height:"32px"}},a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",a.createElement(b.a,{size:"sm",onClick:function(){return e.setState({showModal:!1,modalItems:[],isLoadingDetail:!1})},style:{width:"103.63px",height:"32px"}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),a.createElement("hr",null),a.createElement(v.a,null,"\u041d\u043e\u043c\u0435\u0440"),a.createElement(E.a,{id:"number",value:"keyElement"==this.state.currentElementType?this.state.currentElement.ke_number_calculated:this.state.currentElement.unique_number,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),a.createElement(E.a,{id:"element_name",value:"keyElement"==this.state.currentElementType?this.state.currentElement.key_element_code_calculated:this.state.currentElement.ke_node_type_calculated,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),a.createElement(j.a,{name:"testname",options:this.state.modalItems,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",getOptionLabel:function(e){return e.recname},getOptionValue:function(e){return e.recid},onChange:this.handleModalChange,value:this.state.modalValue,onValueClick:function(e){return T(!0,e.value)},styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}))),this.renderDeleteConfirm())}}]),n}(a.Component)),bt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).onCellPrepared=function(e){console.log(e.data),"data"===e.rowType&&null!=e.data&&(e.cellElement.style.backgroundColor=e.data.positionsCount==e.data.usedPositionsCount?"rgb(91, 223, 127)":"rgb(222, 91, 91)")},a.state={options:[],selectedRowNotes:"",data:[],uin:"",elements_in_vagon:{},select_element:{},is_circ:!1,visible_alert:!1,name_old_element:"",name_new_element:null,elementType:"",assemblyElementPatternId:null,stateTableLoaded:!1,stateTableLoading:!1,childKeyElements:[],childAssemblyElements:[]},a.loadStateTable=a.loadStateTable.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount",this.props),console.log("this_componentDidMount",this),e.next=4,this.loadStateTable();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("componentDidUpdate",this),this.props.ref=this,this.state.assemblyElementPatternId==this.props.activeRecord.reestr_ke_node_type.toString()){e.next=11;break}if(this.state.stateTableLoaded||this.state.stateTableLoading||null==this.props.activeRecord.reestr_ke_node_type.toString()){e.next=7;break}return e.next=6,this.loadStateTable();case 6:return e.abrupt("return");case 7:if(!this.state.stateTableLoaded||this.state.stateTableLoading||this.state.assemblyElementPatternId!=this.props.activeRecord.reestr_ke_node_type.toString()==null){e.next=11;break}return e.next=10,this.loadStateTable();case 10:return e.abrupt("return");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v,E,O;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadStateTable",this.props),this.setState({stateTableLoading:!0}),this.props.updateStateTableLoading(!0),t="assemblyElement",this.setState({elementType:t}),e.next=7,this.getAllKeyElementTypes();case 7:return n=e.sent,e.next=10,this.getAllAssemblyElementTypes();case 10:return a=e.sent,e.next=13,this.getAllNodePositions();case 13:if(r=e.sent,s=[],"assemblyElement"!=t){e.next=81;break}return l=null,o=null,e.next=20,this.getAssemblyElementPattern(this.props.activeRecord.reestr_ke_node_type.toString());case 20:if(i=e.sent,console.log("assemblyElementPattern",i),this.setState({assemblyElementPatternId:i.recid}),null!=i&&null!=i.ke_node_type&&null!=i.documentation){e.next=29;break}return this.setState({stateTableLoading:!1,stateTableLoaded:!0}),this.props.updateStateTableLoading(!1),this.props.updateStateTableLoaded(!0),this.setStateTableData([]),e.abrupt("return");case 29:if(l=i.ke_node_type,o=i.documentation,null==l){e.next=81;break}return console.log("parentAssemblyElementTypeId",[l,o]),e.next=35,this.getAssemblyElementComposition(l,o);case 35:if(c=e.sent,console.log("assemblyElementComposition",c),console.log("assemblyElementComposition",c.length),0==c.length){e.next=81;break}return e.next=41,this.getChildKeyElementsByAssemblyElement(this.props.activeRecord.recid);case 41:return u=e.sent,e.next=44,this.getChildAssemblyElementsByAssemblyElement(this.props.activeRecord.recid);case 44:d=e.sent,this.state.childKeyElements=u,this.state.childAssemblyElements=d,m=0;case 48:if(!(m<c.length)){e.next=81;break}if(console.log("assemblyElementComposition2",c),console.log("assemblyElementComposition2",c.length),h=c[m],f=null!=h.child_key_element,b=null!=h.child_assembly_element,!f){e.next=65;break}return t=n.find((function(e){return e.recid==h.child_key_element})),_=t.recname,y=u.filter((function(e){return e.key_element_code==h.child_key_element})),e.next=60,this.getAvailablePositionsByKeyElementOnAssemblyElement(l,h.child_key_element);case 60:g=e.sent,v=h.child_key_element,E=null,e.next=74;break;case 65:if(!b){e.next=74;break}return t=a.find((function(e){return e.recid==h.child_assembly_element})),_=t.recname,y=d.filter((function(e){return e.ke_node_type==h.child_assembly_element})),e.next=71,this.getAvailablePositionsByAssemblyElementOnAssemblyElement(l,h.child_assembly_element,o,r);case 71:g=e.sent,v=null,E=h.child_assembly_element;case 74:console.log("availablePositions",g.length),console.log("childElements",y.length),null!=g&&g.length>0?(O=g.map((function(e){return e.recname})),k=O.join(", ")):k=null,h.count&&h.count>0&&(s.push({keyElementTypeId:v,assemblyElementTypeId:E,positionsCount:h.count,usedPositionsCount:y.length,isFull:h.count===y.length,number:m+1,assemblyElementName:_,assemblyElementCountStr:y.length+" \u0438\u0437 "+h.count,assemblyElementAvailablePositions:k}),this.setStateTableData(s));case 78:m++,e.next=48;break;case 81:null!=s&&s.length>0?(this.setState({stateTableLoaded:!0}),this.props.updateStateTableLoaded(!0)):(this.setStateTableData([]),this.setState({stateTableLoaded:!1}),this.props.updateStateTableLoaded(!1)),this.setState({stateTableLoading:!1}),this.props.updateStateTableLoading(!1);case 84:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllKeyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_key_elements_codes?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllAssemblyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a.length>0?a[0]:null);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChildAssemblyElementsByAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAssemblyElementComposition",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(t,") and (documentation_number eq ").concat(n,")"));case 2:return a=e.sent,r=a.value,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getChildKeyElementsByAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_node eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(n,")").concat(a));case 3:if(r=e.sent,s=r.value,console.log("allPositions",s),null!=s||0!=s.length){e.next=8;break}return e.abrupt("return",null);case 8:for(l=[],o=[],console.log("allPositions2",s),i=this.state.childKeyElements,console.log("installedKeyElements",i),c=0;c<i.length;c++)null!=i[c].position_on_node&&l.push(i[c].position_on_node);if(this.state.options.length>0)for(c=0;c<this.state.options.length;c++)l.push(this.state.options[c].position);return(o=l.length>0?s.filter((function(e){return null==l.find((function(t){return t==e.recid}))})):s).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(a,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:l=e.sent,o=l.value[0],s=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(s));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(K.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=r.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(null!=u||0!=u.length){e.next=18;break}return e.abrupt("return",null);case 18:for(y=this.state.childAssemblyElements,g=0;g<y.length;g++)null!=(k=y[g]).position_on_assembly_element&&d.push(k.position_on_assembly_element);if(this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(v=this.state.options[g]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n&&d.push(v.positionObj.node_position):null!=v.position&&n==v.nodeObj.ke_node_type&&d.push(v.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){(console.log("setStateTableData",e),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance)&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(console.log("getStateTableData"),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"render",value:function(){return r.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},r.a.createElement(y.a,{md:"auto"},r.a.createElement(te.a,{preloadEnabled:!1,name:this.props.field.name,selection:{mode:"single"},showBorders:!0,showColumnLines:!1,showRowLines:!0,hoverStateEnabled:!0,columnAutoWidth:!0,onCellPrepared:this.onCellPrepared,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},r.a.createElement(ee.Column,{width:"3%",dataField:"number",caption:"#",dataType:"number"}),r.a.createElement(ee.Column,{width:"30%",dataField:"assemblyElementName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",dataType:"string"}),r.a.createElement(ee.Column,{width:"10%",dataField:"assemblyElementCountStr",caption:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"assemblyElementAvailablePositions",caption:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",dataType:"string"})),r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ne.a,{color:"success",isOpen:this.state.visible_alert},r.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),this.state.selectedRowNotes))))}},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,s,l,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedRowsData,"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0435\u0437 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445"!=(a=n[0]).nameke&&"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430"!=a.nameke&&"\u0422\u0435\u043b\u0435\u0436\u043a\u0430"!=a.nameke||(this.setState({is_circ:!0}),a.is_circ=!0),null==this.props.values.select_field.key_element_code){e.next=12;break}if(null==this.props.values.select_field.ke_node){e.next=11;break}return e.next=7,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.ke_node,")"));case 7:l=e.sent,s=r.a.createElement("b",null,l.value[0].ke_node_type_calculated," ",l.value[0].unique_number),e.next=12;break;case 11:s=r.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke);case 12:if(null==this.props.values.select_field.ke_node_type){e.next=21;break}if(null==this.props.values.select_field.parent_ke_node){e.next=20;break}return e.next=16,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.parent_ke_node,")"));case 16:o=e.sent,s=r.a.createElement("b",null,o.value[0].ke_node_type_calculated," ",o.value[0].unique_number),e.next=21;break;case 20:s=r.a.createElement("b",null,this.props.values.select_field.ke_node_type_calculated," ",this.props.values.select_field.unique_number);case 21:i=r.a.createElement("p",null,"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435 ",this.props.activeRecord.manufacturer_number," ",r.a.createElement("b",null,a.nameke," ",a.numberke)," \u043d\u0430 ",s),this.setState({visible_alert:!0,select_element:a,selectedRowNotes:i}),this.props.setFieldValue(this.props.field,a);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(a.Component),_t=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),yt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){a.setState({value:e})},a.state={value:""},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(W.a,{isOpen:this.props.field.showModal,toggle:function(){return e.props.setFalseModalState()}},r.a.createElement(H.a,{toggle:function(){return e.props.setFalseModalState()}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),r.a.createElement(Z.a,null,r.a.createElement(f.a,null,r.a.createElement(b.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sm",onClick:function(){return e.props.setFalseModalState()}},r.a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),r.a.createElement("hr",null),r.a.createElement(v.a,null,"\u041d\u043e\u043c\u0435\u0440"),r.a.createElement(E.a,{id:"number",value:null!=this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1]?this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1].label:"",readOnly:!0}),r.a.createElement("br",null),r.a.createElement(v.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),r.a.createElement(E.a,{id:"element_name",value:null!=this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1]?this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1].title:"",readOnly:!0}),r.a.createElement("br",null),r.a.createElement(v.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),console.log(this.props.field.positions.map((function(e){return{value:e,label:e.toString()}}))),r.a.createElement(j.a,{name:"testname",options:null!=this.props.field.positions?this.props.field.positions.map((function(e){return{value:e,label:e.toString()}})):null,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.value,onValueClick:function(t){return e.popupNotifyMessage(!0,t.value)}})))}}]),n}(a.Component),gt=(a.Component,function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:{},processingAction:!1},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){if("edit"==window.rdev_modalDataPack.place)this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords});else if(window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent){var e={recid:window.rdev_modalDataPack.selectedRecords[0].recid._value,reestr_ke_node_type:window.rdev_modalDataPack.selectedRecords[0].reestr_ke_node_type._value};this.setState({activeRecord:e})}this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place})}},{key:"render",value:function(){return r.a.createElement(kt,{method:{name:"test_procedure_update",displayName:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",isEnabled:null,isAnonymous:!1,static:!1,fields:[{name:"sysstring_field",type:"SysString",typeName:"SysString",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"sysint_field",type:"SysInt",typeName:"SysInt",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"checkbox_field",type:"SysBoolean",typeName:"SysBoolean",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"creatable_field",type:"SysString",typeName:"SysString",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:!0,default:null,lookup:null,searchLevel:null}],showModalYesNo:null,initMethodParams:null,isPacketSigned:null,workflow:null,table:"types_table"},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord})}}]),n}(a.Component)),kt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateUinFieldValue=function(t){e.setState({uin_field_value:t})},e.updateGroupingElements=function(t){e.state.uin_grouping_elements.length<t.length&&e.setState({show_modal:!0}),e.setState({uin_grouping_elements:t})},e.updateStateTableLoaded=function(t){e.setState({stateTableLoaded:t})},e.updateStateTableLoading=function(t){e.setState({stateTableLoading:t})},e.setFalseModalState=function(){e.setState({show_modal:!1}),e.state.uin_grouping_elements.pop()},e.state={uin_field_value:"",uin_grouping_elements:[],show_modal:!1,select_template_plate_field:null,select_template_insert_field:null,select_template_ring_field:null,select_application_number_field:null,isActionError:!1,successMessage:"",stateTableLoaded:!1,stateTableLoading:!1},e.updateUinFieldValue=e.updateUinFieldValue.bind(Object(h.a)(e)),e.updateGroupingElements=e.updateGroupingElements.bind(Object(h.a)(e)),e.setFalseModalState=e.setFalseModalState.bind(Object(h.a)(e)),e.dataGrid={},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.updateStateTableLoaded=e.updateStateTableLoaded.bind(Object(h.a)(e)),e.updateStateTableLoading=e.updateStateTableLoading.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mem"),this.setState({processingAction:!0}),this.refs.formik.state.values,console.log("this",this),console.log("vals",this.refs.formik.state.values),console.log("records",this.props.activeRecord),t="",this.isNullObject(this.state.uin_field_value)?t=String().concat(t,'\u041f\u043e\u043b\u0435 "\u0423\u0418\u041d" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e.'):12!=this.state.uin_field_value.length&&(t=String().concat(t,'\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0423\u0418\u041d" \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0438\u0437 12 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432.')),!this.isNotEmptyString(t)){e.next=13;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,t));case 13:return n=this.refs.formik.state.values.uin_field,a=this.refs.formik.state.values.uin_elements_field,r={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({recid:this.props.activeRecord.recid,reestr_ke_node_type:this.props.activeRecord.reestr_ke_node_type,unique_number:n,ke_numbers:a})},console.log("requestBody",r),e.next=19,D("/plugins/nbdlogicplugin/adduinketoassemblyunit/"+this.props.activeRecord.recid,r.body);case 19:if(s=e.sent,console.log("result_adduinketoassemblyunit_resp",s),!s.success){e.next=27;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(s.message)));case 27:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(s.message)));case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0423\u0418\u041d/\u0421\u0427"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"uin_field",name:"uin_field"},(function(){return r.a.createElement(ht,{setFieldValue:function(n,a){t.setFieldValue(n,a),12==a.length&&e.uinElementsField.focus()},updateUinFieldValue:e.updateUinFieldValue,field:{name:"uin_field",displayName:"\u0423\u0418\u041d",value:e.state.uin_field_value,autoFocus:!0}})})),r.a.createElement(g.a,{key:"uin_elements_field",name:"uin_elements_field"},(function(){return r.a.createElement(ft,{setFieldValue:t.setFieldValue,updateGroupingElements:e.updateGroupingElements,refComponentDataGrid:e.dataGrid,activeRecord:e.props.activeRecord,ref:function(t){e.uinElementsField=t},field:{name:"uin_elements_field",displayName:"\u0423\u0418\u041d \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0432 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0443\u044e \u0435\u0434\u0438\u043d\u0438\u0446\u0443",isUinElementsField:!0,isDisabled:!e.state.stateTableLoaded||e.state.stateTableLoading}})})),r.a.createElement(g.a,{key:"data_grid",name:"data_grid"},(function(n){var a=n.formikfield;n.form;return r.a.createElement(bt,Object.assign({value:e.props,field:{name:"data_grid",data:e.props.activeRecord.recid},setFieldValue:t.setFieldValue,updateStateTableLoaded:e.updateStateTableLoaded,updateStateTableLoading:e.updateStateTableLoading,activeRecord:e.props.activeRecord,ref:function(t){return e.dataGrid=t}},t,a))})),r.a.createElement(g.a,{key:"modal_select_poition",name:"modal_select_poition"},(function(){return r.a.createElement(yt,{setFieldValue:t.setFieldValue,setFalseModalState:e.setFalseModalState,field:{name:"modal_select_poition",displayName:"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",showModal:e.state.show_modal,uinGroupingElements:e.state.uin_grouping_elements,positions:mt[1].available_positions}})})))}}),r.a.createElement(_t,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}}]),n}(r.a.Component),vt=(n(1147),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){console.log(t.target.value),e.props.updateData(t.target.value),e.props.setFieldValue(e.props.field.name,t.target.value)},e.focus=function(){e.refInput.focus()},e}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(k.a,null,r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement("input",{onChange:this.handleChange,name:this.props.field.name,onBlur:this.props.onBlur,disabled:this.props.field.isDisabled,ref:function(t){e.refInput=t},className:"form-control"}))}}]),n}(a.Component)),Et=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),Ot=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),a.setState({selectedValue:e}),a.props.setFieldValue(a.props.field.name,e),console.log(a.state.selectedValue),console.log(a.props)},a.state={modalItems:[],selectedValue:""},a.getData=a.getData.bind(Object(h.a)(a)),a.handleChange=a.handleChange.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount"),e.next=3,this.getData();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getData",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("old_uin"!=this.props.field.name){e.next=3;break}return e.next=3,fetch("/odata/reestr_key_elements?$select=recid,numberke,key_element_code_calculated&$orderBy=numberke desc&$filter=((recstate eq 1) and (ke_node eq ".concat(this.props.activeRecord.recid,"))"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(t.isNullOrEmptyResponse(e))return console.log("\u0421\u0427 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b");t.setState({modalItems:e.value})}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}},{key:"sendRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});case 2:return n=e.sent,console.log(n),e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){var e=this;return r.a.createElement(k.a,null,r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(j.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(e){return e.key_element_code_calculated+", "+e.numberke},getOptionValue:function(e){return e.recid},options:this.state.modalItems,onChange:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,onInputChange:function(t){var n=X(t);return e.setState({inputValue:n}),n},isDisabled:this.props.field.isUinField||this.props.field.isDisabled,autoFocus:this.props.field.autoFocus||!1,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}))}}]),n}(a.Component),xt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,new_uin:""},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){if("edit"==window.rdev_modalDataPack.place)this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords});else if(window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent){var e={recid:window.rdev_modalDataPack.selectedRecords[0].recid._value,assembly_element_type:window.rdev_modalDataPack.selectedRecords[0].assembly_element_type._value};this.setState({activeRecord:e})}this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place})}},{key:"render",value:function(){return r.a.createElement(St,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord,tableName:this.state.tableName})}}]),n}(a.Component),St=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateUinField=function(t){console.log("updateUinField",t),e.setState({new_uin:t})},e.state={processingAction:!1},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),t=this.refs.formik.state.values,console.log("this",this),console.log("vals",this.refs.formik.state.values),console.log("records",this.props.activeRecord),n="",this.isNullObject(this.state.new_uin)?n=String().concat(n,'\u041f\u043e\u043b\u0435 "\u0423\u0418\u041d \u043d\u043e\u0432\u043e\u0433\u043e \u0421\u0427" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e.'):12!=this.state.new_uin.length&&(n=String().concat(n,'\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0423\u0418\u041d \u043d\u043e\u0432\u043e\u0433\u043e \u0421\u0427" \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0438\u0437 12 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432.')),null==this.refs.formik.state.values.old_uin&&(n=String().concat(n,'\u041f\u043e\u043b\u0435 "\u0423\u0418\u041d \u0421\u0427, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043c\u0435\u043d\u0435\u043d" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e.')),!this.isNotEmptyString(n)){e.next=13;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,n));case 13:return a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({assembly_unit_recid:this.props.activeRecord.recid,old_key_element:t.old_uin.recid,new_key_element:this.state.new_uin})},console.log("requestBody",a),e.next=17,D("/plugins/nbdlogicplugin/replacekeinassemblyunit",a.body);case 17:if(r=e.sent,console.log("result_addtobatch_resp",r),!r.success){e.next=25;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(r.message)));case 25:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(r.message)));case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0417\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u0434\u0435\u0442\u0430\u043b\u0438"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"old_uin",name:"old_uin"},(function(){return r.a.createElement(Ot,{setFieldValue:function(n,a){t.setFieldValue(n,a),console.log("PluginSelect value",a),void 0!=a&&null!=a&&""!=a&&e.newUinField.focus()},activeRecord:e.props.activeRecord,field:{name:"old_uin",displayName:"\u0423\u0418\u041d \u0421\u0427, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043c\u0435\u043d\u0435\u043d\u0430",autoFocus:!0}})})),r.a.createElement(g.a,{key:"new_uin",name:"new_uin"},(function(){return r.a.createElement(vt,{setFieldValue:t.setFieldValue,updateData:e.updateUinField,field:{name:"new_uin",displayName:"\u0423\u0418\u041d \u043d\u043e\u0432\u043e\u0439 \u0421\u0427",isDisabled:!1},activeRecord:e.props.activeRecord,tableName:e.props.tableName,ref:function(t){e.newUinField=t}})})))}}),r.a.createElement(Et,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}}]),n}(r.a.Component),wt=(n(1148),[{title:"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445 \u0443\u0437\u043b\u043e\u0432",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u041f\u043e\u0434\u0448\u0438\u043f\u043d\u0438\u043a \u0431\u0443\u043a\u0441\u043e\u0432\u043e\u0433\u043e \u0443\u0437\u043b\u0430",current_quantity:0,necessary_quantity:2,available_positions:[1,2]},{title:"\u0417\u0430\u043c\u043e\u043a",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u0412\u0430\u043b\u0438\u043a \u043f\u043e\u0434\u044a\u0435\u043c\u043d\u0438\u043a\u0430",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u041a\u043e\u0440\u043f\u0443\u0441 \u0430\u0432\u0442\u043e\u0441\u0446\u0435\u043f\u043a\u0438",current_quantity:0,necessary_quantity:1,available_positions:null}]),Ct=(a.Component,n(1149),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),null!=e&&e.length>a.state.options.length&&a.handleNewOptionClick(e[e.length-1]);var t=e.map((function(e){return{number:e.number,position:e.position}}));a.props.setFieldValue(a.props.field.name,JSON.stringify(t))},a.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),n=X(t.value),a.setState({isLoadingDetail:!0}),e.next=5,a.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(n,"')"));case 5:if(r=e.sent,!a.isNullOrEmptyResponse(r)){e.next=8;break}return e.abrupt("return",a.modalError("\u0423\u0418\u041d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435"));case 8:return s=r.value[0],e.next=11,a.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(s.recid,")"));case 11:return l=e.sent,e.next=14,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(s.recid,")"));case 14:if(o=e.sent,!a.isNullOrEmptyResponse(o)||!a.isNullOrEmptyResponse(l)){e.next=17;break}return e.abrupt("return",a.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 17:if((i=a.state.addedItems).push(n),!(null!=a.state.options&&a.state.options.length>0)){e.next=24;break}if(c=Object(C.a)(a.state.options),null==c.find((function(e){return e.numberValue==n}))){e.next=24;break}return e.abrupt("return",a.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 24:if(a.isNullOrEmptyResponse(l)||!a.isNullOrEmptyResponse(o)){e.next=31;break}return u=l.value[0],e.next=28,a.defineKeyElementPositions(u);case 28:a.setState({addedItems:i}),e.next=36;break;case 31:if(a.isNullOrEmptyResponse(o)){e.next=36;break}return d=o.value[0],e.next=35,a.defineAssemblyElementPositions(d);case 35:a.setState({addedItems:i});case 36:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.prepareValue=function(){return a.props.value instanceof Array?a.props.value[0]:a.props.value},a.state={options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null},a.handleNewOptionClick=a.handleNewOptionClick.bind(Object(h.a)(a)),a.getOptions=a.getOptions.bind(Object(h.a)(a)),a.handleModalChange=a.handleModalChange.bind(Object(h.a)(a)),a.renderDeleteConfirm=a.renderDeleteConfirm.bind(Object(h.a)(a)),a.handleOkModal=a.handleOkModal.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("cdm",this.refInput),setTimeout((function(){e.refInput.focus()}),1)}},{key:"focus",value:function(){var e=this;setTimeout((function(){e.refInput.focus()}),1)}},{key:"assemblyElementAlreadyExist",value:function(e,t){return 0==e.length||null==e.find((function(e){return null!=e.node&&null!=t&&e.node==t}))}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&T(!1,e)}},{key:"defineKeyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v,E,O,x,S,w,C,j,A,N,R,D,q,V=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,a=null,r=null,s=null,null==t.ke_node||""==t.ke_node){e.next=18;break}return e.next=7,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.ke_node,")"));case 7:if(l=e.sent,!this.isNullOrEmptyResponse(l)){e.next=10;break}return e.abrupt("return");case 10:if(n=l.value[0],a=n.recid,r=n.ke_node_type,s=t.position_on_node,!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,a)){e.next=16;break}return e.abrupt("return",this.modalError("\u0423\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0444\u043e\u0440\u043c\u0443."));case 16:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o||null==s){e.next=18;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 18:return o=t.key_element_code,t.documentation_number_calculated,this.setState({currentElement:t,currentElementType:"keyElement"}),e.next=23,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(this.props.activeRecord.reestr_ke_node_type.toString(),")"));case 23:if(i=e.sent,!this.isNullOrEmptyResponse(i)){e.next=26;break}return e.abrupt("return");case 26:return c=i.value[0],u=c.ke_node_type,e.next=30,this.checkAssemblyElementCompositionAsync(t,n,u);case 30:if((d=e.sent).success){e.next=33;break}return e.abrupt("return",this.modalError(d.message));case 33:if(null!=a&&""!=a){e.next=104;break}return m=null!=u&&""!=u?" and (node_type eq ".concat(u,")"):"",e.next=37,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(o,")").concat(m));case 37:if(h=e.sent,f=h.value,b=[],_=[],"477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"34c12f72-eb33-4ab1-ba3e-a80166258e5d"!=o&&"ff1d8011-75dc-4d30-832f-f47c3d5ac430"!=o&&"4aed23f8-9710-4904-a2f5-b89d9bc7c75c"!=o&&"975cd310-7675-4436-899f-4c6b84555f6a"!=o&&"38dd229a-915f-49ef-bba8-a28f055c9962"!=o||0!=f.length){e.next=45;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 45:if("e4ef0365-0365-40df-ab4e-a77104c352df"!=o){e.next=87;break}if(t.has_rough_axis_number){e.next=50;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 50:return e.next=52,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(ke_node_type eq ".concat(u,") and (scheme eq ").concat(c.documentation,")"));case 52:if(y=e.sent,!this.isNullOrEmptyResponse(y)){e.next=55;break}return e.abrupt("return",this.modalError('\u0414\u043b\u044f \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0443\u0437\u043b\u0430/\u0421\u0415 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0441\u043f\u0440\u0430\u0432\u043e\u043d\u0438\u043a\u0435 "\u041a\u043e\u043b-\u0432\u043e \u0421\u0427/\u0421\u0415 \u0432 \u0421\u0415/\u0443\u0437\u043b\u0435".'));case 55:if(null!=(g=y.value[0]).rough_axis_count&&0!=g.rough_axis_count){e.next=60;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 60:if(k=null,!t.has_rough_axis_number){e.next=69;break}if(null!=t.rough_axis&&""!=t.rough_axis){e.next=64;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u041e\u0441\u0438 \u0447\u0438\u0441\u0442\u043e\u0432\u043e\u0439 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0443\u044e."));case 64:return e.next=66,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(t.rough_axis,")"));case 66:if(null!=(k=e.sent)){e.next=69;break}return e.abrupt("return",this.modalError("\u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0430\u044f \u0432 \u043e\u0441\u0438 \u0447\u0438\u0441\u0442\u043e\u0432\u043e\u0439, \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 69:if(null==t.blockchainhash||""==t.blockchainhash||null!=k.blockchainhash&&""!=k.blockchainhash){e.next=71;break}return e.abrupt("return",this.modalError("\u041d\u0435\u043b\u044c\u0437\u044f \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u041e\u0441\u044c \u0447\u0438\u0441\u0442\u043e\u0432\u0443\u044e \u0441 \u0423\u0418\u041d ".concat(t.numberke,", \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u0430\u044f \u0441 \u043d\u0435\u0439 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f \u0441 \u0423\u0418\u041d ").concat(k.numberke," \u043d\u0435 \u0432\u044b\u043f\u0443\u0449\u0435\u043d\u0430 \u0432 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435.")));case 71:if(null!=t.blockchainhash&&""!=t.blockchainhash){e.next=75;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return",T(!0,"\u0421\u0427 \u041e\u0441\u044c \u0447\u0438\u0441\u0442\u043e\u0432\u0430\u044f \u0441 \u0423\u0418\u041d ".concat(t.numberke," \u043d\u0435 \u0432\u044b\u043f\u0443\u0449\u0435\u043d \u0432 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0439 \u0441 \u043d\u0438\u043c \u0421\u0427 \u041e\u0441\u044c \u0427\u0435\u0440\u043d\u043e\u0432\u0430\u044f c \u0423\u0418\u041d ").concat(k.numberke," \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d.")));case 75:if(null==t.blockchainhash||""==t.blockchainhash||null==k.blockchainhash||""==k.blockchainhash){e.next=84;break}if(v=this.props.refComponentDataGrid.getStateTableData(),null!=v.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=82;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 82:return e.next=84,this.updateStateTable("add",{value:k.recid,number:k.recid,numberValue:k.numberke,node:null,nodeObj:k,isKeyElement:!0});case 84:return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 87:if("a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o){e.next=89;break}return e.abrupt("return",this.modalError("\u041d\u0435\u043b\u044c\u0437\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0421\u0427 \u0442\u0438\u043f\u0430 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f."));case 89:return e.next=91,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_node eq ".concat(this.props.activeRecord.recid,")"));case 91:for(E=e.sent,O=E.value,x=0;x<O.length;x++)null!=O[x].position_on_node&&_.push(O[x].position_on_node);if(this.state.options.length>0)for(x=0;x<this.state.options.length;x++)_.push(this.state.options[x].position);if((b=_.length>0?f.filter((function(e){return null==_.find((function(t){return t==e.recid}))})):f).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),1!=b.length){e.next=101;break}return this.setState({modalItems:b,modalValue:b[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 101:this.setState({modalItems:b,modalValue:""}),e.next=153;break;case 104:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o){e.next=106;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 106:if(m=null!=r&&""!=r?" and (parent_node_type eq ".concat(u,")"):"",S="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=u){e.next=114;break}return e.next=111,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(c.documentation,") and\n\t\t\t\t\t\t(ke_node_type eq ").concat(u,")"));case 111:w=e.sent,C=w.value[0],S=C.slider_body_count>2&&C.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 114:return e.next=116,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=(key_element_code eq ".concat(o,") and (child_node_type eq ").concat(r,")").concat(m).concat(S));case 116:if(j=e.sent,A=j.value,N=[],N=A.filter((function(e){return e.position_on_node==s})),R=N.map((function(e){return e.alternative_position})),[],A.filter((function(e){return null!=R.find((function(t){return t==e.recname}))})).map((function(e){null==N.find((function(t){return t.recid==e.recid}))&&N.push(e)})),_=[],b=[],!(this.state.options.length>0)){e.next=141;break}x=0;case 128:if(!(x<this.state.options.length)){e.next=141;break}if(this.state.options[x].isKeyElement){e.next=137;break}return e.next=132,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t\t\t\t\t\t(child_node_type eq ".concat(this.state.options[x].nodeObj.ke_node_type,") \n\t\t\t\t\t\t\t\tand (node_position eq ").concat(this.state.options[x].position,")").concat(S));case 132:j=e.sent,(D=j.value).length>0&&D.forEach((function(e){_.push(e.recid)})),e.next=138;break;case 137:_.push(this.state.options[x].position);case 138:x++,e.next=128;break;case 141:if(b=_.length>0?N.filter((function(e){return null==_.find((function(t){return t==e.recid}))})):N,q=[],this.state.options.length>0)for(x=0;x<this.state.options.length;x++)null!=this.state.options[x].node&&this.state.options[x].node!=a&&null!=this.state.options[x].positionObj&&null!=this.state.options[x].positionObj.child_node_type&&null!=(q=b.filter((function(e){return e.parent_node_type==u&&e.node_position==V.state.options[x].positionObj.node_position&&e.child_node_type==V.state.options[x].positionObj.child_node_type})))&&q.length>0&&(b=b.filter((function(e){return null==q.find((function(t){return t.recid==e.recid}))})));if(b.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),!(b.length<=1)){e.next=151;break}return this.setState({modalItems:b,modalValue:b[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 151:this.setState({modalItems:b,modalValue:""});case 152:this.setState({modalItems:b,modalValue:""});case 153:this.setState({showModal:!0});case 154:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"defineAssemblyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({currentElement:t,currentElementType:"assemblyElement"}),!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,t.recid)){e.next=3;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t.unique_number," \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0432 \u0444\u043e\u0440\u043c\u0443.")));case 3:return e.next=5,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types(".concat(t.ke_node_type,")"));case 5:if(n=e.sent,console.log("ddd",n),!n.is_variable){e.next=9;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0421\u0427."));case 9:return console.log("assemblyUnit",t),e.next=12,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(this.props.activeRecord.reestr_ke_node_type.toString(),")"));case 12:if(a=e.sent,!this.isNullOrEmptyResponse(a)){e.next=15;break}return e.abrupt("return");case 15:if(r=a.value[0],s=r.ke_node_type,l="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=s){e.next=24;break}return e.next=21,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(r.documentation,") and\n\t\t\t\t(ke_node_type eq ").concat(s,")"));case 21:o=e.sent,i=o.value[0],l=i.slider_body_count>2&&i.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 24:return e.next=26,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n.recid,") and \n\t\t\t(parent_node_type eq ").concat(s,") ").concat(l));case 26:return c=e.sent,u=c.value,console.log("aaaa",u),e.next=31,this.checkAssemblyElementCompositionAsync(null,t,s);case 31:if((d=e.sent).success){e.next=34;break}return e.abrupt("return",this.modalError(d.message));case 34:m=[],h=[],f=[],b=Object(K.a)(u),e.prev=38,b.s();case 40:if((_=b.n()).done){e.next=49;break}if(null==(y=_.value).node_position||null!=m.find((function(e){return e.recid==y.node_position}))){e.next=47;break}return e.next=45,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recid eq ".concat(y.node_position,")"));case 45:g=e.sent,this.isNullOrEmptyResponse(g)||m.push(g.value[0]);case 47:e.next=40;break;case 49:e.next=54;break;case 51:e.prev=51,e.t0=e.catch(38),b.e(e.t0);case 54:return e.prev=54,b.f(),e.finish(54);case 57:if(this.state.options.length>0)for(k=0;k<this.state.options.length;k++)(v=this.state.options[k]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n.recid&&h.push(v.positionObj.node_position):null!=v.position&&n.recid==v.nodeObj.ke_node_type&&h.push(v.positionObj.recid);if(!(h.length>0)){e.next=64;break}if(0!=(f=m.filter((function(e){return null==h.find((function(t){return t==e.recid}))}))).length){e.next=62;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415."));case 62:e.next=65;break;case 64:f=m;case 65:if(0!=f.length){e.next=69;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 69:if(f.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),!(f.length<=1)){e.next=76;break}return this.setState({modalItems:f,modalValue:f[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 76:this.setState({modalItems:f,modalValue:""});case 77:this.setState({modalItems:f,modalValue:""}),this.setState({showModal:!0});case 79:case"end":return e.stop()}}),e,this,[[38,51,54,57]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOkModal",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleOkModal_",this),console.log("handleOkModal__",this.state),t=this.state.options,console.log("handleOkModal",t),c=!1,"keyElement"==this.state.currentElementType?(null==this.state.modalValue||""==this.state.modalValue?n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated):(n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),a=this.state.modalValue.recid,r=this.state.modalValue),s=null!=this.state.currentElement.ke_node&&""!=this.state.currentElement.ke_node?this.state.currentElement.ke_node:null,u=this.state.currentElement.numberke,l=this.state.currentElement.recid,o=null!=s?"#4bf1547d":"#ebf5ff",i=null!=s?"#027707":"#007eff",c=!0):"numberkeConfirm"==this.state.currentElementType?(console.log(this.state),null!=this.state.modalValue&&""!=this.state.modalValue||(n="".concat(this.state.currentElement)),u=this.state.currentElement,c=!0):(null==this.state.modalValue||""==this.state.modalValue?n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated):(n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),a=this.state.modalValue.recid,r=this.state.modalValue),u=this.state.currentElement.unique_number,s=this.state.currentElement.recid,l=this.state.currentElement.recid,o="#4bf1547d",i="#027707"),console.log("handleOkModal2",t),t.push({value:"".concat(this.state.currentElement.recid),label:n,position:a,positionObj:r,number:l,numberValue:u,backgroundColor:o,color:i,node:s,nodeObj:this.state.currentElement,isKeyElement:c}),console.log("handleOkModal3",t),this.setState({options:t,showModal:!1,isLoadingDetail:!1,modalValue:""}),console.log("handleOkModal4",t),d=t.map((function(e){return{number:e.number,position:e.position,numberValue:e.numberValue}})),this.props.setFieldValue(this.props.field.name,JSON.stringify(d)),e.next=15,this.updateStateTable("add");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,console.log("getAssemblyElementPattern",a.length),e.abrupt("return",a.length>0?a[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllNodePositions();case 2:if(a=e.sent,console.log("this_update_state_table",this),null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),r=this.props.refComponentDataGrid.getStateTableData()),s=null,l=null,o=null,null!=n?l=n:(console.log("add",this.state.options.length),"add"==t?l=this.state.options[this.state.options.length-1]:"delete"==t&&(l=this.state.itemForDelete)),null!=l){e.next=11;break}return e.abrupt("return");case 11:if(i=null,c=null,null==this.props.activeRecord.reestr_ke_node_type){e.next=21;break}return e.next=16,this.getAssemblyElementPattern(this.props.activeRecord.reestr_ke_node_type.toString());case 16:if(null!=(u=e.sent)&&null!=u.ke_node_type&&null!=u.documentation){e.next=19;break}return e.abrupt("return");case 19:i=u.ke_node_type,c=u.documentation;case 21:if(null!=(s=l.isKeyElement?null!=l.node?r.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==l.positionObj.child_node_type})):r.find((function(e){return null!=e.keyElementTypeId&&e.keyElementTypeId==l.nodeObj.key_element_code})):r.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==l.nodeObj.ke_node_type})))){e.next=24;break}return e.abrupt("return");case 24:if("delete"!=t||0!=s.usedPositionsCount){e.next=26;break}return e.abrupt("return");case 26:if(null==s.assemblyElementTypeId){e.next=32;break}return e.next=29,this.getAvailablePositionsByAssemblyElementOnAssemblyElement(i,s.assemblyElementTypeId,c,a);case 29:o=e.sent,e.next=36;break;case 32:if(null==s.keyElementTypeId){e.next=36;break}return e.next=35,this.getAvailablePositionsByKeyElementOnAssemblyElement(i,s.keyElementTypeId);case 35:o=e.sent;case 36:d=r.indexOf(s),"add"==t?s.usedPositionsCount=s.usedPositionsCount+1:"delete"==t&&(s.usedPositionsCount=s.usedPositionsCount-1),s.isFull=s.usedPositionsCount===s.positionsCount,s.assemblyElementCountStr=s.usedPositionsCount+" \u0438\u0437 "+s.positionsCount,null!=o&&o.length>0?(h=o.map((function(e){return e.recname})),m=h.join(", ")):m=null,s.assemblyElementAvailablePositions=m,r[d]=s,null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),r=this.props.refComponentDataGrid.setStateTableData(r));case 44:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(n,")").concat(a));case 3:if(r=e.sent,s=r.value,console.log("allPositionsResp",s.length),null!=s||0!=s.length){e.next=8;break}return e.abrupt("return",null);case 8:for(l=[],o=[],null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),i=this.props.refComponentDataGrid.state.childKeyElements),console.log("installedKeyElements",this.state),c=0;c<i.length;c++)null!=i[c].position_on_node&&l.push(i[c].position_on_node);if(console.log("installedKeyElements",this.state.options),this.state.options.length>0)for(c=0;c<this.state.options.length;c++)l.push(this.state.options[c].position);return(o=l.length>0?s.filter((function(e){return null==l.find((function(t){return t==e.recid}))})):s).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(a,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:l=e.sent,o=l.value[0],s=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(s));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(K.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=r.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(console.log("allPositionsOnNode",u.length),null!=u||0!=u.length){e.next=19;break}return e.abrupt("return",null);case 19:for(null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),y=this.props.refComponentDataGrid.state.childAssemblyElements),console.log("alreadyInstalledNodes",y.length),g=0;g<y.length;g++)null!=(k=y[g]).position_on_assembly_element&&d.push(k.position_on_assembly_element);if(console.log("athis.state.optionsaa",this.state.options),this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(v=this.state.options[g]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n&&d.push(v.positionObj.node_position):null!=v.position&&n==v.nodeObj.ke_node_type&&d.push(v.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"checkAssemblyElementCompositionAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a){var r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=9;break}return e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(a,") and (child_assembly_element eq ").concat(n.ke_node_type,")"));case 3:if(r=e.sent,null!=(s=r.value)&&0!=s.length){e.next=7;break}return e.abrupt("return",{success:!1,message:"\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 "+n.unique_number+" ("+n.ke_node_type_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430."});case 7:e.next=15;break;case 9:return e.next=11,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(a,") and (child_key_element eq ").concat(t.key_element_code,")"));case 11:if(r=e.sent,null!=(s=r.value)&&0!=s.length){e.next=15;break}return e.abrupt("return",{success:!1,message:"\u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c "+t.numberke+" ("+t.key_element_code_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430."});case 15:return e.abrupt("return",{success:!0,message:null});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getOptions",value:function(){var e=this;this.setState({isLoading:!0}),fetch("/odata/$metadata/".concat(this.props.field.relation.table),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){var n=t.fieldGroups.autoLookup.fields.map((function(e){return e.name.toLowerCase()})),a=e.props.field.relation,r=a.field,s=a.displayField;null==r&&(r="recid"),null==s&&(s="recname"),null==n.find((function(e){return e==s.toLowerCase()}))&&n.push(s.toLowerCase());var l="",o=!1;if(null!=e.props.field.lookup){var i=e.props.field.lookup.field,c=e.props.activeRecord[i];l="$filter=(".concat(i," eq '").concat(c,"')"),-1==n.findIndex((function(e){return e==i}))&&(n.push(i),o=!0)}fetch("/odata/".concat(e.props.field.relation.table,"?").concat(l,"&$select=").concat(n.join(",")),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){o&&(n=n.filter((function(t){return t!=e.props.field.lookup.field}))),-1==t.value.findIndex((function(t){return t.recid==e.props.value}))&&e.props.setFieldValue(e.props.field.name,null);var a=t.value.map((function(e){return{id:e[r.toLowerCase()],value:n.filter((function(e){return"recid"!=e})).map((function(t){return e[t]})).join(", ")}})).sort((function(e,t){return e.value<t.value?-1:e.value>t.value?1:0}));e.setState({options:a,isLoading:!1,isLoadingDetail:!1})}))}))}},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(C.a)(this.state.options),-1!==(a=n.indexOf(t))&&(n.splice(a,1),this.setState({options:n}),this.props.setFieldValue(this.props.field.name,JSON.stringify(n))),this.setState({showDeleteModal:!1}),r=Object(C.a)(this.state.addedItems),s=r.find((function(e){return e==t.numberValue})),-1!==(l=r.indexOf(s))&&(r.splice(l,1),this.setState({addedItems:r})),!(o=this.state.itemForDelete).isKeyElement||"e4ef0365-0365-40df-ab4e-a77104c352df"!=o.nodeObj.key_element_code){e.next=24;break}if(null==this.props.refComponentDataGrid){e.next=15;break}if(console.log("refComponentDataGrid",this.props.refComponentDataGrid),null!=(i=this.props.refComponentDataGrid.getStateTableData(i))||0!=i.length){e.next=15;break}return e.abrupt("return");case 15:if(null==i.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=24;break}if(!o.nodeObj.has_rough_axis_number||null==o.nodeObj.rough_axis||""==o.nodeObj.rough_axis){e.next=24;break}return e.next=20,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(o.nodeObj.rough_axis,")"));case 20:if(null==(c=e.sent)){e.next=24;break}return e.next=24,this.updateStateTable("delete",{value:c.recid,number:c.recid,numberValue:c.numberke,node:null,nodeObj:c,isKeyElement:!0});case 24:return e.next=26,this.updateStateTable("delete");case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return a.createElement(W.a,{isOpen:this.state.showDeleteModal,size:"xl"},a.createElement(H.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),a.createElement(Z.a,null,a.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),a.createElement(Y.a,null,a.createElement(b.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),a.createElement(b.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},a.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;console.log("render_creatable",this.props);return a.createElement(k.a,null,a.createElement(v.a,null,a.createElement("b",null,this.props.field.displayName)),a.createElement(J.a,{ref:function(t){e.refInput=t},name:this.props.field.name,components:{MultiValue:function(t){var n={backgroundColor:t.data.backgroundColor,color:t.data.color};return a.createElement("div",{className:"SelectValue",style:n},a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t.data)}},"\xd7"),a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.options,isMulti:!0,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.props.field.isDisabled||this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}),a.createElement(W.a,{isOpen:this.state.showModal,toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},a.createElement(H.a,{toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),a.createElement(Z.a,null,a.createElement(f.a,null,a.createElement(b.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal,style:{width:"124px",height:"32px"}},a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",a.createElement(b.a,{size:"sm",onClick:function(){return e.setState({showModal:!1,modalItems:[],isLoadingDetail:!1})},style:{width:"103.63px",height:"32px"}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),a.createElement("hr",null),a.createElement(v.a,null,"\u041d\u043e\u043c\u0435\u0440"),a.createElement(E.a,{id:"number",value:"keyElement"==this.state.currentElementType?this.state.currentElement.ke_number_calculated:this.state.currentElement.unique_number,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),a.createElement(E.a,{id:"element_name",value:"keyElement"==this.state.currentElementType?this.state.currentElement.key_element_code_calculated:this.state.currentElement.ke_node_type_calculated,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),a.createElement(j.a,{name:"testname",options:this.state.modalItems,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",getOptionLabel:function(e){return e.recname},getOptionValue:function(e){return e.recid},onChange:this.handleModalChange,value:this.state.modalValue,onValueClick:function(e){return T(!0,e.value)},styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}))),this.renderDeleteConfirm())}}]),n}(a.Component)),jt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).onCellPrepared=function(e){console.log(e.data),"data"===e.rowType&&null!=e.data&&(e.cellElement.style.backgroundColor=e.data.positionsCount==e.data.usedPositionsCount?"rgb(91, 223, 127)":"rgb(222, 91, 91)")},a.state={options:[],selectedRowNotes:"",data:[],uin:"",elements_in_vagon:{},select_element:{},is_circ:!1,visible_alert:!1,name_old_element:"",name_new_element:null,elementType:"",assemblyElementPatternId:null,stateTableLoaded:!1,stateTableLoading:!1,childKeyElements:[],childAssemblyElements:[]},a.loadStateTable=a.loadStateTable.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount",this.props),console.log("this_componentDidMount",this),e.next=4,this.loadStateTable();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("componentDidUpdate",this),this.props.ref=this,this.state.assemblyElementPatternId==this.props.activeRecord.reestr_ke_node_type.toString()){e.next=11;break}if(this.state.stateTableLoaded||this.state.stateTableLoading||null==this.props.activeRecord.reestr_ke_node_type.toString()){e.next=7;break}return e.next=6,this.loadStateTable();case 6:return e.abrupt("return");case 7:if(!this.state.stateTableLoaded||this.state.stateTableLoading||this.state.assemblyElementPatternId!=this.props.activeRecord.reestr_ke_node_type.toString()==null){e.next=11;break}return e.next=10,this.loadStateTable();case 10:return e.abrupt("return");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v,E,O;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadStateTable",this.props),this.setState({stateTableLoading:!0}),this.props.updateStateTableLoading(!0),t="assemblyElement",this.setState({elementType:t}),e.next=7,this.getAllKeyElementTypes();case 7:return n=e.sent,e.next=10,this.getAllAssemblyElementTypes();case 10:return a=e.sent,e.next=13,this.getAllNodePositions();case 13:if(r=e.sent,s=[],"assemblyElement"!=t){e.next=81;break}return l=null,o=null,e.next=20,this.getAssemblyElementPattern(this.props.activeRecord.reestr_ke_node_type.toString());case 20:if(i=e.sent,console.log("assemblyElementPattern",i),this.setState({assemblyElementPatternId:i.recid}),null!=i&&null!=i.ke_node_type&&null!=i.documentation){e.next=29;break}return this.setState({stateTableLoading:!1,stateTableLoaded:!0}),this.props.updateStateTableLoading(!1),this.props.updateStateTableLoaded(!0),this.setStateTableData([]),e.abrupt("return");case 29:if(l=i.ke_node_type,o=i.documentation,null==l){e.next=81;break}return console.log("parentAssemblyElementTypeId",[l,o]),e.next=35,this.getAssemblyElementComposition(l,o);case 35:if(c=e.sent,console.log("assemblyElementComposition",c),console.log("assemblyElementComposition",c.length),0==c.length){e.next=81;break}return e.next=41,this.getChildKeyElementsByAssemblyElement(this.props.activeRecord.recid);case 41:return u=e.sent,e.next=44,this.getChildAssemblyElementsByAssemblyElement(this.props.activeRecord.recid);case 44:d=e.sent,this.state.childKeyElements=u,this.state.childAssemblyElements=d,m=0;case 48:if(!(m<c.length)){e.next=81;break}if(console.log("assemblyElementComposition2",c),console.log("assemblyElementComposition2",c.length),h=c[m],f=null!=h.child_key_element,b=null!=h.child_assembly_element,!f){e.next=65;break}return t=n.find((function(e){return e.recid==h.child_key_element})),_=t.recname,y=u.filter((function(e){return e.key_element_code==h.child_key_element})),e.next=60,this.getAvailablePositionsByKeyElementOnAssemblyElement(l,h.child_key_element);case 60:g=e.sent,v=h.child_key_element,E=null,e.next=74;break;case 65:if(!b){e.next=74;break}return t=a.find((function(e){return e.recid==h.child_assembly_element})),_=t.recname,y=d.filter((function(e){return e.ke_node_type==h.child_assembly_element})),e.next=71,this.getAvailablePositionsByAssemblyElementOnAssemblyElement(l,h.child_assembly_element,o,r);case 71:g=e.sent,v=null,E=h.child_assembly_element;case 74:console.log("availablePositions",g.length),console.log("childElements",y.length),null!=g&&g.length>0?(O=g.map((function(e){return e.recname})),k=O.join(", ")):k=null,h.count&&h.count>0&&(s.push({keyElementTypeId:v,assemblyElementTypeId:E,positionsCount:h.count,usedPositionsCount:y.length,isFull:h.count===y.length,number:m+1,assemblyElementName:_,assemblyElementCountStr:y.length+" \u0438\u0437 "+h.count,assemblyElementAvailablePositions:k}),this.setStateTableData(s));case 78:m++,e.next=48;break;case 81:null!=s&&s.length>0?(this.setState({stateTableLoaded:!0}),this.props.updateStateTableLoaded(!0)):(this.setStateTableData([]),this.setState({stateTableLoaded:!1}),this.props.updateStateTableLoaded(!1)),this.setState({stateTableLoading:!1}),this.props.updateStateTableLoading(!1);case 84:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllKeyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_key_elements_codes?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllAssemblyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a.length>0?a[0]:null);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChildAssemblyElementsByAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAssemblyElementComposition",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(t,") and (documentation_number eq ").concat(n,")"));case 2:return a=e.sent,r=a.value,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getChildKeyElementsByAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_node eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(n,")").concat(a));case 3:if(r=e.sent,s=r.value,console.log("allPositions",s),null!=s||0!=s.length){e.next=8;break}return e.abrupt("return",null);case 8:for(l=[],o=[],console.log("allPositions2",s),i=this.state.childKeyElements,console.log("installedKeyElements",i),c=0;c<i.length;c++)null!=i[c].position_on_node&&l.push(i[c].position_on_node);if(this.state.options.length>0)for(c=0;c<this.state.options.length;c++)l.push(this.state.options[c].position);return(o=l.length>0?s.filter((function(e){return null==l.find((function(t){return t==e.recid}))})):s).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(a,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:l=e.sent,o=l.value[0],s=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(s));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(K.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=r.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(null!=u||0!=u.length){e.next=18;break}return e.abrupt("return",null);case 18:for(y=this.state.childAssemblyElements,g=0;g<y.length;g++)null!=(k=y[g]).position_on_assembly_element&&d.push(k.position_on_assembly_element);if(this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(v=this.state.options[g]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n&&d.push(v.positionObj.node_position):null!=v.position&&n==v.nodeObj.ke_node_type&&d.push(v.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){(console.log("setStateTableData",e),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance)&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(console.log("getStateTableData"),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"render",value:function(){return r.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},r.a.createElement(y.a,{md:"auto"},r.a.createElement(te.a,{preloadEnabled:!1,name:this.props.field.name,selection:{mode:"single"},showBorders:!0,showColumnLines:!1,showRowLines:!0,hoverStateEnabled:!0,columnAutoWidth:!0,onCellPrepared:this.onCellPrepared,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},r.a.createElement(ee.Column,{width:"3%",dataField:"number",caption:"#",dataType:"number"}),r.a.createElement(ee.Column,{width:"30%",dataField:"assemblyElementName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",dataType:"string"}),r.a.createElement(ee.Column,{width:"10%",dataField:"assemblyElementCountStr",caption:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"assemblyElementAvailablePositions",caption:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",dataType:"string"})),r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ne.a,{color:"success",isOpen:this.state.visible_alert},r.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),this.state.selectedRowNotes))))}},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,s,l,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedRowsData,"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0435\u0437 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445"!=(a=n[0]).nameke&&"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430"!=a.nameke&&"\u0422\u0435\u043b\u0435\u0436\u043a\u0430"!=a.nameke||(this.setState({is_circ:!0}),a.is_circ=!0),null==this.props.values.select_field.key_element_code){e.next=12;break}if(null==this.props.values.select_field.ke_node){e.next=11;break}return e.next=7,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.ke_node,")"));case 7:l=e.sent,s=r.a.createElement("b",null,l.value[0].ke_node_type_calculated," ",l.value[0].unique_number),e.next=12;break;case 11:s=r.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke);case 12:if(null==this.props.values.select_field.ke_node_type){e.next=21;break}if(null==this.props.values.select_field.parent_ke_node){e.next=20;break}return e.next=16,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.parent_ke_node,")"));case 16:o=e.sent,s=r.a.createElement("b",null,o.value[0].ke_node_type_calculated," ",o.value[0].unique_number),e.next=21;break;case 20:s=r.a.createElement("b",null,this.props.values.select_field.ke_node_type_calculated," ",this.props.values.select_field.unique_number);case 21:i=r.a.createElement("p",null,"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435 ",this.props.activeRecord.manufacturer_number," ",r.a.createElement("b",null,a.nameke," ",a.numberke)," \u043d\u0430 ",s),this.setState({visible_alert:!0,select_element:a,selectedRowNotes:i}),this.props.setFieldValue(this.props.field,a);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(a.Component),At=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component),Nt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){a.setState({value:e})},a.state={value:""},a}return Object(i.a)(n,[{key:"render",value:function(){var e=this;return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},r.a.createElement(W.a,{isOpen:this.props.field.showModal,toggle:function(){return e.props.setFalseModalState()}},r.a.createElement(H.a,{toggle:function(){return e.props.setFalseModalState()}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),r.a.createElement(Z.a,null,r.a.createElement(f.a,null,r.a.createElement(b.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sm",onClick:function(){return e.props.setFalseModalState()}},r.a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),r.a.createElement("hr",null),r.a.createElement(v.a,null,"\u041d\u043e\u043c\u0435\u0440"),r.a.createElement(E.a,{id:"number",value:null!=this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1]?this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1].label:"",readOnly:!0}),r.a.createElement("br",null),r.a.createElement(v.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),r.a.createElement(E.a,{id:"element_name",value:null!=this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1]?this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1].title:"",readOnly:!0}),r.a.createElement("br",null),r.a.createElement(v.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),console.log(this.props.field.positions.map((function(e){return{value:e,label:e.toString()}}))),r.a.createElement(j.a,{name:"testname",options:null!=this.props.field.positions?this.props.field.positions.map((function(e){return{value:e,label:e.toString()}})):null,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.value,onValueClick:function(t){return e.popupNotifyMessage(!0,t.value)}})))}}]),n}(a.Component),Rt=(a.Component,function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:{},processingAction:!1},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){if("edit"==window.rdev_modalDataPack.place)this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords});else if(window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent){var e={recid:window.rdev_modalDataPack.selectedRecords[0].recid._value,reestr_ke_node_type:window.rdev_modalDataPack.selectedRecords[0].reestr_ke_node_type._value,assembly_element_type:window.rdev_modalDataPack.selectedRecords[0].assembly_element_type._value};this.setState({activeRecord:e})}this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place})}},{key:"render",value:function(){return r.a.createElement(Tt,{method:{name:"test_procedure_update",displayName:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",isEnabled:null,isAnonymous:!1,static:!1,fields:[{name:"sysstring_field",type:"SysString",typeName:"SysString",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"sysint_field",type:"SysInt",typeName:"SysInt",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"checkbox_field",type:"SysBoolean",typeName:"SysBoolean",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"creatable_field",type:"SysString",typeName:"SysString",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:!0,default:null,lookup:null,searchLevel:null}],showModalYesNo:null,initMethodParams:null,isPacketSigned:null,workflow:null,table:"types_table"},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord})}}]),n}(a.Component)),Tt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateGroupingElements=function(t){e.state.uin_grouping_elements.length<t.length&&e.setState({show_modal:!0}),e.setState({uin_grouping_elements:t})},e.updateStateTableLoaded=function(t){e.setState({stateTableLoaded:t})},e.updateStateTableLoading=function(t){e.setState({stateTableLoading:t})},e.setFalseModalState=function(){e.setState({show_modal:!1}),e.state.uin_grouping_elements.pop()},e.state={uin_grouping_elements:[],show_modal:!1,select_template_plate_field:null,select_template_insert_field:null,select_template_ring_field:null,select_application_number_field:null,isActionError:!1,successMessage:"",stateTableLoaded:!1,stateTableLoading:!1},e.updateGroupingElements=e.updateGroupingElements.bind(Object(h.a)(e)),e.setFalseModalState=e.setFalseModalState.bind(Object(h.a)(e)),e.dataGrid={},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.updateStateTableLoaded=e.updateStateTableLoaded.bind(Object(h.a)(e)),e.updateStateTableLoading=e.updateStateTableLoading.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"componentDidUpdate",value:function(){var e=this;console.log("componentDidUpdate setvalue",void 0!=this.uinElementsField&&null!=this.uinElementsField,this.uinElementsField),void 0!=this.uinElementsField&&null!=this.uinElementsField&&setTimeout((function(){e.uinElementsField.focus()}),1)}},{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mem"),this.setState({processingAction:!0}),this.refs.formik.state.values,console.log("this",this),console.log("vals",this.refs.formik.state.values),console.log("records",this.props.activeRecord),t="",(this.isNullObject(this.refs.formik.state.values.uin_elements_field)||"[]"===this.refs.formik.state.values.uin_elements_field||"[{}]"===this.refs.formik.state.values.uin_elements_field)&&(t=String().concat(t,'\u041f\u043e\u043b\u0435 "'.concat("62b3559e-10da-4189-8b25-d558ba451ac8"===this.props.activeRecord.assembly_element_type?"\u0423\u0418\u041d \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0432 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0443\u044e \u0435\u0434\u0438\u043d\u0438\u0446\u0443":"\u0423\u0418\u041d \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0432 \u0443\u0437\u0435\u043b",'" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e.'))),!this.isNotEmptyString(t)){e.next=13;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,t));case 13:return n=this.refs.formik.state.values.uin_elements_field,a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({recid:this.props.activeRecord.recid,reestr_ke_node_type:this.props.activeRecord.reestr_ke_node_type,ke_numbers:n})},console.log("requestBody",a),e.next=18,D("/plugins/nbdlogicplugin/addketoassemblyunit/"+this.props.activeRecord.recid,a.body);case 18:if(r=e.sent,console.log("result_addketoassemblyunit_resp",r),!r.success){e.next=26;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(r.message)));case 26:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(r.message)));case 28:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0421\u0427"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"uin_elements_field",name:"uin_elements_field"},(function(){return r.a.createElement(Ct,{setFieldValue:t.setFieldValue,updateGroupingElements:e.updateGroupingElements,refComponentDataGrid:e.dataGrid,activeRecord:e.props.activeRecord,ref:function(t){e.uinElementsField=t},field:{name:"uin_elements_field",displayName:"62b3559e-10da-4189-8b25-d558ba451ac8"===e.props.activeRecord.assembly_element_type?"\u0423\u0418\u041d \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0432 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0443\u044e \u0435\u0434\u0438\u043d\u0438\u0446\u0443":"\u0423\u0418\u041d \u0434\u043b\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0432 \u0443\u0437\u0435\u043b",isUinElementsField:!0,isDisabled:!e.state.stateTableLoaded||e.state.stateTableLoading,autoFocus:!0}})})),r.a.createElement(g.a,{key:"data_grid",name:"data_grid"},(function(n){var a=n.formikfield;n.form;return r.a.createElement(jt,Object.assign({value:e.props,field:{name:"data_grid",data:e.props.activeRecord.recid},setFieldValue:t.setFieldValue,updateStateTableLoaded:e.updateStateTableLoaded,updateStateTableLoading:e.updateStateTableLoading,activeRecord:e.props.activeRecord,ref:function(t){return e.dataGrid=t}},t,a))})),r.a.createElement(g.a,{key:"modal_select_poition",name:"modal_select_poition"},(function(){return r.a.createElement(Nt,{setFieldValue:t.setFieldValue,setFalseModalState:e.setFalseModalState,field:{name:"modal_select_poition",displayName:"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",showModal:e.state.show_modal,uinGroupingElements:e.state.uin_grouping_elements,positions:wt[1].available_positions}})})))}}),r.a.createElement(At,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}}]),n}(r.a.Component),Dt=(n(1150),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component)),qt=(n(1151),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e,"options",a.state.options),null!=e&&e.length>a.state.options.length&&a.handleNewOptionClick(e[e.length-1]),a.props.setFieldValue(a.props.field.name,JSON.stringify(e))},a.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),n=X(t.value),a.setState({isLoadingDetail:!0}),e.next=5,a.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(n,"')"));case 5:if(r=e.sent,!a.isNullOrEmptyResponse(r)){e.next=8;break}return e.abrupt("return",a.modalError("\u0423\u0418\u041d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435"));case 8:return s=r.value[0],e.next=11,a.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(s.recid,")"));case 11:return l=e.sent,e.next=14,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(s.recid,")"));case 14:if(o=e.sent,!a.isNullOrEmptyResponse(o)||!a.isNullOrEmptyResponse(l)){e.next=17;break}return e.abrupt("return",a.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 17:if((i=a.state.addedItems).push(n),!(null!=a.state.options&&a.state.options.length>0)){e.next=25;break}if(c=Object(C.a)(a.state.options),console.log("options",c),null==c.find((function(e){return e.numberValue==n}))){e.next=25;break}return e.abrupt("return",a.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 25:if(a.isNullOrEmptyResponse(l)||!a.isNullOrEmptyResponse(o)){e.next=32;break}return u=l.value[0],e.next=29,a.validateKeyElementForBatch(u);case 29:a.setState({addedItems:i}),e.next=37;break;case 32:if(a.isNullOrEmptyResponse(o)){e.next=37;break}return d=o.value[0],e.next=36,a.validateAssemblyUnitForBatch(d);case 36:a.setState({addedItems:i});case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.prepareValue=function(){return a.props.value instanceof Array?a.props.value[0]:a.props.value},a.state={options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null},a.handleNewOptionClick=a.handleNewOptionClick.bind(Object(h.a)(a)),a.handleModalChange=a.handleModalChange.bind(Object(h.a)(a)),a.renderDeleteConfirm=a.renderDeleteConfirm.bind(Object(h.a)(a)),a.handleOkModal=a.handleOkModal.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&T(!1,e)}},{key:"findParentAssemblyUnit",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=9;break}return e.next=3,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes(".concat(n.ke_node,")"));case 3:if(null!=(a=e.sent)){e.next=8;break}return e.abrupt("return",{success:!1,message:"\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435.",data:null});case 8:return e.abrupt("return",this.findParentAssemblyUnit(a,null));case 9:if(null==t){e.next=22;break}if(null==t.parent_ke_node){e.next=21;break}return e.next=13,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes(".concat(t.parent_ke_node,")"));case 13:if(null!=(a=e.sent)){e.next=18;break}return e.abrupt("return",{success:!1,message:"\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435.",data:null});case 18:return e.abrupt("return",this.findParentAssemblyUnit(a,null));case 19:e.next=22;break;case 21:return e.abrupt("return",{success:!0,message:"",data:t});case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMemberByUser",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=localStorage.getItem("groups"))){e.next=3;break}return e.abrupt("return",this.modalError("\u0412 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043e\u0442\u0441\u0443\u0441\u0442\u0432\u0443\u044e\u0442 \u0433\u0440\u0443\u043f\u043f\u044b."));case 3:n=JSON.parse(t),a=0;case 5:if(!(a<n.length)){e.next=14;break}return e.next=8,this.sendAuthorizedRequestAsync("/odata/reestr_members?$filter=(authgroup eq ".concat(n[a],")"));case 8:if(r=e.sent,this.isNullOrEmptyResponse(r)){e.next=11;break}return e.abrupt("return",r.value[0]);case 11:a++,e.next=5;break;case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateAssemblyUnitForBatch",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=80,r=1,e.next=4,this.sendAuthorizedRequestAsync("/odata/reestr_batch(".concat(this.props.activeRecord.recid,")"));case 4:if(!(null!=(s=e.sent).is_assembly_unit_or_key_element&&1==s.is_assembly_unit_or_key_element||this.state.options.length>0&&"undefined"!==this.state.options[0].isKeyElement&&this.state.options[0].isKeyElement)){e.next=7;break}return e.abrupt("return",this.modalError("\u0412 \u0434\u0430\u043d\u043d\u0443\u044e \u043f\u0430\u0440\u0442\u0438\u044e \u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0421\u0427"));case 7:return e.next=9,this.findParentAssemblyUnit(t,n);case 9:if(!(l=e.sent).success){e.next=14;break}t=l.data,e.next=15;break;case 14:return e.abrupt("return",this.modalError(l.message));case 15:if(console.log("assemblyUnit",t),null==t.batchid||t.batchid!=this.props.activeRecord.recid){e.next=18;break}return e.abrupt("return",this.modalError('\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0431\u044b\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0440\u0430\u043d\u0435\u0435.")));case 18:return e.next=20,this.getMemberByUser();case 20:if(o=e.sent,null==t.batchid||""==t.batchid){e.next=34;break}return e.next=24,this.sendAuthorizedRequestAsync("/odata/reestr_batch?$filter=(recid eq ".concat(t.batchid,")"));case 24:if(i=e.sent,!this.isNullOrEmptyResponse(i)){e.next=27;break}return e.abrupt("return",this.modalError("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0438 \u043f\u0430\u0440\u0442\u0438\u0438 \u0434\u043b\u044f \u0421\u0415 ".concat(t.unique_number,".")));case 27:if(o.recid!=i.value[0].recipient_droplist){e.next=32;break}if("ef519ef4-ec73-4776-9295-2d007bb32907"==i.value[0].batch_status||"f7b21136-24a8-4ae5-af5b-3b7b3dd0c36b"==i.value[0].batch_status||1==t.change_node){e.next=30;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u0443\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e, \u043f\u043e\u043a\u0430 \u043f\u0430\u0440\u0442\u0438\u044f <a href="/tables/reestr_batch/'.concat(i.value[0].recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(i.value[0].batch_number,"</a> \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0435 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 - \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0430.")));case 30:e.next=34;break;case 32:if("281496a2-3d01-479e-80cb-96e6e6e76135"==i.value[0].batch_status||"f7b21136-24a8-4ae5-af5b-3b7b3dd0c36b"==i.value[0].batch_status||1==t.change_node){e.next=34;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u0443\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e, \u043f\u043e\u043a\u0430 \u043f\u0430\u0440\u0442\u0438\u044f <a href="/tables/reestr_batch/'.concat(i.value[0].recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(i.value[0].batch_number,"</a> \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0435 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 - \u041e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430 \u0438\u043b\u0438 \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0430 \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e.")));case 34:if(!(null!=this.state.options&&this.state.options.length>0)){e.next=39;break}if(c=Object(C.a)(this.state.options),null==c.find((function(e){return e.numberValue==t.unique_number}))){e.next=39;break}return e.abrupt("return",this.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 39:if(this.setState({currentElement:t,currentElementType:"assemblyElement"}),"823cc6e9-465b-416e-beda-8a642149c235"===t.status){e.next=42;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0415 <a href="/tables/reestr_ke_nodes/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.unique_number," </a > \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441\u0435.")));case 42:return e.next=44,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_node eq ".concat(t.recid," AND recstate eq 1 )"));case 44:return u=e.sent,this.isNullOrEmptyResponse(u)||(r+=u.value.length),e.next=48,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(t.recid," AND recstate eq 1)"));case 48:if(d=e.sent,this.isNullOrEmptyResponse(d)){e.next=60;break}r+=d.value.length,m=0;case 52:if(!(m<d.value.length)){e.next=60;break}return e.next=55,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(d.value[m].recid," AND recstate eq 1)"));case 55:h=e.sent,this.isNullOrEmptyResponse(h)||(r+=h.value.length);case 57:m++,e.next=52;break;case 60:if(console.log(r),console.log(this.state.scannedChildElements),!(this.props.activeRecord.count_passport+this.state.scannedChildElements+r>a)){e.next=64;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0415 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.unique_number,"</a >: \u043f\u0440\u0435\u0432\u044b\u0448\u0435\u043d \u043b\u0438\u043c\u0438\u0442 \u0432 \u043f\u0430\u0440\u0442\u0438\u0438.")));case 64:if(null==this.props.activeRecord.product_name||""==this.props.activeRecord.product_name){e.next=73;break}if(t.ke_node_type==this.props.activeRecord.product_name){e.next=67;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.unique_number,"</a >: \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 67:if(t.documentation_number==this.props.activeRecord.documentation_number){e.next=69;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.unique_number,"</a >: \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 69:if(t.certificate_number==this.props.activeRecord.certificate){e.next=71;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.unique_number,"</a >: \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 71:e.next=80;break;case 73:if(!(this.state.options.length>0)){e.next=80;break}if(t.ke_node_type==this.state.options[0].nodeObj.ke_node_type){e.next=76;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.unique_number,"</a >: \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 76:if(t.documentation_number==this.state.options[0].nodeObj.documentation_number){e.next=78;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.unique_number,"</a >: \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 78:if(t.certificate_number==this.state.options[0].nodeObj.certificate_number){e.next=80;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.unique_number,"</a >: \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 80:return this.state.scannedChildElements=r,this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 84:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"validateKeyElementForBatch",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=80,null==t.batchid||t.batchid!=this.props.activeRecord.recid){e.next=3;break}return e.abrupt("return",this.modalError('\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0431\u044b\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0440\u0430\u043d\u0435\u0435.")));case 3:return e.next=5,this.sendAuthorizedRequestAsync("/odata/reestr_batch(".concat(this.props.activeRecord.recid,")"));case 5:if(!(null!=(a=e.sent).is_assembly_unit_or_key_element&&2==a.is_assembly_unit_or_key_element||this.state.options.length>0&&"undefined"!==this.state.options[0].isKeyElement&&!this.state.options[0].isKeyElement)){e.next=8;break}return e.abrupt("return",this.modalError("\u0412 \u0434\u0430\u043d\u043d\u0443\u044e \u043f\u0430\u0440\u0442\u0438\u044e \u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0421\u0415"));case 8:if(!(this.props.activeRecord.count_passport+this.state.options.length>=n)){e.next=10;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke,"</a >: \u043f\u0440\u0435\u0432\u044b\u0448\u0435\u043d \u043b\u0438\u043c\u0438\u0442 \u0432 \u043f\u0430\u0440\u0442\u0438\u0438.")));case 10:return this.setState({currentElement:t,currentElementType:"keyElement"}),e.next=13,this.getMemberByUser();case 13:if(r=e.sent,null==t.batchid||""==t.batchid){e.next=27;break}return e.next=17,this.sendAuthorizedRequestAsync("/odata/reestr_batch?$filter=(recid eq ".concat(t.batchid,")"));case 17:if(s=e.sent,!this.isNullOrEmptyResponse(s)){e.next=20;break}return e.abrupt("return",this.modalError("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0438 \u043f\u0430\u0440\u0442\u0438\u0438 \u0434\u043b\u044f \u0421\u0427 ".concat(t.numberke,".")));case 20:if(r.recid!=s.value[0].recipient_droplist){e.next=25;break}if("ef519ef4-ec73-4776-9295-2d007bb32907"==s.value[0].batch_status||"f7b21136-24a8-4ae5-af5b-3b7b3dd0c36b"==s.value[0].batch_status||1==t.change_node){e.next=23;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u0443\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e, \u043f\u043e\u043a\u0430 \u043f\u0430\u0440\u0442\u0438\u044f <a href="/tables/reestr_batch/'.concat(s.value[0].recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(s.value[0].batch_number,"</a> \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0435 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 - \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0430.")));case 23:e.next=27;break;case 25:if("281496a2-3d01-479e-80cb-96e6e6e76135"==s.value[0].batch_status||"f7b21136-24a8-4ae5-af5b-3b7b3dd0c36b"==s.value[0].batch_status||1==t.change_node){e.next=27;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u0443\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e, \u043f\u043e\u043a\u0430 \u043f\u0430\u0440\u0442\u0438\u044f <a href="/tables/reestr_batch/'.concat(s.value[0].recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(s.value[0].batch_number,"</a> \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0435 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 - \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0430.")));case 27:if("c82c2eb8-0cf9-4693-8a2b-c6bf605c97ab"==t.statuske){e.next=29;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke," </a > \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441\u0435.")));case 29:if(null==t.ke_node||""==t.ke_node){e.next=31;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke," </a >, \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0439 \u0432 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0443\u044e \u0435\u0434\u0438\u043d\u0438\u0446\u0443.")));case 31:if(null==t.vehicle||""==t.vehicle){e.next=33;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke," </a >, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u043d\u0430 \u0422\u0421.")));case 33:if(null==this.props.activeRecord.product_name||""==this.props.activeRecord.product_name){e.next=42;break}if(t.key_element_code==this.props.activeRecord.product_name){e.next=36;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke,"</a >: \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 36:if(t.documentation_number==this.props.activeRecord.documentation_number){e.next=38;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke,"</a >: \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 38:if(t.certificate_number==this.props.activeRecord.certificate){e.next=40;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke,"</a >: \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 40:e.next=49;break;case 42:if(!(this.state.options.length>0)){e.next=49;break}if(t.key_element_code==this.state.options[0].nodeObj.key_element_code){e.next=45;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke,"</a >: \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 45:if(t.documentation_number==this.state.options[0].nodeObj.documentation_number){e.next=47;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke,"</a >: \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 47:if(t.certificate_number==this.state.options[0].nodeObj.certificate_number){e.next=49;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,'</a> \u0421\u0427 <a href="/tables/reestr_key_elements/').concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke,"</a >: \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 49:return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 52:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOkModal",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleOkModal_",this),console.log("handleOkModal__",this.state),t=this.state.options,console.log("handleOkModal",t),o=!1,"keyElement"==this.state.currentElementType?(null!=this.state.modalValue&&""!=this.state.modalValue||(n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated)),a=null!=this.state.currentElement.ke_node&&""!=this.state.currentElement.ke_node?this.state.currentElement.ke_node:null,i=this.state.currentElement.numberke,r=this.state.currentElement.recid,s=null!=a?"#4bf1547d":"#ebf5ff",l=null!=a?"#027707":"#007eff",o=!0):"numberkeConfirm"==this.state.currentElementType?(console.log(this.state),null!=this.state.modalValue&&""!=this.state.modalValue||(n="".concat(this.state.currentElement)),i=this.state.currentElement,o=!0):(null!=this.state.modalValue&&""!=this.state.modalValue||(n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated)),i=this.state.currentElement.unique_number,r=this.state.currentElement.recid,s="#4bf1547d",l="#027707"),console.log("handleOkModal2",t),t.push({label:n,number:r,numberValue:i,backgroundColor:s,color:l,nodeObj:this.state.currentElement,isKeyElement:o}),console.log("handleOkModal3",t),this.setState({options:t,showModal:!1,isLoadingDetail:!1,modalValue:""}),console.log("handleOkModal4",t),c=t.map((function(e){return{number:e.number,numberValue:e.numberValue}})),this.props.setFieldValue(this.props.field.name,JSON.stringify(c));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(C.a)(this.state.options),-1!==(a=n.indexOf(t))&&(n.splice(a,1),this.setState({options:n}),this.props.setFieldValue(this.props.field.name,JSON.stringify(n))),this.setState({showDeleteModal:!1}),r=Object(C.a)(this.state.addedItems),s=r.find((function(e){return e==t.numberValue})),-1!==(l=r.indexOf(s))&&(r.splice(l,1),this.setState({addedItems:r})),!(o=this.state.itemForDelete).isKeyElement||"e4ef0365-0365-40df-ab4e-a77104c352df"!=o.nodeObj.key_element_code){e.next=21;break}if(null==this.props.refComponentDataGrid){e.next=15;break}if(console.log("refComponentDataGrid",this.props.refComponentDataGrid),null!=(i=this.props.refComponentDataGrid.getStateTableData(i))||0!=i.length){e.next=15;break}return e.abrupt("return");case 15:if(null==i.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=21;break}if(!o.nodeObj.has_rough_axis_number||null==o.nodeObj.rough_axis||""==o.nodeObj.rough_axis){e.next=21;break}return e.next=20,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(o.nodeObj.rough_axis,")"));case 20:e.sent;case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return a.createElement(W.a,{isOpen:this.state.showDeleteModal,size:"xl"},a.createElement(H.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),a.createElement(Z.a,null,a.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),a.createElement(Y.a,null,a.createElement(b.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),a.createElement(b.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},a.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;console.log("render_creatable",this.props);return a.createElement(k.a,null,a.createElement(v.a,null,a.createElement("b",null,this.props.field.displayName)),a.createElement(J.a,{name:this.props.field.name,components:{MultiValue:function(t){console.log("multivalue",t);var n={backgroundColor:t.data.backgroundColor,color:t.data.color};return a.createElement("div",{className:"SelectValue",style:n},a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t.data)}},"\xd7"),a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.options,isMulti:!0,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.props.field.isDisabled||this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,autoFocus:this.props.field.autoFocus||!1,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}),a.createElement(W.a,{isOpen:this.state.showModal,toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},a.createElement(H.a,{toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),a.createElement(Z.a,null,a.createElement(f.a,null,a.createElement(b.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal,style:{width:"124px",height:"32px"}},a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",a.createElement(b.a,{size:"sm",onClick:function(){return e.setState({showModal:!1,modalItems:[],isLoadingDetail:!1})},style:{width:"103.63px",height:"32px"}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),a.createElement("hr",null),a.createElement(v.a,null,"\u041d\u043e\u043c\u0435\u0440"),a.createElement(E.a,{id:"number",value:"keyElement"==this.state.currentElementType?this.state.currentElement.ke_number_calculated:this.state.currentElement.unique_number,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),a.createElement(E.a,{id:"element_name",value:"keyElement"==this.state.currentElementType?this.state.currentElement.key_element_code_calculated:this.state.currentElement.ke_node_type_calculated,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),a.createElement(j.a,{name:"testname",options:this.state.modalItems,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",getOptionLabel:function(e){return e.recname},getOptionValue:function(e){return e.recid},onChange:this.handleModalChange,value:this.state.modalValue,onValueClick:function(e){return T(!0,e.value)},styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}))),this.renderDeleteConfirm())}}]),n}(a.Component)),Vt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,tableName:"",place:""},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){if(console.log("ddda",window.rdev_modalDataPack),"edit"==window.rdev_modalDataPack.place)this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords});else if(window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent){var e={recid:window.rdev_modalDataPack.selectedRecords[0].recid._value,product_name:null==window.rdev_modalDataPack.selectedRecords[0].product_name?null:window.rdev_modalDataPack.selectedRecords[0].product_name._value,batch_number:window.rdev_modalDataPack.selectedRecords[0].batch_number,documentation_number:null==window.rdev_modalDataPack.selectedRecords[0].documentation_number?null:window.rdev_modalDataPack.selectedRecords[0].documentation_number._value,certificate:null==window.rdev_modalDataPack.selectedRecords[0].certificate?null:window.rdev_modalDataPack.selectedRecords[0].certificate._value,count_passport:window.rdev_modalDataPack.selectedRecords[0].count_passport};this.setState({activeRecord:e})}this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place})}},{key:"render",value:function(){return r.a.createElement(Mt,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord,tableName:this.state.tableName})}}]),n}(a.Component),Mt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={processingAction:!1},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),t=this.refs.formik.state.values,n=[],console.log("this",this),console.log("vals",this.refs.formik.state.values),console.log("records",this.props.activeRecord),a="",this.isNullObject(t.uins_field)||"[]"===t.uins_field||"[{}]"===t.uins_field?a=String().concat(a,"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u044b \u0423\u0418\u041d \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0438."):(n=JSON.parse(this.refs.formik.state.values.uins_field),console.log("ke_numbers_arr",n),0==n.length&&(a=String().concat(a,"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u044b \u0423\u0418\u041d \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0438."))),!this.isNotEmptyString(a)){e.next=13;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,a));case 13:return r=(r=n.map((function(e){if(!o.isNullObject(e.number))return{number:e.number,numberValue:e.numberValue}}))).filter((function(e){return null!=e&&"undefined"!==e})),s={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({batch_recid:this.props.activeRecord.recid,element_numbers:r})},e.next=18,D("/plugins/nbdlogicplugin/addkeyelementlisttobatch",s.body);case 18:if(l=e.sent,console.log("result_addkeyelementstobatch_resp",l),!l.success){e.next=26;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(l.message)));case 26:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(l.message)));case 28:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"uins_field",name:"uins_field"},(function(){return r.a.createElement(qt,Object.assign({setFieldValue:t.setFieldValue,activeRecord:e.props.activeRecord,field:{name:"uins_field",displayName:"\u0423\u0418\u041d \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0438",autoFocus:!0}},t))})))}}),r.a.createElement(Dt,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}}]),n}(r.a.Component),Ft=(n(1152),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),R.a.success(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),R.a.error(r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:R.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(n,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return r.a.createElement(W.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},r.a.createElement(Z.a,null,r.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),r.a.createElement(ce.a,{animated:!0,value:"100"})))}}]),n}(a.Component)),Pt=(n(534),function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){if(console.log("date handleChange_input",e),null!=e.value){ve()().utcOffset();var t=ve()(e.value),n=new Date(Date.UTC(t.year(),t.month(),t.date()));console.log("handleChange_otput",n),a.setState({selectedValue:n}),a.props.setFieldValue(a.props.field.name,n)}else a.setState({selectedValue:null}),a.props.setFieldValue(a.props.field.name,e.value);a.props.setFieldTouched(a.props.field.name,!0),a.props.updateData(e.value,a.props.field.name)},a.getType=function(){return"SysTimeDate"===a.props.field.type?"datetime":"SysDate"===a.props.field.type?"date":"datetime"},a.state={selectedValue:new Date},a.handleChange=a.handleChange.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",elementAttr:{class:"rdev-read-only-control"}},r.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},r.a.createElement(v.a,null,r.a.createElement("b",null,this.props.field.displayName)),r.a.createElement(ge.DateBox,{className:"repairFormDateBox",width:"100%",type:"date",id:this.props.field,name:this.props.field.name,defaultValue:new Date,showClearButton:!0,useMaskBehavior:!0,displayFormat:"dd.MM.yyyy",onValueChanged:this.handleChange,value:this.state.selectedValue}))}}]),n}(a.Component)),It=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),null!=e&&e.length>a.state.options.length&&a.handleNewOptionClick(e[e.length-1]);var t=e.map((function(e){return{number:e.number,position:e.position}}));a.props.setFieldValue(a.props.field.name,JSON.stringify(t))},a.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),n=X(t.value),a.setState({isLoadingDetail:!0}),e.next=5,a.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(n,"')"));case 5:if(r=e.sent,!a.isNullOrEmptyResponse(r)){e.next=8;break}return e.abrupt("return",a.modalError("\u0423\u0418\u041d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435"));case 8:return s=r.value[0],e.next=11,a.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(s.recid,")"));case 11:return l=e.sent,e.next=14,a.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(s.recid,")"));case 14:if(o=e.sent,!a.isNullOrEmptyResponse(o)||!a.isNullOrEmptyResponse(l)){e.next=17;break}return e.abrupt("return",a.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 17:if((i=a.state.addedItems).push(n),!(null!=a.state.options&&a.state.options.length>0)){e.next=24;break}if(c=Object(C.a)(a.state.options),null==c.find((function(e){return e.numberValue==n}))){e.next=24;break}return e.abrupt("return",a.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 24:if(a.isNullOrEmptyResponse(l)||!a.isNullOrEmptyResponse(o)){e.next=31;break}return u=l.value[0],e.next=28,a.defineKeyElementPositions(u);case 28:a.setState({addedItems:i}),e.next=36;break;case 31:if(a.isNullOrEmptyResponse(o)){e.next=36;break}return d=o.value[0],e.next=35,a.defineAssemblyElementPositions(d);case 35:a.setState({addedItems:i});case 36:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.state={selectedTemplate:a.props.field.selectedTemplate,options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null},a.handleNewOptionClick=a.handleNewOptionClick.bind(Object(h.a)(a)),a.getOptions=a.getOptions.bind(Object(h.a)(a)),a.handleModalChange=a.handleModalChange.bind(Object(h.a)(a)),a.renderDeleteConfirm=a.renderDeleteConfirm.bind(Object(h.a)(a)),a.handleOkModal=a.handleOkModal.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"focus",value:function(){this.refInput.focus()}},{key:"componentWillReceiveProps",value:function(e){e.field.selectedTemplate!==this.state.selectedTemplate&&this.setState({selectedTemplate:e.field.selectedTemplate,options:[]})}},{key:"assemblyElementAlreadyExist",value:function(e,t){return 0==e.length||null==e.find((function(e){return null!=e.node&&null!=t&&e.node==t}))}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&T(!1,e)}},{key:"defineKeyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,a=null,r=null,s=null,null==t.ke_node||""==t.ke_node){e.next=18;break}return e.next=7,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.ke_node,")"));case 7:if(l=e.sent,!this.isNullOrEmptyResponse(l)){e.next=10;break}return e.abrupt("return");case 10:if(n=l.value[0],a=n.recid,r=n.ke_node_type,s=t.position_on_node,!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,a)){e.next=16;break}return e.abrupt("return",this.modalError("\u0423\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0444\u043e\u0440\u043c\u0443."));case 16:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o||null==s){e.next=18;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 18:return o=t.key_element_code,i=t.documentation_number_calculated,this.setState({currentElement:t,currentElementType:"keyElement"}),e.next=23,this.getMemberByUser();case 23:if(c=e.sent,null==t.batchid||""==t.batchid){e.next=37;break}return e.next=27,this.sendAuthorizedRequestAsync("/odata/reestr_batch?$filter=(recid eq ".concat(t.batchid,")"));case 27:if(u=e.sent,!this.isNullOrEmptyResponse(u)){e.next=30;break}return e.abrupt("return",this.modalError('\u0421\u0427 <a href="/tables/reestr_key_elements/'.concat(t.recid,'"" target="_blank" class="alert-link"> ').concat(t.numberke," </a > \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e.")));case 30:if(c.recid!=u.value[0].recipient_droplist){e.next=35;break}if("ef519ef4-ec73-4776-9295-2d007bb32907"==u.value[0].batch_status||"f7b21136-24a8-4ae5-af5b-3b7b3dd0c36b"==u.value[0].batch_status||1==t.change_node){e.next=33;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u0443\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e, \u043f\u043e\u043a\u0430 \u043f\u0430\u0440\u0442\u0438\u044f <a href="/tables/reestr_batch/'.concat(u.value[0].recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(u.value[0].batch_number,"</a> \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0435 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 - \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0430 \u0438\u043b\u0438 \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0430 \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e.")));case 33:e.next=37;break;case 35:if("281496a2-3d01-479e-80cb-96e6e6e76135"==u.value[0].batch_status||"f7b21136-24a8-4ae5-af5b-3b7b3dd0c36b"==u.value[0].batch_status||1==t.change_node){e.next=37;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u0443\u044e \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044e, \u043f\u043e\u043a\u0430 \u043f\u0430\u0440\u0442\u0438\u044f <a href="/tables/reestr_batch/'.concat(u.value[0].recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(u.value[0].batch_number,"</a> \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043d\u0435 \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 - \u041e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0430 \u0438\u043b\u0438 \u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0430 \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e.")));case 37:if(null==this.props.activeRecord.model_axes_calculated){e.next=64;break}return e.next=41,this.checkVagonCompositionByKeyElementAsync(t,n);case 41:if((d=e.sent).success){e.next=44;break}return e.abrupt("return",this.modalError(d.message));case 44:if("ad836d1b-6ecb-4dce-a508-8e9f42095ba3"!=o){e.next=48;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 48:return e.next=50,this.getAllPositionsOnVagonByKeyElementAsync(t.ke_node,t.key_element_code,s,this.props.activeRecord.model_axes_calculated);case 50:if(0!=(m=e.sent).length){e.next=53;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438."));case 53:return e.next=55,this.getFreePositionsOnVagonByKeyElementAsync(this.props.activeRecord.model_axes_calculated,o,i,a,r,m);case 55:if(0!=(h=e.sent).length){e.next=58;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438."));case 58:if(1!=h.length){e.next=62;break}return this.setState({modalItems:h,modalValue:m[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 62:h.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),this.setState({modalItems:h,modalValue:""});case 64:this.setState({showModal:!0});case 65:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"defineAssemblyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({currentElement:t,currentElementType:"assemblyElement"}),!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,t.recid)){e.next=3;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t.unique_number," \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0432 \u0444\u043e\u0440\u043c\u0443.")));case 3:return e.next=5,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types(".concat(t.ke_node_type,")"));case 5:if(n=e.sent,console.log("ddd",n),!n.is_variable){e.next=9;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0421\u0427."));case 9:if("a6180bfa-368d-4eff-97f2-c4f6c2612bc6"!=t.ke_node_type){e.next=13;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 13:if(null==this.props.activeRecord.model_axes_calculated){e.next=39;break}return e.next=16,this.checkVagonCompositionByAssemblyUnitAsync(t);case 16:if((a=e.sent).success){e.next=19;break}return e.abrupt("return",this.modalError(a.message));case 19:return e.next=21,this.getAllPositionsOnVagonByAssemblyElementAsync(this.props.activeRecord.model_axes_calculated,t);case 21:if(null!=(r=e.sent)){e.next=24;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438."));case 24:if(0!=r.length){e.next=26;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438."));case 26:return e.next=28,this.getFreePositionsOnVagonByAssemblyUnitAsync(this.props.activeRecord.model_axes_calculated,n,t,r);case 28:if(1!=(s=e.sent).length){e.next=33;break}return this.setState({modalItems:s,modalValue:s[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 33:if(s.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),0!=s.length){e.next=36;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415."));case 36:this.setState({modalItems:s,modalValue:""}),e.next=40;break;case 39:return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0432\u0430\u0433\u043e\u043d\u0430 \u043d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043e\u0441\u043d\u043e\u0441\u0442\u044c"));case 40:this.setState({showModal:!0});case 41:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkVagonCompositionByKeyElementAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_vagon_composition?$filter=(key_element_type eq ".concat(t.key_element_code,")"));case 2:if(a=e.sent,r=a.value,s=null,!(null!=r&&r.length>0)){e.next=33;break}if(null!=t.ke_node){e.next=17;break}l=0;case 8:if(!(l<r.length)){e.next=15;break}if(null!=r[l].assembly_element_type){e.next=12;break}return s=r[l],e.abrupt("break",15);case 12:l++,e.next=8;break;case 15:e.next=25;break;case 17:o=0;case 18:if(!(o<r.length)){e.next=25;break}if(n.ke_node_type!=r[o].assembly_element_type){e.next=22;break}return s=r[o],e.abrupt("break",25);case 22:o++,e.next=18;break;case 25:if(null!=s){e.next=31;break}if(null!=t.ke_node){e.next=30;break}return e.abrupt("return",{success:!1,message:"\u0421\u0427 "+t.numberke+" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0432\u0430\u0433\u043e\u043d\u0430."});case 30:return e.abrupt("return",{success:!1,message:"\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 "+n.unique_number+" ("+n.ke_node_type_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0432\u0430\u0433\u043e\u043d\u0430."});case 31:e.next=34;break;case 33:return e.abrupt("return",{success:!1,message:"\u0414\u043b\u044f \u0421\u0427 "+t.numberke+' \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b \u0437\u0430\u043f\u0438\u0441\u0438 \u0432 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0435 "\u0421\u043e\u0441\u0442\u0430\u0432 \u0432\u0430\u0433\u043e\u043d\u0430".'});case 34:return e.abrupt("return",{success:!0,message:null});case 35:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkVagonCompositionByAssemblyUnitAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_vagon_composition?$filter=(assembly_element_type eq ".concat(t.ke_node_type,")"));case 3:if(a=e.sent,!(null!=(r=a.value)&&r.length>0)){e.next=18;break}s=0;case 7:if(!(s<r.length)){e.next=14;break}if(t.ke_node_type!=r[s].assembly_element_type){e.next=11;break}return n=r[s],e.abrupt("break",14);case 11:s++,e.next=7;break;case 14:if(null!=n){e.next=16;break}return e.abrupt("return",{success:!1,message:"\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 "+t.unique_number+" ("+t.ke_node_type_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0432\u0430\u0433\u043e\u043d\u0430."});case 16:e.next=19;break;case 18:return e.abrupt("return",{success:!1,message:"\u0414\u043b\u044f \u0421\u0415 "+t.unique_number+' \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b \u0437\u0430\u043f\u0438\u0441\u0438 \u0432 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0435 "\u0421\u043e\u0441\u0442\u0430\u0432 \u0432\u0430\u0433\u043e\u043d\u0430".'});case 19:return e.abrupt("return",{success:!0,message:null});case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllPositionsOnVagonByKeyElementAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=0,l=null,o="",null==t){e.next=27;break}return e.next=6,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t,")"));case 6:if(i=e.sent,"cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=(l=i.value[0]).ke_node_type){e.next=27;break}return e.next=11,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(l.documentation_number,") and\n\t\t\t\t\t(ke_node_type eq ").concat(l.ke_node_type,")"));case 11:if(c=e.sent,u=c.value[0],s=u.slider_body_count>2&&u.slider_cap_count>2?6:4,"4"!=r||4!=s){e.next=18;break}o="and (for_four_axes_vagon eq true)",e.next=27;break;case 18:if("6"!=r||6!=s){e.next=22;break}o="and (for_six_axes_vagon eq true) and (position_node_on_vagon eq cf480ce8-e694-4945-a4ef-3d9a8f050ba9)",e.next=27;break;case 22:if("6"!=r||4!=s){e.next=26;break}o="and ((for_four_axes_vagon eq true) or (for_six_axes_vagon eq true)) and ((position_node_on_vagon eq a38b7c61-0bf9-485d-9282-eb5214548993) or (position_node_on_vagon eq b8676775-861b-44c6-ab56-25d109636620))",e.next=27;break;case 26:return e.abrupt("return",[]);case 27:return 0==s&&("4"==r?o="and (for_four_axes_vagon eq true)":"6"==r&&(o="and (for_six_axes_vagon eq true)")),e.next=30,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(key_element_code eq ".concat(n,") ").concat(o));case 30:return d=e.sent,m=d.value,h=[],h=null!=a?m.filter((function(e){return e.position_on_node==a})):m,e.abrupt("return",h);case 35:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"getAllPositionsOnVagonByAssemblyElementAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],r=0,"cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=n.ke_node_type){e.next=8;break}return e.next=5,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(n.documentation_number,") and\n\t\t\t\t(ke_node_type eq ").concat(n.ke_node_type,")"));case 5:s=e.sent,l=s.value[0],r=l.slider_body_count>2&&l.slider_cap_count>2?6:4;case 8:if(o="",0!=r){e.next=13;break}"4"==t?o="and (for_four_axes_vagon eq true)":"6"==t&&(o="and (for_six_axes_vagon eq true)"),e.next=26;break;case 13:if("4"!=t||4!=r){e.next=17;break}o="and (for_four_axes_vagon eq true)",e.next=26;break;case 17:if("6"!=t||6!=r){e.next=21;break}o="and (for_six_axes_vagon eq true) and (position_node_on_vagon eq cf480ce8-e694-4945-a4ef-3d9a8f050ba9)",e.next=26;break;case 21:if("6"!=t||4!=r){e.next=25;break}o="and ((for_four_axes_vagon eq true) or (for_six_axes_vagon eq true)) and ((position_node_on_vagon eq a38b7c61-0bf9-485d-9282-eb5214548993) or (position_node_on_vagon eq b8676775-861b-44c6-ab56-25d109636620))",e.next=26;break;case 25:return e.abrupt("return",[]);case 26:return e.next=28,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_node eq ".concat(n.recid,")"));case 28:if(i=e.sent,null!=(c=i.value)&&0!=c.length){e.next=59;break}return e.next=33,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(child_node_type eq ".concat(n.ke_node_type,") ").concat(o));case 33:if(u=e.sent,null!=(d=u.value)&&0!=d.length){e.next=37;break}return e.abrupt("return",null);case 37:m=Object(K.a)(d),e.prev=38,m.s();case 40:if((h=m.n()).done){e.next=49;break}if(null==(f=h.value).position_node_on_vagon||null!=a.find((function(e){return e.recid==f.position_node_on_vagon}))){e.next=47;break}return e.next=45,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recid eq ".concat(f.position_node_on_vagon,")"));case 45:b=e.sent,this.isNullOrEmptyResponse(b)||a.push(b.value[0]);case 47:e.next=40;break;case 49:e.next=54;break;case 51:e.prev=51,e.t0=e.catch(38),m.e(e.t0);case 54:return e.prev=54,m.f(),e.finish(54);case 57:e.next=97;break;case 59:_=Object(K.a)(c),e.prev=60,_.s();case 62:if((y=_.n()).done){e.next=89;break}return g=y.value,e.next=66,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(key_element_code eq ".concat(g.key_element_code,") and (position_on_node eq ").concat(g.position_on_node,") ").concat(o));case 66:u=e.sent,k=Object(K.a)(u.value),e.prev=68,k.s();case 70:if((v=k.n()).done){e.next=79;break}if(null==(f=v.value)||null==f.position_node_on_vagon||null!=a.find((function(e){return e.recid==f.position_node_on_vagon}))){e.next=77;break}return e.next=75,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recid eq ".concat(f.position_node_on_vagon,")"));case 75:b=e.sent,this.isNullOrEmptyResponse(b)||a.push(b.value[0]);case 77:e.next=70;break;case 79:e.next=84;break;case 81:e.prev=81,e.t1=e.catch(68),k.e(e.t1);case 84:return e.prev=84,k.f(),e.finish(84);case 87:e.next=62;break;case 89:e.next=94;break;case 91:e.prev=91,e.t2=e.catch(60),_.e(e.t2);case 94:return e.prev=94,_.f(),e.finish(94);case 97:return e.abrupt("return",a);case 98:case"end":return e.stop()}}),e,this,[[38,51,54,57],[60,91,94,97],[68,81,84,87]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFreePositionsOnVagonByKeyElementAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r,s,l){var o,i,c,u,d,m,h,f,b,_,y,g;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],i=[],c=this.state.options,e.next=5,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(vehicle eq ".concat(this.props.activeRecord.recid,")"));case 5:for(u=e.sent,d=u.value,m=0;m<d.length;m++)i.push(d[m].position_on_vagon);if(c.length>0)for(m=0;m<c.length;m++)i.push(c[m].position);if(o=i.length>0?l.filter((function(e){return null==i.find((function(t){return t==e.recid}))})):l,h=[],!(c.length>0&&null!=r)){e.next=24;break}m=0;case 13:if(!(m<c.length)){e.next=24;break}if(null==c[m].node||c[m].node==r){e.next=21;break}return e.next=17,this.getAssemblyElement(c[m].node);case 17:f=e.sent,b=f.ke_node_type,null!=(_=o.filter((function(e){return s==b&&(e.position_node_on_vagon==c[m].positionObj.position_node_on_vagon||e.position_node_on_vagon==c[m].positionObj.recid)})))&&_.length>0&&h.push.apply(h,Object(C.a)(_));case 21:m++,e.next=13;break;case 24:if(!(d.length>0&&null!=r)){e.next=42;break}m=0;case 26:if(!(m<d.length)){e.next=42;break}if(null==d[m].ke_node||d[m].ke_node==r){e.next=39;break}return e.next=30,this.getAssemblyElement(d[m].ke_node);case 30:if(f=e.sent,b=f.ke_node_type,null==d[m].position_on_vagon){e.next=38;break}return e.next=35,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(recid eq ".concat(d[m].position_on_vagon,")"));case 35:y=e.sent,(g=y.value).length>0&&(_=o.filter((function(e){return s==b&&(e.position_node_on_vagon==g[0].position_node_on_vagon||e.position_node_on_vagon==g[0].recid)})));case 38:null!=_&&_.length>0&&h.push.apply(h,Object(C.a)(_));case 39:m++,e.next=26;break;case 42:return null!=h&&h.length>0&&(o=o.filter((function(e){return null==h.find((function(t){return t.recid==e.recid}))}))),"6"==t&&"477d0c01-84d3-441c-9bb9-15f9d609671d"==n&&a.indexOf("-03")==a.length-3&&(o=o.filter((function(e){return"\u0441\u0440\u0435\u0434\u043d\u044f\u044f"!=e.position_node_on_vagon___value}))),e.abrupt("return",o);case 45:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,s,l){return e.apply(this,arguments)}}()},{key:"getFreePositionsOnVagonByAssemblyUnitAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],l=[],o=[],e.next=5,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(vehicle eq ".concat(this.props.activeRecord.recid,")"));case 5:if(i=e.sent,null!=(c=i.value))for(u=0;u<c.length;u++)(d=c[u]).ke_node_type==a.ke_node_type&&null!=d.assembly_element_position_on_vagon&&l.push(d.assembly_element_position_on_vagon);if(s=l.length>0?r.filter((function(e){return null==l.find((function(t){return t==e.recid}))})):r,!(this.state.options.length>0)){e.next=22;break}u=0;case 11:if(!(u<this.state.options.length)){e.next=22;break}if(!(m=this.state.options[u]).isKeyElement){e.next=18;break}return e.next=16,this.getAssemblyElement(m.node);case 16:null!=(h=e.sent)&&null!=m.position&&n.recid==h.ke_node_type&&o.push(m.positionObj.position_node_on_vagon);case 18:m.isKeyElement||null!=m.position&&n.recid==m.nodeObj.ke_node_type&&o.push(m.positionObj.recid);case 19:u++,e.next=11;break;case 22:return o.length>0&&(s=s.filter((function(e){return null==o.find((function(t){return t==e.recid}))}))),e.abrupt("return",s);case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"getMemberByUser",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=localStorage.getItem("groups"))){e.next=3;break}return e.abrupt("return",this.modalError("\u0412 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043e\u0442\u0441\u0443\u0441\u0442\u0432\u0443\u044e\u0442 \u0433\u0440\u0443\u043f\u043f\u044b."));case 3:n=JSON.parse(t),a=0;case 5:if(!(a<n.length)){e.next=14;break}return e.next=8,this.sendAuthorizedRequestAsync("/odata/reestr_members?$filter=(authgroup eq ".concat(n[a],")"));case 8:if(r=e.sent,this.isNullOrEmptyResponse(r)){e.next=11;break}return e.abrupt("return",r.value[0]);case 11:a++,e.next=5;break;case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOkModal",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleOkModal_",this),console.log("handleOkModal__",this.state),t=this.state.options,console.log("handleOkModal",t),c=!1,"keyElement"==this.state.currentElementType?(null==this.state.modalValue||""==this.state.modalValue?n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated):(n="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),a=this.state.modalValue.recid,r=this.state.modalValue),s=null!=this.state.currentElement.ke_node&&""!=this.state.currentElement.ke_node?this.state.currentElement.ke_node:null,u=this.state.currentElement.numberke,l=this.state.currentElement.recid,o=null!=s?"#4bf1547d":"#ebf5ff",i=null!=s?"#027707":"#007eff",c=!0):"numberkeConfirm"==this.state.currentElementType?(console.log(this.state),null!=this.state.modalValue&&""!=this.state.modalValue||(n="".concat(this.state.currentElement)),u=this.state.currentElement,c=!0):(null==this.state.modalValue||""==this.state.modalValue?n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated):(n="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),a=this.state.modalValue.recid,r=this.state.modalValue),u=this.state.currentElement.unique_number,s=this.state.currentElement.recid,l=this.state.currentElement.recid,o="#4bf1547d",i="#027707"),console.log("handleOkModal2",t),t.push({value:"".concat(this.state.currentElement.recid),label:n,position:a,positionObj:r,number:l,numberValue:u,backgroundColor:o,color:i,node:s,nodeObj:this.state.currentElement,isKeyElement:c}),console.log("handleOkModal3",t),this.setState({options:t,showModal:!1,isLoadingDetail:!1,modalValue:""}),console.log("handleOkModal4",t),d=t.map((function(e){return{number:e.number,position:e.position,numberValue:e.numberValue}})),this.props.setFieldValue(this.props.field.name,JSON.stringify(d)),e.next=15,this.updateStateTable("add");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a.length>0?a[0]:null);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnVehicle",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a){var r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v,E,O,x,S,w,C;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],s="","4"==n?s="and (for_four_axes_vagon eq true)":"6"==n&&(s="and (for_six_axes_vagon eq true)"),"cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=33;break}return e.next=6,this.sendAuthorizedRequestAsync("/odata/dictionary_vagon_composition?$filter=(assembly_element_type eq ".concat(t,")"));case 6:if(l=e.sent,null!=(o=l.value)){e.next=10;break}return e.abrupt("return",null);case 10:i=o.map((function(e){return e.key_element_type})),c=Object(K.a)(i),e.prev=12,c.s();case 14:if((u=c.n()).done){e.next=23;break}return d=u.value,e.next=18,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(key_element_code eq ".concat(d,") ").concat(s));case 18:m=e.sent,null!=(h=m.value[0])&&null!=h.position_node_on_vagon&&null==r.find((function(e){return e.recid==h.position_node_on_vagon}))&&null!=(f=a.find((function(e){return e.recid==h.position_node_on_vagon})))&&r.push(f);case 21:e.next=14;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),c.e(e.t0);case 28:return e.prev=28,c.f(),e.finish(28);case 31:e.next=41;break;case 33:return e.next=35,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(child_node_type eq ".concat(t,") ").concat(s));case 35:if(b=e.sent,null!=(_=b.value)&&0!=_.length){e.next=39;break}return e.abrupt("return",null);case 39:y=Object(K.a)(_);try{for(y.s();!(g=y.n()).done;)null!=(h=g.value).position_node_on_vagon&&null==r.find((function(e){return e.recid==h.position_node_on_vagon}))&&null!=(f=a.find((function(e){return e.recid==h.position_node_on_vagon})))&&r.push(f)}catch(p){y.e(p)}finally{y.f()}case 41:if(null!=r&&0!=r.length){e.next=43;break}return e.abrupt("return",null);case 43:if(k=[],v=[],E=[],null!=(O=this.props.refComponentDataGrid.state.childAssemblyElements))for(x=0;x<O.length;x++)(S=O[x]).ke_node_type==t&&null!=S.assembly_element_position_on_vagon&&v.push(S.assembly_element_position_on_vagon);if(k=v.length>0?r.filter((function(e){return null==v.find((function(t){return t==e.recid}))})):r,!(this.state.options.length>0)){e.next=64;break}x=0;case 51:if(!(x<this.state.options.length)){e.next=64;break}if(!(w=this.state.options[x]).isKeyElement){e.next=60;break}return e.next=56,this.getAssemblyElement(w.node);case 56:null!=(C=e.sent)&&null!=w.position&&t==C.ke_node_type&&E.push(w.positionObj.position_node_on_vagon),e.next=61;break;case 60:null!=w.position&&t==w.nodeObj.ke_node_type&&E.push(w.positionObj.recid);case 61:x++,e.next=51;break;case 64:return E.length>0&&(k=k.filter((function(e){return null==E.find((function(t){return t==e.recid}))}))),k.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",k);case 67:case"end":return e.stop()}}),e,this,[[12,25,28,31]])})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnVehicle",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c,u,d=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="","4"==n?a="and (for_four_axes_vagon eq true)":"6"==n&&(a="and (for_six_axes_vagon eq true)"),e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(key_element_code eq ".concat(t,") ").concat(a));case 4:for(r=e.sent,s=r.value,l=[],o=[],i=this.props.refComponentDataGrid.state.childKeyElements,c=0;c<i.length;c++)o.push(i[c].position_on_vagon);if(this.state.options.length>0)for(c=0;c<this.state.options.length;c++)o.push(this.state.options[c].position);if(l=o.length>0?s.filter((function(e){return null==o.find((function(t){return t==e.recid}))})):s,u=[],this.state.options.length>0)for(c=0;c<this.state.options.length;c++)null!=this.state.options[c].node&&null!=(u=l.filter((function(e){return null!=e.position_node_on_vagon&&e.position_node_on_vagon==d.state.options[c].positionObj.position_node_on_vagon})))&&u.length>0&&(l=l.filter((function(e){return null==u.find((function(t){return t.recid==e.recid}))})));return l.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",l);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllNodePositions();case 2:if(a=e.sent,null!=(r=this.props.refComponentDataGrid.getStateTableData())&&0!=r.length){e.next=6;break}return e.abrupt("return");case 6:if(s=null,l=null,o=null,"add"==t?l=this.state.options[this.state.options.length-1]:"delete"==t&&(l=this.state.itemForDelete),null!=l){e.next=12;break}return e.abrupt("return");case 12:if(!l.isKeyElement){e.next=23;break}if(null==l.node){e.next=20;break}return e.next=16,this.getAssemblyElement(l.node);case 16:i=e.sent,s=r.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==i.ke_node_type})),e.next=21;break;case 20:s=r.find((function(e){return null!=e.keyElementTypeId&&e.keyElementTypeId==l.nodeObj.key_element_code}));case 21:e.next=24;break;case 23:s=r.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==l.nodeObj.ke_node_type}));case 24:if(null!=s){e.next=26;break}return e.abrupt("return");case 26:if("delete"!=t||0!=s.usedPositionsCount){e.next=28;break}return e.abrupt("return");case 28:if(null==s.assemblyElementTypeId){e.next=34;break}return e.next=31,this.getAvailablePositionsByAssemblyElementOnVehicle(s.assemblyElementTypeId,this.props.activeRecord.model_axes_calculated,a);case 31:o=e.sent,e.next=38;break;case 34:if(null==s.keyElementTypeId){e.next=38;break}return e.next=37,this.getAvailablePositionsByKeyElementOnVehicle(s.keyElementTypeId,this.props.activeRecord.model_axes_calculated);case 37:o=e.sent;case 38:c=r.indexOf(s),"add"==t?s.usedPositionsCount=s.usedPositionsCount+1:"delete"==t&&(s.usedPositionsCount=s.usedPositionsCount-1),s.isFull=s.usedPositionsCount===s.positionsCount,s.assemblyElementCountStr=s.usedPositionsCount+" \u0438\u0437 "+s.positionsCount,null!=o&&o.length>0?(d=o.map((function(e){return e.recname})),u=d.join(", ")):u=null,s.assemblyElementAvailablePositions=u,r[c]=s,this.props.refComponentDataGrid.setStateTableData(r);case 46:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(n,")").concat(a));case 3:if(r=e.sent,s=r.value,console.log("allPositionsResp",s.length),null!=s||0!=s.length){e.next=8;break}return e.abrupt("return",null);case 8:for(l=[],o=[],null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),i=this.props.refComponentDataGrid.state.childKeyElements),console.log("installedKeyElements",this.state),c=0;c<i.length;c++)null!=i[c].position_on_node&&l.push(i[c].position_on_node);if(console.log("installedKeyElements",this.state.options),this.state.options.length>0)for(c=0;c<this.state.options.length;c++)l.push(this.state.options[c].position);return(o=l.length>0?s.filter((function(e){return null==l.find((function(t){return t==e.recid}))})):s).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a,r){var s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(a,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:l=e.sent,o=l.value[0],s=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(n,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(s));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(K.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=r.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(console.log("allPositionsOnNode",u.length),null!=u||0!=u.length){e.next=19;break}return e.abrupt("return",null);case 19:for(null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),y=this.props.refComponentDataGrid.state.childAssemblyElements),console.log("alreadyInstalledNodes",y.length),g=0;g<y.length;g++)null!=(k=y[g]).position_on_assembly_element&&d.push(k.position_on_assembly_element);if(console.log("athis.state.optionsaa",this.state.options),this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(v=this.state.options[g]).isKeyElement?null!=v.position&&v.positionObj.child_node_type==n&&d.push(v.positionObj.node_position):null!=v.position&&n==v.nodeObj.ke_node_type&&d.push(v.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"getOptions",value:function(){var e=this;this.setState({isLoading:!0}),fetch("/odata/$metadata/".concat(this.props.field.relation.table),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){var n=t.fieldGroups.autoLookup.fields.map((function(e){return e.name.toLowerCase()})),a=e.props.field.relation,r=a.field,s=a.displayField;null==r&&(r="recid"),null==s&&(s="recname"),null==n.find((function(e){return e==s.toLowerCase()}))&&n.push(s.toLowerCase());var l="",o=!1;if(null!=e.props.field.lookup){var i=e.props.field.lookup.field,c=e.props.activeRecord[i];l="$filter=(".concat(i," eq '").concat(c,"')"),-1==n.findIndex((function(e){return e==i}))&&(n.push(i),o=!0)}fetch("/odata/".concat(e.props.field.relation.table,"?").concat(l,"&$select=").concat(n.join(",")),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){o&&(n=n.filter((function(t){return t!=e.props.field.lookup.field}))),-1==t.value.findIndex((function(t){return t.recid==e.props.value}))&&e.props.setFieldValue(e.props.field.name,null);var a=t.value.map((function(e){return{id:e[r.toLowerCase()],value:n.filter((function(e){return"recid"!=e})).map((function(t){return e[t]})).join(", ")}})).sort((function(e,t){return e.value<t.value?-1:e.value>t.value?1:0}));e.setState({options:a,isLoading:!1,isLoadingDetail:!1})}))}))}},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,r,s,l,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(C.a)(this.state.options),-1!==(a=n.indexOf(t))&&(n.splice(a,1),this.setState({options:n}),this.props.setFieldValue(this.props.field.name,JSON.stringify(n))),this.setState({showDeleteModal:!1}),r=Object(C.a)(this.state.addedItems),s=r.find((function(e){return e==t.numberValue})),-1!==(l=r.indexOf(s))&&(r.splice(l,1),this.setState({addedItems:r})),!(o=this.state.itemForDelete).isKeyElement||"e4ef0365-0365-40df-ab4e-a77104c352df"!=o.nodeObj.key_element_code){e.next=24;break}if(null==this.props.refComponentDataGrid){e.next=15;break}if(console.log("refComponentDataGrid",this.props.refComponentDataGrid),null!=(i=this.props.refComponentDataGrid.getStateTableData(i))||0!=i.length){e.next=15;break}return e.abrupt("return");case 15:if(null==i.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=24;break}if(!o.nodeObj.has_rough_axis_number||null==o.nodeObj.rough_axis||""==o.nodeObj.rough_axis){e.next=24;break}return e.next=20,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(o.nodeObj.rough_axis,")"));case 20:if(null==(c=e.sent)){e.next=24;break}return e.next=24,this.updateStateTable("delete",{value:c.recid,number:c.recid,numberValue:c.numberke,node:null,nodeObj:c,isKeyElement:!0});case 24:return e.next=26,this.updateStateTable("delete");case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return a.createElement(W.a,{isOpen:this.state.showDeleteModal,size:"xl"},a.createElement(H.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),a.createElement(Z.a,null,a.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),a.createElement(Y.a,null,a.createElement(b.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),a.createElement(b.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},a.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;console.log("render_creatable",this.props);return a.createElement(k.a,null,a.createElement(v.a,null,a.createElement("b",null,this.props.field.displayName)),a.createElement(J.a,{ref:function(t){e.refInput=t},name:this.props.field.name,components:{MultiValue:function(t){var n={backgroundColor:t.data.backgroundColor,color:t.data.color};return a.createElement("div",{className:"SelectValue",style:n},a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t.data)}},"\xd7"),a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.options,isMulti:!0,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.props.field.isDisabled||this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,autoFocus:this.props.field.autoFocus||!1,styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}),a.createElement(W.a,{isOpen:this.state.showModal,toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},a.createElement(H.a,{toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),a.createElement(Z.a,null,a.createElement(f.a,null,a.createElement(b.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal,style:{width:"124px",height:"32px"}},a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",a.createElement(b.a,{size:"sm",onClick:function(){return e.setState({showModal:!1,modalItems:[],isLoadingDetail:!1})},style:{width:"103.63px",height:"32px"}},a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),a.createElement("hr",null),a.createElement(v.a,null,"\u041d\u043e\u043c\u0435\u0440"),a.createElement(E.a,{id:"number",value:"keyElement"==this.state.currentElementType?this.state.currentElement.ke_number_calculated:this.state.currentElement.unique_number,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),a.createElement(E.a,{id:"element_name",value:"keyElement"==this.state.currentElementType?this.state.currentElement.key_element_code_calculated:this.state.currentElement.ke_node_type_calculated,readOnly:!0}),a.createElement("br",null),a.createElement(v.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),a.createElement(j.a,{name:"testname",options:this.state.modalItems,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",getOptionLabel:function(e){return e.recname},getOptionValue:function(e){return e.recid},onChange:this.handleModalChange,value:this.state.modalValue,onValueClick:function(e){return T(!0,e.value)},styles:{control:function(e,t){var n=t.isFocused;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:"white",boxShadow:n?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:n?"#68a1be":"#e4e7ea",":hover":{borderColor:n?"#68a1be":"#e4e7ea"}})},option:function(e,t){var n=t.isDisabled,a=t.isFocused,r=t.isSelected;return Object(A.a)(Object(A.a)({},e),{},{backgroundColor:n?null:r?"#f5fafe":a?"#ecf5ff":null,color:"black"})}}}))),this.renderDeleteConfirm())}}]),n}(a.Component),Lt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).onCellPrepared=function(e){console.log(e.data),"data"===e.rowType&&null!=e.data&&(e.cellElement.style.backgroundColor=e.data.positionsCount==e.data.usedPositionsCount?"rgb(91, 223, 127)":"rgb(222, 91, 91)")},a.state={options:[],selectedRowNotes:"",data:[],uin:"",elements_in_vagon:{},select_element:{},is_circ:!1,visible_alert:!1,name_old_element:"",name_new_element:null,elementType:"",assemblyElementPatternId:null,stateTableLoaded:!1,stateTableLoading:!1,childKeyElements:[],childAssemblyElements:[]},a.loadStateTable=a.loadStateTable.bind(Object(h.a)(a)),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount",this.props),console.log("this_componentDidMount",this),e.next=4,this.loadStateTable();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadStateTable",this.props),this.setState({stateTableLoading:!0}),this.props.updateStateTableLoading(!0),t="vehicle",this.setState({elementType:t}),e.next=7,this.getAllKeyElementTypes();case 7:return n=e.sent,e.next=10,this.getAllAssemblyElementTypes();case 10:return a=e.sent,e.next=13,this.getAllNodePositions();case 13:return r=e.sent,s=[],e.next=17,this.getVehicleComposition();case 17:if(l=e.sent,o=0,null==l){e.next=76;break}if(!(null!=l.assemblyElementTypeIds&&l.assemblyElementTypeIds.length>0)){e.next=48;break}return e.next=23,this.getChildAssemblyElementsByVehicle(this.props.activeRecord.recid);case 23:i=e.sent,this.state.childAssemblyElements=i,c=0;case 26:if(!(c<l.assemblyElementTypeIds.length)){e.next=48;break}return u=l.assemblyElementTypeIds[c],t=a.find((function(e){return e.recid==u})),d=t.recname,m=i.filter((function(e){return e.ke_node_type==u})),e.next=33,this.getAvailablePositionsByAssemblyElementOnVehicle(u,this.props.activeRecord.model_axes_calculated,r);case 33:return h=e.sent,f=null,b=u,null!=h&&h.length>0?(y=h.map((function(e){return e.recname})),_=y.join(", ")):_=null,e.next=39,this.getAssemblyElementsCountOnVehicle(u,this.props.activeRecord.dictionary_models);case 39:if(null!=(g=e.sent)&&0!=g){e.next=42;break}return e.abrupt("continue",45);case 42:o+=1,s.push({keyElementTypeId:f,assemblyElementTypeId:b,positionsCount:g,usedPositionsCount:m.length,isFull:g===m.length,number:o,assemblyElementName:d,assemblyElementCountStr:m.length+" \u0438\u0437 "+g,assemblyElementAvailablePositions:_}),this.setStateTableData(s);case 45:c++,e.next=26;break;case 48:if(!(null!=l.keyElementTypeIds&&l.keyElementTypeIds.length>0)){e.next=76;break}return e.next=51,this.getChildKeyElementsByVehicle(this.props.activeRecord.recid);case 51:k=e.sent,this.state.childKeyElements=k,c=0;case 54:if(!(c<l.keyElementTypeIds.length)){e.next=76;break}return u=l.keyElementTypeIds[c],t=n.find((function(e){return e.recid==u})),d=t.recname,m=k.filter((function(e){return e.key_element_code==u})),e.next=61,this.getAvailablePositionsByKeyElementOnVehicle(u,this.props.activeRecord.model_axes_calculated);case 61:return h=e.sent,f=u,b=null,null!=h&&h.length>0?(y=h.map((function(e){return e.recname})),_=y.join(", ")):_=null,e.next=67,this.getKeyElementsCountOnVehicle(u,this.props.activeRecord.dictionary_models);case 67:if(null!=(g=e.sent)&&0!=g){e.next=70;break}return e.abrupt("continue",73);case 70:o+=1,s.push({keyElementTypeId:f,assemblyElementTypeId:b,positionsCount:g,usedPositionsCount:m.length,isFull:g===m.length,number:o,assemblyElementName:d,assemblyElementCountStr:m.length+" \u0438\u0437 "+g,assemblyElementAvailablePositions:_}),this.setStateTableData(s);case 73:c++,e.next=54;break;case 76:null!=s&&s.length>0?(this.setState({stateTableLoaded:!0}),this.props.updateStateTableLoaded(!0)):(this.setStateTableData([]),this.setState({stateTableLoaded:!1}),this.props.updateStateTableLoaded(!1)),this.setState({stateTableLoading:!1}),this.props.updateStateTableLoading(!1);case 79:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getVehicleComposition",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_vagon_composition");case 2:if(t=e.sent,null!=(n=t.value)&&0!=n.length){e.next=6;break}return e.abrupt("return",null);case 6:return a=[],r=[],n.map((function(e){null!=e.assembly_element_type?null==a.find((function(t){return t==e.assembly_element_type}))&&a.push(e.assembly_element_type):null!=e.key_element_type&&null==r.find((function(t){return t==e.key_element_type}))&&r.push(e.key_element_type)})),e.abrupt("return",{assemblyElementTypeIds:a,keyElementTypeIds:r});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnVehicle",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n,a){var r,s,l,o,i,c,u,d,m,h,f,b,_,y,g,k,v,E,O,x,S,w,C;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],s="","4"==n?s="and (for_four_axes_vagon eq true)":"6"==n&&(s="and (for_six_axes_vagon eq true)"),"cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=33;break}return e.next=6,this.sendAuthorizedRequestAsync("/odata/dictionary_vagon_composition?$filter=(assembly_element_type eq ".concat(t,")"));case 6:if(l=e.sent,null!=(o=l.value)){e.next=10;break}return e.abrupt("return",null);case 10:i=o.map((function(e){return e.key_element_type})),c=Object(K.a)(i),e.prev=12,c.s();case 14:if((u=c.n()).done){e.next=23;break}return d=u.value,e.next=18,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(key_element_code eq ".concat(d,") ").concat(s));case 18:m=e.sent,null!=(h=m.value[0])&&null!=h.position_node_on_vagon&&null==r.find((function(e){return e.recid==h.position_node_on_vagon}))&&null!=(f=a.find((function(e){return e.recid==h.position_node_on_vagon})))&&r.push(f);case 21:e.next=14;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),c.e(e.t0);case 28:return e.prev=28,c.f(),e.finish(28);case 31:e.next=41;break;case 33:return e.next=35,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(child_node_type eq ".concat(t,") ").concat(s));case 35:if(b=e.sent,null!=(_=b.value)&&0!=_.length){e.next=39;break}return e.abrupt("return",null);case 39:y=Object(K.a)(_);try{for(y.s();!(g=y.n()).done;)null!=(h=g.value).position_node_on_vagon&&null==r.find((function(e){return e.recid==h.position_node_on_vagon}))&&null!=(f=a.find((function(e){return e.recid==h.position_node_on_vagon})))&&r.push(f)}catch(p){y.e(p)}finally{y.f()}case 41:if(null!=r&&0!=r.length){e.next=43;break}return e.abrupt("return",null);case 43:if(k=[],v=[],E=[],null!=(O=this.state.childAssemblyElements))for(x=0;x<O.length;x++)(S=O[x]).ke_node_type==t&&null!=S.assembly_element_position_on_vagon&&v.push(S.assembly_element_position_on_vagon);if(k=v.length>0?r.filter((function(e){return null==v.find((function(t){return t==e.recid}))})):r,!(this.state.options.length>0)){e.next=64;break}x=0;case 51:if(!(x<this.state.options.length)){e.next=64;break}if(!(w=this.state.options[x]).isKeyElement){e.next=60;break}return e.next=56,this.getAssemblyElement(w.node);case 56:null!=(C=e.sent)&&null!=w.position&&t==C.ke_node_type&&E.push(w.positionObj.position_node_on_vagon),e.next=61;break;case 60:null!=w.position&&t==w.nodeObj.ke_node_type&&E.push(w.positionObj.recid);case 61:x++,e.next=51;break;case 64:return E.length>0&&(k=k.filter((function(e){return null==E.find((function(t){return t==e.recid}))}))),k.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",k);case 67:case"end":return e.stop()}}),e,this,[[12,25,28,31]])})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnVehicle",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r,s,l,o,i,c,u,d=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="","4"==n?a="and (for_four_axes_vagon eq true)":"6"==n&&(a="and (for_six_axes_vagon eq true)"),e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_vagon?$filter=(key_element_code eq ".concat(t,") ").concat(a));case 4:for(r=e.sent,s=r.value,l=[],o=[],i=this.state.childKeyElements,c=0;c<i.length;c++)o.push(i[c].position_on_vagon);if(this.state.options.length>0)for(c=0;c<this.state.options.length;c++)o.push(this.state.options[c].position);if(l=o.length>0?s.filter((function(e){return null==o.find((function(t){return t==e.recid}))})):s,u=[],this.state.options.length>0)for(c=0;c<this.state.options.length;c++)null!=this.state.options[c].node&&null!=(u=l.filter((function(e){return null!=e.position_node_on_vagon&&e.position_node_on_vagon==d.state.options[c].positionObj.position_node_on_vagon})))&&u.length>0&&(l=l.filter((function(e){return null==u.find((function(t){return t.recid==e.recid}))})));return l.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",l);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAssemblyElementsCountOnVehicle",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_count_ke_on_vagon?$filter=(model_vagon eq ".concat(n,")"));case 2:if(a=e.sent,r=a.value[0],"cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=8;break}return e.abrupt("return",r.carts);case 8:if("79ddf686-f26f-4567-97ac-cb18eadd83e9"!=t){e.next=12;break}return e.abrupt("return",r.vagon_tank_bodies);case 12:if("ae11ae44-1c69-49e0-83a1-4122bb2d80ae"!=t){e.next=16;break}return e.abrupt("return",r.autocouplers);case 16:if("700b86ca-5b88-44d6-a5d3-c2c4e76d96f8"!=t){e.next=20;break}return e.abrupt("return",r.absorbing_device);case 20:if("a6180bfa-368d-4eff-97f2-c4f6c2612bc6"!=t){e.next=22;break}return e.abrupt("return",r.air_distributor_assembled);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getKeyElementsCountOnVehicle",value:function(){var e=Object(m.a)(p.a.mark((function e(t,n){var a,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_count_ke_on_vagon?$filter=(model_vagon eq ".concat(n,")"));case 2:if(a=e.sent,r=a.value[0],"ad836d1b-6ecb-4dce-a508-8e9f42095ba3"!=t){e.next=8;break}return e.abrupt("return",r.railway_carcass);case 8:if("12bade5a-a313-4646-8bf8-d260dd287d1c"!=t){e.next=12;break}return e.abrupt("return",r.gondola_hatches);case 12:if("cb0c6745-79e1-4f4c-8100-805942413ad5"!=t){e.next=16;break}return e.abrupt("return",r.front_rear_detents);case 16:if("4ba30e4b-a6e2-4cbd-bab0-ff51c79c7b87"!=t){e.next=20;break}return e.abrupt("return",r.traction_clamp);case 20:if("c91fe0b9-99c8-4ad4-b504-3bb3d15af749"!=t){e.next=22;break}return e.abrupt("return",r.auto_mode);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getChildKeyElementsByVehicle",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(vehicle eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChildAssemblyElementsByVehicle",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(vehicle eq ".concat(t,")"));case 2:return n=e.sent,a=n.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllKeyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_key_elements_codes?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllAssemblyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,n=t.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){(console.log("setStateTableData",e),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance)&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(console.log("getStateTableData"),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"render",value:function(){return r.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},r.a.createElement(y.a,{md:"auto"},r.a.createElement(te.a,{preloadEnabled:!1,name:this.props.field.name,selection:{mode:"single"},showBorders:!0,showColumnLines:!1,showRowLines:!0,hoverStateEnabled:!0,columnAutoWidth:!0,onCellPrepared:this.onCellPrepared,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},r.a.createElement(ee.Column,{width:"3%",dataField:"number",caption:"#",dataType:"number"}),r.a.createElement(ee.Column,{width:"30%",dataField:"assemblyElementName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",dataType:"string"}),r.a.createElement(ee.Column,{width:"10%",dataField:"assemblyElementCountStr",caption:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",dataType:"string"}),r.a.createElement(ee.Column,{dataField:"assemblyElementAvailablePositions",caption:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",dataType:"string"})),r.a.createElement("div",{style:{marginTop:"30px"}},r.a.createElement(ne.a,{color:"success",isOpen:this.state.visible_alert},r.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),this.state.selectedRowNotes))))}},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,s,l,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedRowsData,"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0435\u0437 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445"!=(a=n[0]).nameke&&"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430"!=a.nameke&&"\u0422\u0435\u043b\u0435\u0436\u043a\u0430"!=a.nameke||(this.setState({is_circ:!0}),a.is_circ=!0),null==this.props.values.select_field.key_element_code){e.next=12;break}if(null==this.props.values.select_field.ke_node){e.next=11;break}return e.next=7,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.ke_node,")"));case 7:l=e.sent,s=r.a.createElement("b",null,l.value[0].ke_node_type_calculated," ",l.value[0].unique_number),e.next=12;break;case 11:s=r.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke);case 12:if(null==this.props.values.select_field.ke_node_type){e.next=21;break}if(null==this.props.values.select_field.parent_ke_node){e.next=20;break}return e.next=16,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.parent_ke_node,")"));case 16:o=e.sent,s=r.a.createElement("b",null,o.value[0].ke_node_type_calculated," ",o.value[0].unique_number),e.next=21;break;case 20:s=r.a.createElement("b",null,this.props.values.select_field.ke_node_type_calculated," ",this.props.values.select_field.unique_number);case 21:i=r.a.createElement("p",null,"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435 ",this.props.activeRecord.manufacturer_number," ",r.a.createElement("b",null,a.nameke," ",a.numberke)," \u043d\u0430 ",s),this.setState({visible_alert:!0,select_element:a,selectedRowNotes:i}),this.props.setFieldValue(this.props.field,a);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(a.Component),zt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).state={activeRecord:null,tableName:"",place:""},e}return Object(i.a)(n,[{key:"componentWillMount",value:function(){console.log("rdev_modalDataPack",window.rdev_modalDataPack),this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords})}},{key:"render",value:function(){return r.a.createElement(Bt,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},place:this.state.place,tableName:this.state.tableName,initialValues:{},activeRecord:this.state.activeRecord})}}]),n}(a.Component),Bt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.call(this)).updateStateTableLoaded=function(t){e.setState({stateTableLoaded:t})},e.updateStateTableLoading=function(t){e.setState({stateTableLoading:t})},e.updateSelectedDate=function(t){console.log("updateSelectedDate",t),e.setState({dateInstall:t}),void 0!=e.uinElementsField&&null!=e.uinElementsField&&e.uinElementsField.focus()},e.state={dateInstall:new Date,processingAction:!1,stateTableLoaded:!1,stateTableLoading:!1,isActionError:!1},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.dataGrid={},e.updateSelectedDate=e.updateSelectedDate.bind(Object(h.a)(e)),e.updateStateTableLoaded=e.updateStateTableLoaded.bind(Object(h.a)(e)),e.updateStateTableLoading=e.updateStateTableLoading.bind(Object(h.a)(e)),e}return Object(i.a)(n,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,n,a,r,s,l=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("state_test",this.state),t="",n=[],"undefined"!==this.state.dateInstall&&null!=this.state.dateInstall||(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0414\u0430\u0442\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438". ')),this.isNullObject(this.refs.formik.state.values.uin_elements_field)||"[]"===this.refs.formik.state.values.uin_elements_field||"[{}]"===this.refs.formik.state.values.uin_elements_field?t=String().concat(t,'\u041f\u043e\u043b\u0435 "\u0423\u0418\u041d \u0434\u0435\u0442\u0430\u043b\u0435\u0439 \u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0435" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e.'):(n=JSON.parse(this.refs.formik.state.values.uin_elements_field),console.log("ke_numbers_arr",n),0==n.length&&(t=String().concat(t,"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u044b \u0423\u0418\u041d \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0438."))),a=new Date(this.state.dateInstall).toLocaleDateString(),!this.isNotEmptyString(t)){e.next=12;break}return this.setState({processingAction:!1}),e.abrupt("return",T(!1,t));case 12:return n.map((function(e){if(!l.isNullObject(e.number))return{number:e.number,numberValue:e.numberValue,position:e.position}})).filter((function(e){return null!=e&&"undefined"!==e})),r={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({recid:this.props.activeRecord.recid,operationdate:a,ke_numbers:this.refs.formik.state.values.uin_elements_field})},console.log("requestBody",r),e.next=18,D("/plugins/nbdlogicplugin/setupkeonvehicle",r.body);case 18:if(s=e.sent,console.log("result_setupkeonvehicle_resp",s),!s.success){e.next=26;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",T(!0,"".concat(s.message)));case 26:return this.setState({processingAction:!1}),e.abrupt("return",T(!1,"".concat(s.message)));case 28:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(g.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return r.a.createElement(g.b,{onSubmit:t.handleSubmit},r.a.createElement("h5",{class:"modal-title"},"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0435\u0442\u0430\u043b\u0438"),r.a.createElement("hr",null),r.a.createElement(f.a,null,r.a.createElement(b.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",r.a.createElement(b.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},r.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),r.a.createElement("hr",null),r.a.createElement(g.a,{key:"date_field",name:"date_field"},(function(){return r.a.createElement(Pt,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedDate,field:{name:"date_field",displayName:"\u0414\u0430\u0442\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438"}},t))})),r.a.createElement(g.a,{key:"uin_elements_field",name:"uin_elements_field"},(function(){return r.a.createElement(It,{setFieldValue:t.setFieldValue,activeRecord:e.props.activeRecord,refComponentDataGrid:e.dataGrid,ref:function(t){e.uinElementsField=t},field:{name:"uin_elements_field",displayName:"\u0423\u0418\u041d \u0434\u0435\u0442\u0430\u043b\u0435\u0439 \u043a \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0435",autoFocus:!0}})})),r.a.createElement(g.a,{key:"data_grid",name:"data_grid"},(function(n){var a=n.formikfield;n.form;return r.a.createElement(Lt,Object.assign({value:e.props,field:{name:"data_grid",data:e.props.activeRecord.recid},setFieldValue:t.setFieldValue,updateStateTableLoaded:e.updateStateTableLoaded,updateStateTableLoading:e.updateStateTableLoading,activeRecord:e.props.activeRecord,ref:function(t){return e.dataGrid=t}},t,a))})))}}),r.a.createElement(Ft,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}))}},{key:"isEmptyString",value:function(e){return null==e||"undefined"===e||""===e||0===e.length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotNullObject",value:function(e){return null!=e&&"undefined"!==e&&e&&0!==Object.keys(e).length}},{key:"isEmptyOrNullArray",value:function(e){return!e||null==e||"undefined"===e||e.length<=0}},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}}]),n}(r.a.Component),Gt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(i.a)(n,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,"masscreatekeyelement"==this.props.pluginName&&r.a.createElement(I,null),"createassemblyunitornodeelement"==this.props.pluginName&&r.a.createElement(me,null),"repairregistration"==this.props.pluginName&&r.a.createElement(Oe,null),"replacekeyelement"==this.props.pluginName&&r.a.createElement(Pe,null),"confirmacceptancebatch"==this.props.pluginName&&r.a.createElement($e,null),"disposalregistration"==this.props.pluginName&&r.a.createElement(Ze,null),"addtobatch"==this.props.pluginName&&r.a.createElement(et,null),"addvehicle"==this.props.pluginName&&r.a.createElement(ot,null),"adduinkeyelement"==this.props.pluginName&&r.a.createElement(dt,null),"adduinketoassemblyunit"==this.props.pluginName&&r.a.createElement(gt,null),"replacekeinasemblyunit"==this.props.pluginName&&r.a.createElement(xt,null),"addketoassemblyunit"==this.props.pluginName&&r.a.createElement(Rt,null),"addkeyelementstobatch"==this.props.pluginName&&r.a.createElement(Vt,null),"setupkeonvehicle"==this.props.pluginName&&r.a.createElement(zt,null))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var $t=n(336),Ut=n(539);Object($t.loadMessages)(Ut),Object($t.locale)("ru"),l.a.render(r.a.createElement(r.a.Fragment,null,r.a.createElement(Gt,{pluginName:window.rdev_pluginName})),document.getElementById("custom-plugin-body")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},338:function(e,t,n){},453:function(e,t,n){},534:function(e,t,n){},540:function(e,t,n){e.exports=n(1153)},566:function(e,t,n){},567:function(e,t,n){},743:function(e,t,n){}},[[540,1,2]]]);